(function(){var x=this;var k=x._;var F={};var E=Array.prototype,f=Object.prototype,r=Function.prototype;var n=E.slice,B=E.unshift,c=f.toString,h=f.hasOwnProperty;var N=E.forEach,q=E.map,G=E.reduce,b=E.reduceRight,a=E.filter,C=E.every,o=E.some,m=E.indexOf,l=E.lastIndexOf,u=Array.isArray,e=Object.keys,H=r.bind;var O=function(p){return new v(p)};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=O}exports._=O}else{x._=O}O.VERSION="1.3.3";var K=O.each=O.forEach=function(T,S,R){if(T==null){return}if(N&&T.forEach===N){T.forEach(S,R)}else{if(T.length===+T.length){for(var Q=0,p=T.length;Q<p;Q++){if(Q in T&&S.call(R,T[Q],Q,T)===F){return}}}else{for(var P in T){if(O.has(T,P)){if(S.call(R,T[P],P,T)===F){return}}}}}};O.map=O.collect=function(R,Q,P){var p=[];if(R==null){return p}if(q&&R.map===q){return R.map(Q,P)}K(R,function(U,S,T){p[p.length]=Q.call(P,U,S,T)});if(R.length===+R.length){p.length=R.length}return p};O.reduce=O.foldl=O.inject=function(S,R,p,Q){var P=arguments.length>2;if(S==null){S=[]}if(G&&S.reduce===G){if(Q){R=O.bind(R,Q)}return P?S.reduce(R,p):S.reduce(R)}K(S,function(V,T,U){if(!P){p=V;P=true}else{p=R.call(Q,p,V,T,U)}});if(!P){throw new TypeError("Reduce of empty array with no initial value")}return p};O.reduceRight=O.foldr=function(S,R,p,Q){var P=arguments.length>2;if(S==null){S=[]}if(b&&S.reduceRight===b){if(Q){R=O.bind(R,Q)}return P?S.reduceRight(R,p):S.reduceRight(R)}var T=O.toArray(S).reverse();if(Q&&!P){R=O.bind(R,Q)}return P?O.reduce(T,R,p,Q):O.reduce(T,R)};O.find=O.detect=function(R,Q,P){var p;A(R,function(U,S,T){if(Q.call(P,U,S,T)){p=U;return true}});return p};O.filter=O.select=function(R,Q,P){var p=[];if(R==null){return p}if(a&&R.filter===a){return R.filter(Q,P)}K(R,function(U,S,T){if(Q.call(P,U,S,T)){p[p.length]=U}});return p};O.reject=function(R,Q,P){var p=[];if(R==null){return p}K(R,function(U,S,T){if(!Q.call(P,U,S,T)){p[p.length]=U}});return p};O.every=O.all=function(R,Q,P){var p=true;if(R==null){return p}if(C&&R.every===C){return R.every(Q,P)}K(R,function(U,S,T){if(!(p=p&&Q.call(P,U,S,T))){return F}});return !!p};var A=O.some=O.any=function(R,Q,P){Q||(Q=O.identity);var p=false;if(R==null){return p}if(o&&R.some===o){return R.some(Q,P)}K(R,function(U,S,T){if(p||(p=Q.call(P,U,S,T))){return F}});return !!p};O.include=O.contains=function(Q,P){var p=false;if(Q==null){return p}if(m&&Q.indexOf===m){return Q.indexOf(P)!=-1}p=A(Q,function(R){return R===P});return p};O.invoke=function(P,Q){var p=n.call(arguments,2);return O.map(P,function(R){return(O.isFunction(Q)?Q||R:R[Q]).apply(R,p)})};O.pluck=function(P,p){return O.map(P,function(Q){return Q[p]})};O.max=function(R,Q,P){if(!Q&&O.isArray(R)&&R[0]===+R[0]){return Math.max.apply(Math,R)}if(!Q&&O.isEmpty(R)){return -Infinity}var p={computed:-Infinity};K(R,function(V,S,U){var T=Q?Q.call(P,V,S,U):V;T>=p.computed&&(p={value:V,computed:T})});return p.value};O.min=function(R,Q,P){if(!Q&&O.isArray(R)&&R[0]===+R[0]){return Math.min.apply(Math,R)}if(!Q&&O.isEmpty(R)){return Infinity}var p={computed:Infinity};K(R,function(V,S,U){var T=Q?Q.call(P,V,S,U):V;T<p.computed&&(p={value:V,computed:T})});return p.value};O.shuffle=function(Q){var p=[],P;K(Q,function(T,R,S){P=Math.floor(Math.random()*(R+1));p[R]=p[P];p[P]=T});return p};O.sortBy=function(Q,R,p){var P=O.isFunction(R)?R:function(S){return S[R]};return O.pluck(O.map(Q,function(U,S,T){return{value:U,criteria:P.call(p,U,S,T)}}).sort(function(V,U){var T=V.criteria,S=U.criteria;if(T===void 0){return 1}if(S===void 0){return -1}return T<S?-1:T>S?1:0}),"value")};O.groupBy=function(Q,R){var p={};var P=O.isFunction(R)?R:function(S){return S[R]};K(Q,function(U,S){var T=P(U,S);(p[T]||(p[T]=[])).push(U)});return p};O.sortedIndex=function(T,S,Q){Q||(Q=O.identity);var p=0,R=T.length;while(p<R){var P=(p+R)>>1;Q(T[P])<Q(S)?p=P+1:R=P}return p};O.toArray=function(p){if(!p){return[]}if(O.isArray(p)){return n.call(p)}if(O.isArguments(p)){return n.call(p)}if(p.toArray&&O.isFunction(p.toArray)){return p.toArray()}return O.values(p)};O.size=function(p){return O.isArray(p)?p.length:O.keys(p).length};O.first=O.head=O.take=function(Q,P,p){return(P!=null)&&!p?n.call(Q,0,P):Q[0]};O.initial=function(Q,P,p){return n.call(Q,0,Q.length-((P==null)||p?1:P))};O.last=function(Q,P,p){if((P!=null)&&!p){return n.call(Q,Math.max(Q.length-P,0))}else{return Q[Q.length-1]}};O.rest=O.tail=function(Q,p,P){return n.call(Q,(p==null)||P?1:p)};O.compact=function(p){return O.filter(p,function(P){return !!P})};O.flatten=function(P,p){return O.reduce(P,function(Q,R){if(O.isArray(R)){return Q.concat(p?R:O.flatten(R))}Q[Q.length]=R;return Q},[])};O.without=function(p){return O.difference(p,n.call(arguments,1))};O.uniq=O.unique=function(S,R,Q){var p=Q?O.map(S,Q):S;var P=[];if(S.length<3){R=true}O.reduce(p,function(T,V,U){if(R?O.last(T)!==V||!T.length:!O.include(T,V)){T.push(V);P.push(S[U])}return T},[]);return P};O.union=function(){return O.uniq(O.flatten(arguments,true))};O.intersection=O.intersect=function(P){var p=n.call(arguments,1);return O.filter(O.uniq(P),function(Q){return O.every(p,function(R){return O.indexOf(R,Q)>=0})})};O.difference=function(P){var p=O.flatten(n.call(arguments,1),true);return O.filter(P,function(Q){return !O.include(p,Q)})};O.zip=function(){var p=n.call(arguments);var R=O.max(O.pluck(p,"length"));var Q=new Array(R);for(var P=0;P<R;P++){Q[P]=O.pluck(p,""+P)}return Q};O.indexOf=function(S,Q,R){if(S==null){return -1}var P,p;if(R){P=O.sortedIndex(S,Q);return S[P]===Q?P:-1}if(m&&S.indexOf===m){return S.indexOf(Q)}for(P=0,p=S.length;P<p;P++){if(P in S&&S[P]===Q){return P}}return -1};O.lastIndexOf=function(Q,P){if(Q==null){return -1}if(l&&Q.lastIndexOf===l){return Q.lastIndexOf(P)}var p=Q.length;while(p--){if(p in Q&&Q[p]===P){return p}}return -1};O.range=function(T,R,S){if(arguments.length<=1){R=T||0;T=0}S=arguments[2]||1;var P=Math.max(Math.ceil((R-T)/S),0);var p=0;var Q=new Array(P);while(p<P){Q[p++]=T;T+=S}return Q};var I=function(){};O.bind=function d(R,P){var Q,p;if(R.bind===H&&H){return H.apply(R,n.call(arguments,1))}if(!O.isFunction(R)){throw new TypeError}p=n.call(arguments,2);return Q=function(){if(!(this instanceof Q)){return R.apply(P,p.concat(n.call(arguments)))}I.prototype=R.prototype;var T=new I;var S=R.apply(T,p.concat(n.call(arguments)));if(Object(S)===S){return S}return T}};O.bindAll=function(P){var p=n.call(arguments,1);if(p.length==0){p=O.functions(P)}K(p,function(Q){P[Q]=O.bind(P[Q],P)});return P};O.memoize=function(Q,P){var p={};P||(P=O.identity);return function(){var R=P.apply(this,arguments);return O.has(p,R)?p[R]:(p[R]=Q.apply(this,arguments))}};O.delay=function(P,Q){var p=n.call(arguments,2);return setTimeout(function(){return P.apply(null,p)},Q)};O.defer=function(p){return O.delay.apply(O,[p,1].concat(n.call(arguments,1)))};O.throttle=function(Q,R){var P,T,U,V,S,W;var p=O.debounce(function(){S=V=false},R);return function(){P=this;T=arguments;var X=function(){U=null;if(S){Q.apply(P,T)}p()};if(!U){U=setTimeout(X,R)}if(V){S=true}else{W=Q.apply(P,T)}p();V=true;return W}};O.debounce=function(P,R,p){var Q;return function(){var U=this,T=arguments;var S=function(){Q=null;if(!p){P.apply(U,T)}};if(p&&!Q){P.apply(U,T)}clearTimeout(Q);Q=setTimeout(S,R)}};O.once=function(Q){var p=false,P;return function(){if(p){return P}p=true;return P=Q.apply(this,arguments)}};O.wrap=function(p,P){return function(){var Q=[p].concat(n.call(arguments,0));return P.apply(this,Q)}};O.compose=function(){var p=arguments;return function(){var P=arguments;for(var Q=p.length-1;Q>=0;Q--){P=[p[Q].apply(this,P)]}return P[0]}};O.after=function(P,p){if(P<=0){return p()}return function(){if(--P<1){return p.apply(this,arguments)}}};O.keys=e||function(Q){if(Q!==Object(Q)){throw new TypeError("Invalid object")}var P=[];for(var p in Q){if(O.has(Q,p)){P[P.length]=p}}return P};O.values=function(p){return O.map(p,O.identity)};O.functions=O.methods=function(Q){var P=[];for(var p in Q){if(O.isFunction(Q[p])){P.push(p)}}return P.sort()};O.extend=function(p){K(n.call(arguments,1),function(P){for(var Q in P){p[Q]=P[Q]}});return p};O.pick=function(P){var p={};K(O.flatten(n.call(arguments,1)),function(Q){if(Q in P){p[Q]=P[Q]}});return p};O.defaults=function(p){K(n.call(arguments,1),function(P){for(var Q in P){if(p[Q]==null){p[Q]=P[Q]}}});return p};O.clone=function(p){if(!O.isObject(p)){return p}return O.isArray(p)?p.slice():O.extend({},p)};O.tap=function(P,p){p(P);return P};function L(R,Q,P){if(R===Q){return R!==0||1/R==1/Q}if(R==null||Q==null){return R===Q}if(R._chain){R=R._wrapped}if(Q._chain){Q=Q._wrapped}if(R.isEqual&&O.isFunction(R.isEqual)){return R.isEqual(Q)}if(Q.isEqual&&O.isFunction(Q.isEqual)){return Q.isEqual(R)}var U=c.call(R);if(U!=c.call(Q)){return false}switch(U){case"[object String]":return R==String(Q);case"[object Number]":return R!=+R?Q!=+Q:(R==0?1/R==1/Q:R==+Q);case"[object Date]":case"[object Boolean]":return +R==+Q;case"[object RegExp]":return R.source==Q.source&&R.global==Q.global&&R.multiline==Q.multiline&&R.ignoreCase==Q.ignoreCase}if(typeof R!="object"||typeof Q!="object"){return false}var V=P.length;while(V--){if(P[V]==R){return true}}P.push(R);var T=0,p=true;if(U=="[object Array]"){T=R.length;p=T==Q.length;if(p){while(T--){if(!(p=T in R==T in Q&&L(R[T],Q[T],P))){break}}}}else{if("constructor" in R!="constructor" in Q||R.constructor!=Q.constructor){return false}for(var S in R){if(O.has(R,S)){T++;if(!(p=O.has(Q,S)&&L(R[S],Q[S],P))){break}}}if(p){for(S in Q){if(O.has(Q,S)&&!(T--)){break}}p=!T}}P.pop();return p}O.isEqual=function(P,p){return L(P,p,[])};O.isEmpty=function(P){if(P==null){return true}if(O.isArray(P)||O.isString(P)){return P.length===0}for(var p in P){if(O.has(P,p)){return false}}return true};O.isElement=function(p){return !!(p&&p.nodeType==1)};O.isArray=u||function(p){return c.call(p)=="[object Array]"};O.isObject=function(p){return p===Object(p)};O.isArguments=function(p){return c.call(p)=="[object Arguments]"};if(!O.isArguments(arguments)){O.isArguments=function(p){return !!(p&&O.has(p,"callee"))}}O.isFunction=function(p){return c.call(p)=="[object Function]"};O.isString=function(p){return c.call(p)=="[object String]"};O.isNumber=function(p){return c.call(p)=="[object Number]"};O.isFinite=function(p){return O.isNumber(p)&&isFinite(p)};O.isNaN=function(p){return p!==p};O.isBoolean=function(p){return p===true||p===false||c.call(p)=="[object Boolean]"};O.isDate=function(p){return c.call(p)=="[object Date]"};O.isRegExp=function(p){return c.call(p)=="[object RegExp]"};O.isNull=function(p){return p===null};O.isUndefined=function(p){return p===void 0};O.has=function(P,p){return h.call(P,p)};O.noConflict=function(){x._=k;return this};O.identity=function(p){return p};O.times=function(R,Q,P){for(var p=0;p<R;p++){Q.call(P,p)}};O.escape=function(p){return(""+p).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};O.result=function(p,Q){if(p==null){return null}var P=p[Q];return O.isFunction(P)?P.call(p):P};O.mixin=function(p){K(O.functions(p),function(P){y(P,O[P]=p[P])})};var z=0;O.uniqueId=function(p){var P=z++;return p?p+P:P};O.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var w=/.^/;var g={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"};for(var J in g){g[g[J]]=J}var j=/\\|'|\r|\n|\t|\u2028|\u2029/g;var D=/\\(\\|'|r|n|t|u2028|u2029)/g;var M=function(p){return p.replace(D,function(P,Q){return g[Q]})};O.template=function(T,S,Q){Q=O.defaults(Q||{},O.templateSettings);var R="__p+='"+T.replace(j,function(U){return"\\"+g[U]}).replace(Q.escape||w,function(U,V){return"'+\n_.escape("+M(V)+")+\n'"}).replace(Q.interpolate||w,function(U,V){return"'+\n("+M(V)+")+\n'"}).replace(Q.evaluate||w,function(U,V){return"';\n"+M(V)+"\n;__p+='"})+"';\n";if(!Q.variable){R="with(obj||{}){\n"+R+"}\n"}R="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+R+"return __p;\n";var P=new Function(Q.variable||"obj","_",R);if(S){return P(S,O)}var p=function(U){return P.call(this,U,O)};p.source="function("+(Q.variable||"obj")+"){\n"+R+"}";return p};O.chain=function(p){return O(p).chain()};var v=function(p){this._wrapped=p};O.prototype=v.prototype;var t=function(P,p){return p?O(P).chain():P};var y=function(p,P){v.prototype[p]=function(){var Q=n.call(arguments);B.call(Q,this._wrapped);return t(P.apply(O,Q),this._chain)}};O.mixin(O);K(["pop","push","reverse","shift","sort","splice","unshift"],function(p){var P=E[p];v.prototype[p]=function(){var Q=this._wrapped;P.apply(Q,arguments);var R=Q.length;if((p=="shift"||p=="splice")&&R===0){delete Q[0]}return t(Q,this._chain)}});K(["concat","join","slice"],function(p){var P=E[p];v.prototype[p]=function(){return t(P.apply(this._wrapped,arguments),this._chain)}});v.prototype.chain=function(){this._chain=true;return this};v.prototype.value=function(){return this._wrapped}}).call(this);!function(j,l){var c=l.prototype.trim;var b=l.prototype.trimRight;var g=l.prototype.trimLeft;var e=function(p){return p*1||0};var a=function(q,r){if(r<1){return""}var p="";while(r>0){if(r&1){p+=q}r>>=1,q+=q}return p};var m=[].slice;var k=function(p){if(p!=null){return"["+o.escapeRegExp(p)+"]"}return"\\s"};var f={lt:"<",gt:">",quot:'"',apos:"'",amp:"&"};var d={};for(var n in f){d[f[n]]=n}var h=(function(){function p(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}var q=a;var r=function(){if(!r.cache.hasOwnProperty(arguments[0])){r.cache[arguments[0]]=r.parse(arguments[0])}return r.format.call(null,r.cache[arguments[0]],arguments)};r.format=function(A,z){var E=1,C=A.length,w="",F,t=[],x,v,y,u,B,D;for(x=0;x<C;x++){w=p(A[x]);if(w==="string"){t.push(A[x])}else{if(w==="array"){y=A[x];if(y[2]){F=z[E];for(v=0;v<y[2].length;v++){if(!F.hasOwnProperty(y[2][v])){throw new Error(h('[_.sprintf] property "%s" does not exist',y[2][v]))}F=F[y[2][v]]}}else{if(y[1]){F=z[y[1]]}else{F=z[E++]}}if(/[^s]/.test(y[8])&&(p(F)!="number")){throw new Error(h("[_.sprintf] expecting number but found %s",p(F)))}switch(y[8]){case"b":F=F.toString(2);break;case"c":F=l.fromCharCode(F);break;case"d":F=parseInt(F,10);break;case"e":F=y[7]?F.toExponential(y[7]):F.toExponential();break;case"f":F=y[7]?parseFloat(F).toFixed(y[7]):parseFloat(F);break;case"o":F=F.toString(8);break;case"s":F=((F=l(F))&&y[7]?F.substring(0,y[7]):F);break;case"u":F=Math.abs(F);break;case"x":F=F.toString(16);break;case"X":F=F.toString(16).toUpperCase();break}F=(/[def]/.test(y[8])&&y[3]&&F>=0?"+"+F:F);B=y[4]?y[4]=="0"?"0":y[4].charAt(1):" ";D=y[6]-l(F).length;u=y[6]?q(B,D):"";t.push(y[5]?F+u:u+F)}}}return t.join("")};r.cache={};r.parse=function(t){var w=t,x=[],z=[],y=0;while(w){if((x=/^[^\x25]+/.exec(w))!==null){z.push(x[0])}else{if((x=/^\x25{2}/.exec(w))!==null){z.push("%")}else{if((x=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(w))!==null){if(x[2]){y|=1;var A=[],v=x[2],u=[];if((u=/^([a-z_][a-z_\d]*)/i.exec(v))!==null){A.push(u[1]);while((v=v.substring(u[0].length))!==""){if((u=/^\.([a-z_][a-z_\d]*)/i.exec(v))!==null){A.push(u[1])}else{if((u=/^\[(\d+)\]/.exec(v))!==null){A.push(u[1])}else{throw new Error("[_.sprintf] huh?")}}}}else{throw new Error("[_.sprintf] huh?")}x[2]=A}else{y|=2}if(y===3){throw new Error("[_.sprintf] mixing positional and named placeholders is not (yet) supported")}z.push(x)}else{throw new Error("[_.sprintf] huh?")}}}w=w.substring(x[0].length)}return z};return r})();var o={VERSION:"2.2.0rc",isBlank:function(p){if(p==null){p=""}return(/^\s*$/).test(p)},stripTags:function(p){if(p==null){return""}return l(p).replace(/<\/?[^>]+>/g,"")},capitalize:function(p){p=p==null?"":l(p);return p.charAt(0).toUpperCase()+p.slice(1)},chop:function(q,p){if(q==null){return[]}q=l(q);p=~~p;return p>0?q.match(new RegExp(".{1,"+p+"}","g")):[q]},clean:function(p){return o.strip(p).replace(/\s+/g," ")},count:function(q,p){if(q==null||p==null){return 0}return l(q).split(p).length-1},chars:function(p){if(p==null){return[]}return l(p).split("")},swapCase:function(p){if(p==null){return""}return l(p).replace(/\S/g,function(q){return q===q.toUpperCase()?q.toLowerCase():q.toUpperCase()})},escapeHTML:function(p){if(p==null){return""}return l(p).replace(/[&<>"']/g,function(q){return"&"+d[q]+";"})},unescapeHTML:function(p){if(p==null){return""}return l(p).replace(/\&([^;]+);/g,function(q,t){var r;if(t in f){return f[t]}else{if(r=t.match(/^#x([\da-fA-F]+)$/)){return l.fromCharCode(parseInt(r[1],16))}else{if(r=t.match(/^#(\d+)$/)){return l.fromCharCode(~~r[1])}else{return q}}}})},escapeRegExp:function(p){if(p==null){return""}return l(p).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")},splice:function(u,q,t,r){var p=o.chars(u);p.splice(~~q,~~t,r);return p.join("")},insert:function(r,p,q){return o.splice(r,p,0,q)},include:function(q,p){if(p===""){return true}if(q==null){return false}return l(q).indexOf(p)!==-1},join:function(){var p=m.call(arguments),q=p.shift();if(q==null){q=""}return p.join(q)},lines:function(p){if(p==null){return[]}return l(p).split("\n")},reverse:function(p){return o.chars(p).reverse().join("")},startsWith:function(q,p){if(p===""){return true}if(q==null||p==null){return false}q=l(q);p=l(p);return q.length>=p.length&&q.slice(0,p.length)===p},endsWith:function(q,p){if(p===""){return true}if(q==null||p==null){return false}q=l(q);p=l(p);return q.length>=p.length&&q.slice(q.length-p.length)===p},succ:function(p){if(p==null){return""}p=l(p);return p.slice(0,-1)+l.fromCharCode(p.charCodeAt(p.length-1)+1)},titleize:function(p){if(p==null){return""}return l(p).replace(/(?:^|\s)\S/g,function(q){return q.toUpperCase()})},camelize:function(p){return o.trim(p).replace(/[-_\s]+(.)?/g,function(q,r){return r.toUpperCase()})},underscored:function(p){return o.trim(p).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase()},dasherize:function(p){return o.trim(p).replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase()},classify:function(p){return o.titleize(l(p).replace(/_/g," ")).replace(/\s/g,"")},humanize:function(p){return o.capitalize(o.underscored(p).replace(/_id$/,"").replace(/_/g," "))},trim:function(q,p){if(q==null){return""}if(!p&&c){return c.call(q)}p=k(p);return l(q).replace(new RegExp("^"+p+"+|"+p+"+$","g"),"")},ltrim:function(q,p){if(q==null){return""}if(!p&&g){return g.call(q)}p=k(p);return l(q).replace(new RegExp("^"+p+"+"),"")},rtrim:function(q,p){if(q==null){return""}if(!p&&b){return b.call(q)}p=k(p);return l(q).replace(new RegExp(p+"+$"),"")},truncate:function(r,q,p){if(r==null){return""}r=l(r);p=p||"...";q=~~q;return r.length>q?r.slice(0,q)+p:r},prune:function(t,r,u){if(t==null){return""}t=l(t);r=~~r;u=u!=null?l(u):"...";if(t.length<=r){return t}var p=function(v){return v.toUpperCase()!==v.toLowerCase()?"A":" "},q=t.slice(0,r+1).replace(/.(?=\W*\w*$)/g,p);if(q.slice(q.length-2).match(/\w\w/)){q=q.replace(/\s*\S+$/,"")}else{q=o.rtrim(q.slice(0,q.length-1))}return(q+u).length>t.length?t:t.slice(0,q.length)+u},words:function(q,p){if(q==null||q==""){return""}return o.trim(q,p).split(p||/\s+/)},pad:function(u,r,p,q){u=u==null?"":l(u);r=~~r;var t=0;if(!p){p=" "}else{if(p.length>1){p=p.charAt(0)}}switch(q){case"right":t=r-u.length;return u+a(p,t);case"both":t=r-u.length;return a(p,Math.ceil(t/2))+u+a(p,Math.floor(t/2));default:t=r-u.length;return a(p,t)+u}},lpad:function(r,q,p){return o.pad(r,q,p)},rpad:function(r,q,p){return o.pad(r,q,p,"right")},lrpad:function(r,q,p){return o.pad(r,q,p,"both")},sprintf:h,vsprintf:function(q,p){p.unshift(q);return h.apply(null,p)},toNumber:function(r,p){if(r==null||r==""){return 0}r=l(r);var q=e(e(r).toFixed(~~p));return q===0&&!r.match(/^0+$/)?Number.NaN:q},numberFormat:function(t,w,p,u){if(isNaN(t)||t==null){return""}t=t.toFixed(~~w);u=u||",";var v=t.split("."),r=v[0],q=v[1]?(p||".")+v[1]:"";return r.replace(/(\d)(?=(?:\d{3})+$)/g,"$1"+u)+q},strRight:function(q,p){if(q==null){return""}q=l(q);p=p!=null?l(p):p;var r=!p?-1:q.indexOf(p);return ~r?q.slice(r+p.length,q.length):q},strRightBack:function(q,p){if(q==null){return""}q=l(q);p=p!=null?l(p):p;var r=!p?-1:q.lastIndexOf(p);return ~r?q.slice(r+p.length,q.length):q},strLeft:function(q,p){if(q==null){return""}q=l(q);p=p!=null?l(p):p;var r=!p?-1:q.indexOf(p);return ~r?q.slice(0,r):q},strLeftBack:function(q,p){if(q==null){return""}q+="";p=p!=null?""+p:p;var r=q.lastIndexOf(p);return ~r?q.slice(0,r):q},toSentence:function(u,t,q){t=t||", ";q=q||" and ";var p=u.slice(),r=p.pop();return p.length?p.join(t)+q+r:r},slugify:function(q){if(q==null){return""}var t="ąàáäâãćęèéëêìíïîłńòóöôõùúüûñçżź",r="aaaaaaceeeeeiiiilnooooouuuunczz",p=new RegExp(k(t),"g");q=l(q).toLowerCase().replace(p,function(v){var u=t.indexOf(v);return r.charAt(u)||"-"});return o.dasherize(q.replace(/[^\w\s-]/g,""))},surround:function(p,q){return[q,p,q].join("")},quote:function(p){return o.surround(p,'"')},exports:function(){var p={};for(var q in this){if(!this.hasOwnProperty(q)||q.match(/^(?:include|contains|reverse)$/)){continue}p[q]=this[q]}return p},repeat:function(r,t,q){if(r==null){return""}t=~~t;if(q==null){return a(l(r),t)}for(var p=[];t>0;p[--t]=r){}return p.join(q)},levenshtein:function(v,t){if(v==null&&t==null){return 0}if(v==null){return l(t).length}if(t==null){return l(v).length}v=l(v);t=l(t);var w=[],r,u;for(var q=0;q<=t.length;q++){for(var p=0;p<=v.length;p++){if(q&&p){if(v.charAt(p-1)===t.charAt(q-1)){u=r}else{u=Math.min(w[p],w[p-1],r)+1}}else{u=q+p}r=w[p];w[p]=u}}return w.pop()}};o.strip=o.trim;o.lstrip=o.ltrim;o.rstrip=o.rtrim;o.center=o.lrpad;o.rjust=o.lpad;o.ljust=o.rpad;o.contains=o.include;o.q=o.quote;if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){module.exports=o}exports._s=o}else{if(typeof define==="function"&&define.amd){define("underscore.string",[],function(){return o})}else{j._=j._||{};j._.string=j._.str=o}}}(this,String);(function(){var r=this;var p=r.Backbone;var q=Array.prototype.slice;var A=Array.prototype.splice;var c;if(typeof exports!=="undefined"){c=exports}else{c=r.Backbone={}}c.VERSION="0.9.2";var C=r._;if(!C&&(typeof require!=="undefined")){C=require("underscore")}var g=r.jQuery||r.Zepto||r.ender;c.setDomLibrary=function(E){g=E};c.noConflict=function(){r.Backbone=p;return this};c.emulateHTTP=false;c.emulateJSON=false;var a=/\s+/;var o=c.Events={on:function(H,L,G){var F,J,I,E,K;if(!L){return this}H=H.split(a);F=this._callbacks||(this._callbacks={});while(J=H.shift()){K=F[J];I=K?K.tail:{};I.next=E={};I.context=G;I.callback=L;F[J]={tail:E,next:K?K.next:I}}return this},off:function(L,J,F){var E,M,G,I,H,K;if(!(M=this._callbacks)){return}if(!(L||J||F)){delete this._callbacks;return this}L=L?L.split(a):C.keys(M);while(E=L.shift()){G=M[E];delete M[E];if(!G||!(J||F)){continue}I=G.tail;while((G=G.next)!==I){H=G.callback;K=G.context;if((J&&H!==J)||(F&&K!==F)){this.on(E,H,K)}}}return this},trigger:function(H){var L,K,G,F,E,J,I;if(!(G=this._callbacks)){return this}J=G.all;H=H.split(a);I=q.call(arguments,1);while(L=H.shift()){if(K=G[L]){F=K.tail;while((K=K.next)!==F){K.callback.apply(K.context||this,I)}}if(K=J){F=K.tail;E=[L].concat(I);while((K=K.next)!==F){K.callback.apply(K.context||this,E)}}}return this}};o.bind=o.on;o.unbind=o.off;var l=c.Model=function(E,F){var G;E||(E={});if(F&&F.parse){E=this.parse(E)}if(G=d(this,"defaults")){E=C.extend({},G,E)}if(F&&F.collection){this.collection=F.collection}this.attributes={};this._escapedAttributes={};this.cid=C.uniqueId("c");this.changed={};this._silent={};this._pending={};this.set(E,{silent:true});this.changed={};this._silent={};this._pending={};this._previousAttributes=C.clone(this.attributes);this.initialize.apply(this,arguments)};C.extend(l.prototype,o,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(E){return C.clone(this.attributes)},get:function(E){return this.attributes[E]},escape:function(E){var F;if(F=this._escapedAttributes[E]){return F}var G=this.get(E);return this._escapedAttributes[E]=C.escape(G==null?"":""+G)},has:function(E){return this.get(E)!=null},set:function(L,K,N){var M,I,G;if(C.isObject(L)||L==null){M=L;N=K}else{M={};M[L]=K}N||(N={});if(!M){return this}if(M instanceof l){M=M.attributes}if(N.unset){for(I in M){M[I]=void 0}}if(!this._validate(M,N)){return false}if(this.idAttribute in M){this.id=M[this.idAttribute]}var J=N.changes={};var F=this.attributes;var E=this._escapedAttributes;var H=this._previousAttributes||{};for(I in M){G=M[I];if(!C.isEqual(F[I],G)||(N.unset&&C.has(F,I))){delete E[I];(N.silent?this._silent:J)[I]=true}N.unset?delete F[I]:F[I]=G;if(!C.isEqual(H[I],G)||(C.has(F,I)!=C.has(H,I))){this.changed[I]=G;if(!N.silent){this._pending[I]=true}}else{delete this.changed[I];delete this._pending[I]}}if(!N.silent){this.change(N)}return this},unset:function(E,F){(F||(F={})).unset=true;return this.set(E,null,F)},clear:function(E){(E||(E={})).unset=true;return this.set(C.clone(this.attributes),E)},fetch:function(F){F=F?C.clone(F):{};var E=this;var G=F.success;F.success=function(J,H,I){if(!E.set(E.parse(J,I),F)){return false}if(G){G(E,J)}};F.error=c.wrapError(F.error,E,F);return(this.sync||c.sync).call(this,"read",this,F)},save:function(J,I,N){var K,H;if(C.isObject(J)||J==null){K=J;N=I}else{K={};K[J]=I}N=N?C.clone(N):{};if(N.wait){if(!this._validate(K,N)){return false}H=C.clone(this.attributes)}var F=C.extend({},N,{silent:true});if(K&&!this.set(K,N.wait?F:N)){return false}var G=this;var L=N.success;N.success=function(R,O,Q){var P=G.parse(R,Q);if(N.wait){delete N.wait;P=C.extend(K||{},P)}if(!G.set(P,N)){return false}if(L){L(G,R)}else{G.trigger("sync",G,R,N)}};N.error=c.wrapError(N.error,G,N);var E=this.isNew()?"create":"update";var M=(this.sync||c.sync).call(this,E,this,N);if(N.wait){this.set(H,F)}return M},destroy:function(F){F=F?C.clone(F):{};var E=this;var I=F.success;var H=function(){E.trigger("destroy",E,E.collection,F)};if(this.isNew()){H();return false}F.success=function(J){if(F.wait){H()}if(I){I(E,J)}else{E.trigger("sync",E,J,F)}};F.error=c.wrapError(F.error,E,F);var G=(this.sync||c.sync).call(this,"delete",this,F);if(!F.wait){H()}return G},url:function(){var E=d(this,"urlRoot")||d(this.collection,"url")||v();if(this.isNew()){return E}return E+(E.charAt(E.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(F,E){return F},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(F){F||(F={});var H=this._changing;this._changing=true;for(var E in this._silent){this._pending[E]=true}var G=C.extend({},F.changes,this._silent);this._silent={};for(var E in G){this.trigger("change:"+E,this,this.get(E),F)}if(H){return this}while(!C.isEmpty(this._pending)){this._pending={};this.trigger("change",this,F);for(var E in this.changed){if(this._pending[E]||this._silent[E]){continue}delete this.changed[E]}this._previousAttributes=C.clone(this.attributes)}this._changing=false;return this},hasChanged:function(E){if(!arguments.length){return !C.isEmpty(this.changed)}return C.has(this.changed,E)},changedAttributes:function(G){if(!G){return this.hasChanged()?C.clone(this.changed):false}var I,H=false,F=this._previousAttributes;for(var E in G){if(C.isEqual(F[E],(I=G[E]))){continue}(H||(H={}))[E]=I}return H},previous:function(E){if(!arguments.length||!this._previousAttributes){return null}return this._previousAttributes[E]},previousAttributes:function(){return C.clone(this._previousAttributes)},isValid:function(){return !this.validate(this.attributes)},_validate:function(G,F){if(F.silent||!this.validate){return true}G=C.extend({},this.attributes,G);var E=this.validate(G,F);if(!E){return true}if(F&&F.error){F.error(this,E,F)}else{this.trigger("error",this,E,F)}return false}});var D=c.Collection=function(F,E){E||(E={});if(E.model){this.model=E.model}if(E.comparator){this.comparator=E.comparator}this._reset();this.initialize.apply(this,arguments);if(F){this.reset(F,{silent:true,parse:E.parse})}};C.extend(D.prototype,o,{model:l,initialize:function(){},toJSON:function(E){return this.map(function(F){return F.toJSON(E)})},add:function(F,O){var K,M,H,L,N,G,I={},E={},J=[];O||(O={});F=C.isArray(F)?F.slice():[F];for(K=0,H=F.length;K<H;K++){if(!(L=F[K]=this._prepareModel(F[K],O))){throw new Error("Can't add an invalid model to a collection")}N=L.cid;G=L.id;if(I[N]||this._byCid[N]||((G!=null)&&(E[G]||this._byId[G]))){J.push(K);continue}I[N]=E[G]=L}K=J.length;while(K--){F.splice(J[K],1)}for(K=0,H=F.length;K<H;K++){(L=F[K]).on("all",this._onModelEvent,this);this._byCid[L.cid]=L;if(L.id!=null){this._byId[L.id]=L}}this.length+=H;M=O.at!=null?O.at:this.models.length;A.apply(this.models,[M,0].concat(F));if(this.comparator){this.sort({silent:true})}if(O.silent){return this}for(K=0,H=this.models.length;K<H;K++){if(!I[(L=this.models[K]).cid]){continue}O.index=K;L.trigger("add",L,this,O)}return this},remove:function(J,H){var I,E,G,F;H||(H={});J=C.isArray(J)?J.slice():[J];for(I=0,E=J.length;I<E;I++){F=this.getByCid(J[I])||this.get(J[I]);if(!F){continue}delete this._byId[F.id];delete this._byCid[F.cid];G=this.indexOf(F);this.models.splice(G,1);this.length--;if(!H.silent){H.index=G;F.trigger("remove",F,this,H)}this._removeReference(F)}return this},push:function(F,E){F=this._prepareModel(F,E);this.add(F,E);return F},pop:function(F){var E=this.at(this.length-1);this.remove(E,F);return E},unshift:function(F,E){F=this._prepareModel(F,E);this.add(F,C.extend({at:0},E));return F},shift:function(F){var E=this.at(0);this.remove(E,F);return E},get:function(E){if(E==null){return void 0}return this._byId[E.id!=null?E.id:E]},getByCid:function(E){return E&&this._byCid[E.cid||E]},at:function(E){return this.models[E]},where:function(E){if(C.isEmpty(E)){return[]}return this.filter(function(F){for(var G in E){if(E[G]!==F.get(G)){return false}}return true})},sort:function(F){F||(F={});if(!this.comparator){throw new Error("Cannot sort a set without a comparator")}var E=C.bind(this.comparator,this);if(this.comparator.length==1){this.models=this.sortBy(E)}else{this.models.sort(E)}if(!F.silent){this.trigger("reset",this,F)}return this},pluck:function(E){return C.map(this.models,function(F){return F.get(E)})},reset:function(H,F){H||(H=[]);F||(F={});for(var G=0,E=this.models.length;G<E;G++){this._removeReference(this.models[G])}this._reset();this.add(H,C.extend({silent:true},F));if(!F.silent){this.trigger("reset",this,F)}return this},fetch:function(E){E=E?C.clone(E):{};if(E.parse===undefined){E.parse=true}var G=this;var F=E.success;E.success=function(J,H,I){G[E.add?"add":"reset"](G.parse(J,I),E);if(F){F(G,J)}};E.error=c.wrapError(E.error,G,E);return(this.sync||c.sync).call(this,"read",this,E)},create:function(F,E){var G=this;E=E?C.clone(E):{};F=this._prepareModel(F,E);if(!F){return false}if(!E.wait){G.add(F,E)}var H=E.success;E.success=function(I,K,J){if(E.wait){G.add(I,E)}if(H){H(I,K)}else{I.trigger("sync",F,K,E)}};F.save(null,E);return F},parse:function(F,E){return F},chain:function(){return C(this.models).chain()},_reset:function(E){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(G,F){F||(F={});if(!(G instanceof l)){var E=G;F.collection=this;G=new this.model(E,F);if(!G._validate(G.attributes,F)){G=false}}else{if(!G.collection){G.collection=this}}return G},_removeReference:function(E){if(this==E.collection){delete E.collection}E.off("all",this._onModelEvent,this)},_onModelEvent:function(G,F,H,E){if((G=="add"||G=="remove")&&H!=this){return}if(G=="destroy"){this.remove(F,E)}if(F&&G==="change:"+F.idAttribute){delete this._byId[F.previous(F.idAttribute)];this._byId[F.id]=F}this.trigger.apply(this,arguments)}});var y=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];C.each(y,function(E){D.prototype[E]=function(){return C[E].apply(C,[this.models].concat(C.toArray(arguments)))}});var B=c.Router=function(E){E||(E={});if(E.routes){this.routes=E.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var j=/:\w+/g;var z=/\*\w+/g;var e=/[-[\]{}()+?.,\\^$|#\s]/g;C.extend(B.prototype,o,{initialize:function(){},route:function(E,F,G){c.history||(c.history=new b);if(!C.isRegExp(E)){E=this._routeToRegExp(E)}if(!G){G=this[F]}c.history.route(E,C.bind(function(I){var H=this._extractParameters(E,I);G&&G.apply(this,H);this.trigger.apply(this,["route:"+F].concat(H));c.history.trigger("route",this,F,H)},this));return this},navigate:function(F,E){c.history.navigate(F,E)},_bindRoutes:function(){if(!this.routes){return}var F=[];for(var G in this.routes){F.unshift([G,this.routes[G]])}for(var H=0,E=F.length;H<E;H++){this.route(F[H][0],F[H][1],this[F[H][1]])}},_routeToRegExp:function(E){E=E.replace(e,"\\$&").replace(j,"([^/]+)").replace(z,"(.*?)");return new RegExp("^"+E+"$")},_extractParameters:function(E,F){return E.exec(F).slice(1)}});var b=c.History=function(){this.handlers=[];C.bindAll(this,"checkUrl")};var n=/^[#\/]/;var k=/msie [\w.]+/;b.started=false;C.extend(b.prototype,o,{interval:50,getHash:function(G){var F=G?G.location:window.location;var E=F.href.match(/#(.*)$/);return E?E[1]:""},getFragment:function(F,E){if(F==null){if(this._hasPushState||E){F=window.location.pathname;var G=window.location.search;if(G){F+=G}}else{F=this.getHash()}}if(!F.indexOf(this.options.root)){F=F.substr(this.options.root.length)}return F.replace(n,"")},start:function(G){if(b.started){throw new Error("Backbone.history has already been started")}b.started=true;this.options=C.extend({},{root:"/"},this.options,G);this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var F=this.getFragment();var E=document.documentMode;var I=(k.exec(navigator.userAgent.toLowerCase())&&(!E||E<=7));if(I){this.iframe=g('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(F)}if(this._hasPushState){g(window).bind("popstate",this.checkUrl)}else{if(this._wantsHashChange&&("onhashchange" in window)&&!I){g(window).bind("hashchange",this.checkUrl)}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}}}this.fragment=F;var J=window.location;var H=J.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!H){this.fragment=this.getFragment(null,true);window.location.replace(this.options.root+"#"+this.fragment);return true}else{if(this._wantsPushState&&this._hasPushState&&H&&J.hash){this.fragment=this.getHash().replace(n,"");window.history.replaceState({},document.title,J.protocol+"//"+J.host+this.options.root+this.fragment)}}if(!this.options.silent){return this.loadUrl()}},stop:function(){g(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);b.started=false},route:function(E,F){this.handlers.unshift({route:E,callback:F})},checkUrl:function(F){var E=this.getFragment();if(E==this.fragment&&this.iframe){E=this.getFragment(this.getHash(this.iframe))}if(E==this.fragment){return false}if(this.iframe){this.navigate(E)}this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(G){var F=this.fragment=this.getFragment(G);var E=C.any(this.handlers,function(H){if(H.route.test(F)){H.callback(F);return true}});return E},navigate:function(F,E){if(!b.started){return false}if(!E||E===true){E={trigger:E}}var G=(F||"").replace(n,"");if(this.fragment==G){return}if(this._hasPushState){if(G.indexOf(this.options.root)!=0){G=this.options.root+G}this.fragment=G;window.history[E.replace?"replaceState":"pushState"]({},document.title,G)}else{if(this._wantsHashChange){this.fragment=G;this._updateHash(window.location,G,E.replace);if(this.iframe&&(G!=this.getFragment(this.getHash(this.iframe)))){if(!E.replace){this.iframe.document.open().close()}this._updateHash(this.iframe.location,G,E.replace)}}else{window.location.assign(this.options.root+F)}}if(E.trigger){this.loadUrl(F)}},_updateHash:function(E,F,G){if(G){E.replace(E.toString().replace(/(javascript:|#).*$/,"")+"#"+F)}else{E.hash=F}}});var u=c.View=function(E){this.cid=C.uniqueId("view");this._configure(E||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var f=/^(\S+)\s*(.*)$/;var w=["model","collection","el","id","attributes","className","tagName"];C.extend(u.prototype,o,{tagName:"div",$:function(E){return this.$el.find(E)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();return this},make:function(F,E,H){var G=document.createElement(F);if(E){g(G).attr(E)}if(H){g(G).html(H)}return G},setElement:function(E,F){if(this.$el){this.undelegateEvents()}this.$el=(E instanceof g)?E:g(E);this.el=this.$el[0];if(F!==false){this.delegateEvents()}return this},delegateEvents:function(I){if(!(I||(I=d(this,"events")))){return}this.undelegateEvents();for(var H in I){var J=I[H];if(!C.isFunction(J)){J=this[I[H]]}if(!J){throw new Error('Method "'+I[H]+'" does not exist')}var G=H.match(f);var F=G[1],E=G[2];J=C.bind(J,this);F+=".delegateEvents"+this.cid;if(E===""){this.$el.bind(F,J)}else{this.$el.delegate(E,F,J)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(G){if(this.options){G=C.extend({},this.options,G)}for(var H=0,F=w.length;H<F;H++){var E=w[H];if(G[E]){this[E]=G[E]}}this.options=G},_ensureElement:function(){if(!this.el){var E=d(this,"attributes")||{};if(this.id){E.id=this.id}if(this.className){E["class"]=this.className}this.setElement(this.make(this.tagName,E),false)}else{this.setElement(this.el,false)}}});var x=function(E,F){var G=m(this,E,F);G.extend=this.extend;return G};l.extend=D.extend=B.extend=u.extend=x;var t={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};c.sync=function(I,F,E){var G=t[I];E||(E={});var H={type:G,dataType:"json"};if(!E.url){H.url=d(F,"url")||v()}if(!E.data&&F&&(I=="create"||I=="update")){H.contentType="application/json";H.data=JSON.stringify(F.toJSON())}if(c.emulateJSON){H.contentType="application/x-www-form-urlencoded";H.data=F.toJSON()}if(c.emulateHTTP){if(G==="PUT"||G==="DELETE"){if(c.emulateJSON){H.data._method=G}H.type="POST";H.beforeSend=function(J){J.setRequestHeader("X-HTTP-Method-Override",G)}}}if(H.type!=="GET"&&!c.emulateJSON){H.processData=false}return g.ajax(C.extend(H,E))};c.wrapError=function(F,G,E){return function(H,I){I=H===G?I:H;if(F){F(G,I,E)}else{G.trigger("error",G,I,E)}}};var h=function(){};var m=function(F,E,G){var H;if(E&&E.hasOwnProperty("constructor")){H=E.constructor}else{H=function(){F.apply(this,arguments)}}C.extend(H,F);h.prototype=F.prototype;H.prototype=new h();if(E){C.extend(H.prototype,E)}if(G){C.extend(H,G)}H.prototype.constructor=H;H.__super__=F.prototype;return H};var d=function(E,F){if(!(E&&E[F])){return null}return C.isFunction(E[F])?E[F]():E[F]};var v=function(){throw new Error('A "url" property or function must be specified')}}).call(this);(function(c){function b(f,e){return(typeof f=="function")?(f.call(e)):f}function d(e){while(e=e.parentNode){if(e==document){return true}}return false}function a(f,e){this.$element=c(f);this.options=e;this.enabled=true;this.fixTitle()}a.prototype={show:function(){var h=this.getTitle();if(h&&this.enabled){var g=this.tip();g.find(".tipsy-inner")[this.options.html?"html":"text"](h);g[0].className="tipsy";g.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).prependTo(document.body);var l=c.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight});var e=g[0].offsetWidth,k=g[0].offsetHeight,j=b(this.options.gravity,this.$element[0]);var f;switch(j.charAt(0)){case"n":f={top:l.top+l.height+this.options.offset,left:l.left+l.width/2-e/2};break;case"s":f={top:l.top-k-this.options.offset,left:l.left+l.width/2-e/2};break;case"e":f={top:l.top+l.height/2-k/2,left:l.left-e-this.options.offset};break;case"w":f={top:l.top+l.height/2-k/2,left:l.left+l.width+this.options.offset};break}if(j.length==2){if(j.charAt(1)=="w"){f.left=l.left+l.width/2-15}else{f.left=l.left+l.width/2-e+15}}g.css(f).addClass("tipsy-"+j);g.find(".tipsy-arrow")[0].className="tipsy-arrow tipsy-arrow-"+j.charAt(0);if(this.options.className){g.addClass(b(this.options.className,this.$element[0]))}if(this.options.fade){g.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity})}else{g.css({visibility:"visible",opacity:this.options.opacity})}}},hide:function(){if(this.options.fade){this.tip().stop().fadeOut(function(){c(this).remove()})}else{this.tip().remove()}},fixTitle:function(){var e=this.$element;if(e.attr("title")||typeof(e.attr("original-title"))!="string"){e.attr("original-title",e.attr("title")||"").removeAttr("title")}},getTitle:function(){var g,e=this.$element,f=this.options;this.fixTitle();var g,f=this.options;if(typeof f.title=="string"){g=e.attr(f.title=="title"?"original-title":f.title)}else{if(typeof f.title=="function"){g=f.title.call(e[0])}}g=(""+g).replace(/(^\s*|\s*$)/,"");return g||f.fallback},tip:function(){if(!this.$tip){this.$tip=c('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>');this.$tip.data("tipsy-pointee",this.$element[0])}return this.$tip},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled}};c.fn.tipsy=function(j){if(j===true){return this.data("tipsy")}else{if(typeof j=="string"){var l=this.data("tipsy");if(l){l[j]()}return this}}j=c.extend({},c.fn.tipsy.defaults,j);function h(n){var o=c.data(n,"tipsy");if(!o){o=new a(n,c.fn.tipsy.elementOptions(n,j));c.data(n,"tipsy",o)}return o}function m(){var n=h(this);n.hoverState="in";if(j.delayIn==0){n.show()}else{n.fixTitle();setTimeout(function(){if(n.hoverState=="in"){n.show()}},j.delayIn)}}function g(){var n=h(this);n.hoverState="out";if(j.delayOut==0){n.hide()}else{setTimeout(function(){if(n.hoverState=="out"){n.hide()}},j.delayOut)}}if(!j.live){this.each(function(){h(this)})}if(j.trigger!="manual"){var e=j.live?"live":"bind",k=j.trigger=="hover"?"mouseenter":"focus",f=j.trigger=="hover"?"mouseleave":"blur";this[e](k,m)[e](f,g)}return this};c.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:false,fallback:"",gravity:"n",html:false,live:false,offset:0,opacity:0.8,title:"title",trigger:"hover"};c.fn.tipsy.revalidate=function(){c(".tipsy").each(function(){var e=c.data(this,"tipsy-pointee");if(!e||!d(e)){c(this).remove()}})};c.fn.tipsy.elementOptions=function(f,e){return c.metadata?c.extend({},e,c(f).metadata()):e};c.fn.tipsy.autoNS=function(){return c(this).offset().top>(c(document).scrollTop()+c(window).height()/2)?"s":"n"};c.fn.tipsy.autoWE=function(){return c(this).offset().left>(c(document).scrollLeft()+c(window).width()/2)?"e":"w"};c.fn.tipsy.autoBounds=function(f,e){return function(){var g={ns:e[0],ew:(e.length>1?e[1]:false)},k=c(document).scrollTop()+f,h=c(document).scrollLeft()+f,j=c(this);if(j.offset().top<k){g.ns="n"}if(j.offset().left<h){g.ew="w"}if(c(window).width()+c(document).scrollLeft()-j.offset().left<f){g.ew="e"}if(c(window).height()+c(document).scrollTop()-j.offset().top<f){g.ns="s"}return g.ns+(g.ew?g.ew:"")}}})(jQuery);(function(e){if(e.Base64){return}var f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var c=function(v){var u={};for(var r=0,q=v.length;r<q;r++){u[v.charAt(r)]=r}return u}(f);var h=function(q){var r=(q.charCodeAt(0)<<16)|(q.charCodeAt(1)<<8)|(q.charCodeAt(2));return f.charAt(r>>>18)+f.charAt((r>>>12)&63)+f.charAt((r>>>6)&63)+f.charAt(r&63)};var p=function(r){if(r.match(/[^\x00-\xFF]/)){throw"unsupported character found"}var t=0;while(r.length%3){r+="\0";t++}var q=r.replace(/[\x00-\xFF]{3}/g,h);if(!t){return q}q=q.substr(0,q.length-t);while(t--){q+="="}return q};var m=e.btoa||p;var l=function(q){var r=(c[q.charAt(0)]<<18)|(c[q.charAt(1)]<<12)|(c[q.charAt(2)]<<6)|(c[q.charAt(3)]);return String.fromCharCode(r>>16)+String.fromCharCode((r>>8)&255)+String.fromCharCode(r&255)};var b=function(r){r=r.replace(/[^A-Za-z0-9\+\/]/g,"");var t=0;while(r.length%4){r+="A";t++}var q=r.replace(/[A-Za-z0-9\+\/]{4}/g,l);if(t>=2){q=q.substring(0,q.length-[0,0,2,1][t])}return q};var a=e.atob||b;var d=/[^\x00-\x7F]/g;var o=function(q){var r=q.charCodeAt(0);return r<2048?String.fromCharCode(192|(r>>>6))+String.fromCharCode(128|(r&63)):String.fromCharCode(224|((r>>>12)&15))+String.fromCharCode(128|((r>>>6)&63))+String.fromCharCode(128|(r&63))};var k=function(q){return q.replace(d,o)};var g=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g;var j=function(q){var u=q.charCodeAt(0);var t=q.charCodeAt(1);if(u<224){return String.fromCharCode(((u&31)<<6)|(t&63))}else{var r=q.charCodeAt(2);return String.fromCharCode(((u&15)<<12)|((t&63)<<6)|(r&63))}};var n=function(q){return q.replace(g,j)};e.Base64={fromBase64:b,toBase64:p,atob:a,btoa:m,utob:k,btou:n,encode:function(q){return m(k(q))},encodeURI:function(q){return m(k(q)).replace(/[+\/]/g,function(r){return r=="+"?"-":"_"}).replace(/=+$/,"")},decode:function(q){return n(a(q.replace(/[-_]/g,function(r){return r=="-"?"+":"/"})))}}})(this);(function(){var am=32768;var aV=0;var e=1;var bq=2;var bh=6;var P=true;var a7=32768;var bf=64;var bv=1024*8;var aZ=2*am;var Z=3;var bu=258;var D=16;var W=8192;var g=13;if(W>a7){alert("error: zip_INBUFSIZ is too small")}if((am<<1)>(1<<D)){alert("error: zip_WSIZE is too large")}if(g>D-1){alert("error: zip_HASH_BITS is too large")}if(g<8||bu!=258){alert("error: Code too clever")}var a3=W;var aw=1<<g;var a8=aw-1;var aU=am-1;var U=0;var X=4096;var bs=bu+Z+1;var B=am-bs;var q=1;var bA=15;var aN=7;var aC=29;var M=256;var R=256;var an=M+1+aC;var bp=30;var u=19;var bi=16;var aT=17;var bw=18;var bo=2*an+1;var aF=parseInt((g+Z-1)/Z);var at;var bz,j;var N;var a1=null;var a6,a5;var d;var bn;var c;var ap;var A;var al;var ar;var a9;var ak;var r;var ab;var ac;var aH;var bj;var Q;var t;var z;var aa;var K;var aE;var l;var o;var H;var aW;var F;var m;var av;var ah;var G;var k;var E;var bd;var f;var n;var aK;var bm;var Y;var br;var bt;var aB;var O;var a;var ay;var aY;var I;var y;var af;var aS;var bg;var b;var bC=function(){this.fc=0;this.dl=0};var p=function(){this.dyn_tree=null;this.static_tree=null;this.extra_bits=null;this.extra_base=0;this.elems=0;this.max_length=0;this.max_code=0};var T=function(bH,bG,bJ,bI){this.good_length=bH;this.max_lazy=bG;this.nice_length=bJ;this.max_chain=bI};var bk=function(){this.next=null;this.len=0;this.ptr=new Array(bv);this.off=0};var aG=new Array(0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0);var w=new Array(0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13);var L=new Array(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7);var aI=new Array(16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15);var aR=new Array(new T(0,0,0,0),new T(4,4,8,4),new T(4,5,16,8),new T(4,6,32,32),new T(4,4,16,16),new T(8,16,32,32),new T(8,16,128,128),new T(8,32,128,256),new T(32,128,258,1024),new T(32,258,258,4096));var ad=function(bH){var bG;if(!bH){bH=bh}else{if(bH<1){bH=1}else{if(bH>9){bH=9}}}l=bH;N=false;z=false;if(a1!=null){return}at=bz=j=null;a1=new Array(bv);bn=new Array(aZ);c=new Array(a3);ap=new Array(a7+bf);A=new Array(1<<D);aW=new Array(bo);for(bG=0;bG<bo;bG++){aW[bG]=new bC()}F=new Array(2*bp+1);for(bG=0;bG<2*bp+1;bG++){F[bG]=new bC()}m=new Array(an+2);for(bG=0;bG<an+2;bG++){m[bG]=new bC()}av=new Array(bp);for(bG=0;bG<bp;bG++){av[bG]=new bC()}ah=new Array(2*u+1);for(bG=0;bG<2*u+1;bG++){ah[bG]=new bC()}G=new p();k=new p();E=new p();bd=new Array(bA+1);f=new Array(2*an+1);bm=new Array(2*an+1);Y=new Array(bu-Z+1);br=new Array(512);bt=new Array(aC);aB=new Array(bp);O=new Array(parseInt(W/8))};var aA=function(){at=bz=j=null;a1=null;bn=null;c=null;ap=null;A=null;aW=null;F=null;m=null;av=null;ah=null;G=null;k=null;E=null;bd=null;f=null;bm=null;Y=null;br=null;bt=null;aB=null;O=null};var ax=function(bG){bG.next=at;at=bG};var V=function(){var bG;if(at!=null){bG=at;at=at.next}else{bG=new bk()}bG.next=null;bG.len=bG.off=0;return bG};var aj=function(bG){return A[am+bG]};var ai=function(bG,bH){return A[am+bG]=bH};var S=function(bG){a1[a5+a6++]=bG;if(a5+a6==bv){h()}};var aP=function(bG){bG&=65535;if(a5+a6<bv-2){a1[a5+a6++]=(bG&255);a1[a5+a6++]=(bG>>>8)}else{S(bG&255);S(bG>>>8)}};var aD=function(){ak=((ak<<aF)^(bn[Q+Z-1]&255))&a8;r=aj(ak);A[Q&aU]=r;ai(ak,Q)};var be=function(bH,bG){bx(bG[bH].fc,bG[bH].dl)};var aM=function(bG){return(bG<256?br[bG]:br[256+(bG>>7)])&255};var ag=function(bH,bI,bG){return bH[bI].fc<bH[bG].fc||(bH[bI].fc==bH[bG].fc&&bm[bI]<=bm[bG])};var bc=function(bJ,bH,bI){var bG;for(bG=0;bG<bI&&b<bg.length;bG++){bJ[bH+bG]=bg.charCodeAt(b++)&255}return bG};var bB=function(){var bG;for(bG=0;bG<aw;bG++){A[am+bG]=0}aE=aR[l].max_lazy;o=aR[l].good_length;if(!P){H=aR[l].nice_length}K=aR[l].max_chain;Q=0;a9=0;aa=bc(bn,0,2*am);if(aa<=0){z=true;aa=0;return}z=false;while(aa<bs&&!z){ae()}ak=0;for(bG=0;bG<Z-1;bG++){ak=((ak<<aF)^(bn[bG]&255))&a8}};var bb=function(bL){var bN=K;var bI=Q;var bJ;var bM;var bH=bj;var bK=(Q>B?Q-B:U);var bG=Q+bu;var bP=bn[bI+bH-1];var bO=bn[bI+bH];if(bj>=o){bN>>=2}do{bJ=bL;if(bn[bJ+bH]!=bO||bn[bJ+bH-1]!=bP||bn[bJ]!=bn[bI]||bn[++bJ]!=bn[bI+1]){continue}bI+=2;bJ++;do{}while(bn[++bI]==bn[++bJ]&&bn[++bI]==bn[++bJ]&&bn[++bI]==bn[++bJ]&&bn[++bI]==bn[++bJ]&&bn[++bI]==bn[++bJ]&&bn[++bI]==bn[++bJ]&&bn[++bI]==bn[++bJ]&&bn[++bI]==bn[++bJ]&&bI<bG);bM=bu-(bG-bI);bI=bG-bu;if(bM>bH){t=bL;bH=bM;if(P){if(bM>=bu){break}}else{if(bM>=H){break}}bP=bn[bI+bH-1];bO=bn[bI+bH]}}while((bL=A[bL&aU])>bK&&--bN!=0);return bH};var ae=function(){var bI,bG;var bH=aZ-aa-Q;if(bH==-1){bH--}else{if(Q>=am+B){for(bI=0;bI<am;bI++){bn[bI]=bn[bI+am]}t-=am;Q-=am;a9-=am;for(bI=0;bI<aw;bI++){bG=aj(bI);ai(bI,bG>=am?bG-am:U)}for(bI=0;bI<am;bI++){bG=A[bI];A[bI]=(bG>=am?bG-am:U)}bH+=am}}if(!z){bI=bc(bn,Q+aa,bH);if(bI<=0){z=true}else{aa+=bI}}};var by=function(){while(aa!=0&&bz==null){var bG;aD();if(r!=U&&Q-r<=B){aH=bb(r);if(aH>aa){aH=aa}}if(aH>=Z){bG=bl(Q-t,aH-Z);aa-=aH;if(aH<=aE){aH--;do{Q++;aD()}while(--aH!=0);Q++}else{Q+=aH;aH=0;ak=bn[Q]&255;ak=((ak<<aF)^(bn[Q+1]&255))&a8}}else{bG=bl(0,bn[Q]&255);aa--;Q++}if(bG){v(0);a9=Q}while(aa<bs&&!z){ae()}}};var aX=function(){while(aa!=0&&bz==null){aD();bj=aH;ab=t;aH=Z-1;if(r!=U&&bj<aE&&Q-r<=B){aH=bb(r);if(aH>aa){aH=aa}if(aH==Z&&Q-t>X){aH--}}if(bj>=Z&&aH<=bj){var bG;bG=bl(Q-1-ab,bj-Z);aa-=bj-1;bj-=2;do{Q++;aD()}while(--bj!=0);ac=0;aH=Z-1;Q++;if(bG){v(0);a9=Q}}else{if(ac!=0){if(bl(0,bn[Q-1]&255)){v(0);a9=Q}Q++;aa--}else{ac=1;Q++;aa--}}while(aa<bs&&!z){ae()}}};var aL=function(){if(z){return}al=0;ar=0;a0();bB();bz=null;a6=0;a5=0;if(l<=3){bj=Z-1;aH=0}else{aH=Z-1;ac=0}d=false};var x=function(bJ,bH,bG){var bI;if(!N){aL();N=true;if(aa==0){d=true;return 0}}if((bI=bD(bJ,bH,bG))==bG){return bG}if(d){return bI}if(l<=3){by()}else{aX()}if(aa==0){if(ac!=0){bl(0,bn[Q-1]&255)}v(1);d=true}return bI+bD(bJ,bI+bH,bG-bI)};var bD=function(bM,bK,bH){var bL,bI,bG;bL=0;while(bz!=null&&bL<bH){bI=bH-bL;if(bI>bz.len){bI=bz.len}for(bG=0;bG<bI;bG++){bM[bK+bL+bG]=bz.ptr[bz.off+bG]}bz.off+=bI;bz.len-=bI;bL+=bI;if(bz.len==0){var bJ;bJ=bz;bz=bz.next;ax(bJ)}}if(bL==bH){return bL}if(a5<a6){bI=bH-bL;if(bI>a6-a5){bI=a6-a5}for(bG=0;bG<bI;bG++){bM[bK+bL+bG]=a1[a5+bG]}a5+=bI;bL+=bI;if(a6==a5){a6=a5=0}}return bL};var a0=function(){var bK;var bI;var bH;var bG;var bJ;if(av[0].dl!=0){return}G.dyn_tree=aW;G.static_tree=m;G.extra_bits=aG;G.extra_base=M+1;G.elems=an;G.max_length=bA;G.max_code=0;k.dyn_tree=F;k.static_tree=av;k.extra_bits=w;k.extra_base=0;k.elems=bp;k.max_length=bA;k.max_code=0;E.dyn_tree=ah;E.static_tree=null;E.extra_bits=L;E.extra_base=0;E.elems=u;E.max_length=aN;E.max_code=0;bH=0;for(bG=0;bG<aC-1;bG++){bt[bG]=bH;for(bK=0;bK<(1<<aG[bG]);bK++){Y[bH++]=bG}}Y[bH-1]=bG;bJ=0;for(bG=0;bG<16;bG++){aB[bG]=bJ;for(bK=0;bK<(1<<w[bG]);bK++){br[bJ++]=bG}}bJ>>=7;for(;bG<bp;bG++){aB[bG]=bJ<<7;for(bK=0;bK<(1<<(w[bG]-7));bK++){br[256+bJ++]=bG}}for(bI=0;bI<=bA;bI++){bd[bI]=0}bK=0;while(bK<=143){m[bK++].dl=8;bd[8]++}while(bK<=255){m[bK++].dl=9;bd[9]++}while(bK<=279){m[bK++].dl=7;bd[7]++}while(bK<=287){m[bK++].dl=8;bd[8]++}a4(m,an+1);for(bK=0;bK<bp;bK++){av[bK].dl=5;av[bK].fc=aq(bK,5)}au()};var au=function(){var bG;for(bG=0;bG<an;bG++){aW[bG].fc=0}for(bG=0;bG<bp;bG++){F[bG].fc=0}for(bG=0;bG<u;bG++){ah[bG].fc=0}aW[R].fc=1;af=aS=0;a=ay=aY=0;I=0;y=1};var J=function(bG,bI){var bH=f[bI];var bJ=bI<<1;while(bJ<=n){if(bJ<n&&ag(bG,f[bJ+1],f[bJ])){bJ++}if(ag(bG,bH,f[bJ])){break}f[bI]=f[bJ];bI=bJ;bJ<<=1}f[bI]=bH};var ao=function(bO){var bT=bO.dyn_tree;var bJ=bO.extra_bits;var bG=bO.extra_base;var bP=bO.max_code;var bR=bO.max_length;var bS=bO.static_tree;var bM;var bH,bI;var bQ;var bL;var bN;var bK=0;for(bQ=0;bQ<=bA;bQ++){bd[bQ]=0}bT[f[aK]].dl=0;for(bM=aK+1;bM<bo;bM++){bH=f[bM];bQ=bT[bT[bH].dl].dl+1;if(bQ>bR){bQ=bR;bK++}bT[bH].dl=bQ;if(bH>bP){continue}bd[bQ]++;bL=0;if(bH>=bG){bL=bJ[bH-bG]}bN=bT[bH].fc;af+=bN*(bQ+bL);if(bS!=null){aS+=bN*(bS[bH].dl+bL)}}if(bK==0){return}do{bQ=bR-1;while(bd[bQ]==0){bQ--}bd[bQ]--;bd[bQ+1]+=2;bd[bR]--;bK-=2}while(bK>0);for(bQ=bR;bQ!=0;bQ--){bH=bd[bQ];while(bH!=0){bI=f[--bM];if(bI>bP){continue}if(bT[bI].dl!=bQ){af+=(bQ-bT[bI].dl)*bT[bI].fc;bT[bI].fc=bQ}bH--}}};var a4=function(bH,bM){var bJ=new Array(bA+1);var bI=0;var bK;var bL;for(bK=1;bK<=bA;bK++){bI=((bI+bd[bK-1])<<1);bJ[bK]=bI}for(bL=0;bL<=bM;bL++){var bG=bH[bL].dl;if(bG==0){continue}bH[bL].fc=aq(bJ[bG]++,bG)}};var ba=function(bL){var bO=bL.dyn_tree;var bN=bL.static_tree;var bG=bL.elems;var bH,bJ;var bM=-1;var bI=bG;n=0;aK=bo;for(bH=0;bH<bG;bH++){if(bO[bH].fc!=0){f[++n]=bM=bH;bm[bH]=0}else{bO[bH].dl=0}}while(n<2){var bK=f[++n]=(bM<2?++bM:0);bO[bK].fc=1;bm[bK]=0;af--;if(bN!=null){aS-=bN[bK].dl}}bL.max_code=bM;for(bH=n>>1;bH>=1;bH--){J(bO,bH)}do{bH=f[q];f[q]=f[n--];J(bO,q);bJ=f[q];f[--aK]=bH;f[--aK]=bJ;bO[bI].fc=bO[bH].fc+bO[bJ].fc;if(bm[bH]>bm[bJ]+1){bm[bI]=bm[bH]}else{bm[bI]=bm[bJ]+1}bO[bH].dl=bO[bJ].dl=bI;f[q]=bI++;J(bO,q)}while(n>=2);f[--aK]=f[q];ao(bL);a4(bO,bM)};var az=function(bO,bN){var bH;var bL=-1;var bG;var bJ=bO[0].dl;var bK=0;var bI=7;var bM=4;if(bJ==0){bI=138;bM=3}bO[bN+1].dl=65535;for(bH=0;bH<=bN;bH++){bG=bJ;bJ=bO[bH+1].dl;if(++bK<bI&&bG==bJ){continue}else{if(bK<bM){ah[bG].fc+=bK}else{if(bG!=0){if(bG!=bL){ah[bG].fc++}ah[bi].fc++}else{if(bK<=10){ah[aT].fc++}else{ah[bw].fc++}}}}bK=0;bL=bG;if(bJ==0){bI=138;bM=3}else{if(bG==bJ){bI=6;bM=3}else{bI=7;bM=4}}}};var aJ=function(bO,bN){var bH;var bL=-1;var bG;var bJ=bO[0].dl;var bK=0;var bI=7;var bM=4;if(bJ==0){bI=138;bM=3}for(bH=0;bH<=bN;bH++){bG=bJ;bJ=bO[bH+1].dl;if(++bK<bI&&bG==bJ){continue}else{if(bK<bM){do{be(bG,ah)}while(--bK!=0)}else{if(bG!=0){if(bG!=bL){be(bG,ah);bK--}be(bi,ah);bx(bK-3,2)}else{if(bK<=10){be(aT,ah);bx(bK-3,3)}else{be(bw,ah);bx(bK-11,7)}}}}bK=0;bL=bG;if(bJ==0){bI=138;bM=3}else{if(bG==bJ){bI=6;bM=3}else{bI=7;bM=4}}}};var C=function(){var bG;az(aW,G.max_code);az(F,k.max_code);ba(E);for(bG=u-1;bG>=3;bG--){if(ah[aI[bG]].dl!=0){break}}af+=3*(bG+1)+5+5+4;return bG};var bF=function(bH,bG,bI){var bJ;bx(bH-257,5);bx(bG-1,5);bx(bI-4,4);for(bJ=0;bJ<bI;bJ++){bx(ah[aI[bJ]].dl,3)}aJ(aW,bH-1);aJ(F,bG-1)};var v=function(bG){var bI,bH;var bK;var bL;bL=Q-a9;O[aY]=I;ba(G);ba(k);bK=C();bI=(af+3+7)>>3;bH=(aS+3+7)>>3;if(bH<=bI){bI=bH}if(bL+4<=bI&&a9>=0){var bJ;bx((aV<<1)+bG,3);bE();aP(bL);aP(~bL);for(bJ=0;bJ<bL;bJ++){S(bn[a9+bJ])}}else{if(bH==bI){bx((e<<1)+bG,3);aO(m,av)}else{bx((bq<<1)+bG,3);bF(G.max_code+1,k.max_code+1,bK+1);aO(aW,F)}}au();if(bG!=0){bE()}};var bl=function(bK,bI){ap[a++]=bI;if(bK==0){aW[bI].fc++}else{bK--;aW[Y[bI]+M+1].fc++;F[aM(bK)].fc++;c[ay++]=bK;I|=y}y<<=1;if((a&7)==0){O[aY++]=I;I=0;y=1}if(l>2&&(a&4095)==0){var bG=a*8;var bJ=Q-a9;var bH;for(bH=0;bH<bp;bH++){bG+=F[bH].fc*(5+w[bH])}bG>>=3;if(ay<parseInt(a/2)&&bG<parseInt(bJ/2)){return true}}return(a==W-1||ay==a3)};var aO=function(bM,bK){var bO;var bH;var bI=0;var bP=0;var bL=0;var bN=0;var bG;var bJ;if(a!=0){do{if((bI&7)==0){bN=O[bL++]}bH=ap[bI++]&255;if((bN&1)==0){be(bH,bM)}else{bG=Y[bH];be(bG+M+1,bM);bJ=aG[bG];if(bJ!=0){bH-=bt[bG];bx(bH,bJ)}bO=c[bP++];bG=aM(bO);be(bG,bK);bJ=w[bG];if(bJ!=0){bO-=aB[bG];bx(bO,bJ)}}bN>>=1}while(bI<a)}be(R,bM)};var a2=16;var bx=function(bH,bG){if(ar>a2-bG){al|=(bH<<ar);aP(al);al=(bH>>(a2-ar));ar+=bG-a2}else{al|=bH<<ar;ar+=bG}};var aq=function(bI,bG){var bH=0;do{bH|=bI&1;bI>>=1;bH<<=1}while(--bG>0);return bH>>1};var bE=function(){if(ar>8){aP(al)}else{if(ar>0){S(al)}}al=0;ar=0};var h=function(){if(a6!=0){var bH,bG;bH=V();if(bz==null){bz=j=bH}else{j=j.next=bH}bH.len=a6-a5;for(bG=0;bG<bH.len;bG++){bH.ptr[bG]=a1[a5+bG]}a6=a5=0}};var aQ=function(bK,bM){var bI,bH;bg=bK;b=0;if(typeof bM=="undefined"){bM=bh}ad(bM);var bL=new Array(1024);var bJ=[];while((bI=x(bL,0,bL.length))>0){var bG=new Array(bI);for(bH=0;bH<bI;bH++){bG[bH]=String.fromCharCode(bL[bH])}bJ[bJ.length]=bG.join("")}bg=null;return bJ.join("")};if(!window.RawDeflate){RawDeflate={}}RawDeflate.deflate=aQ})();var Sha1Generator=function(f){var q=0;var w="";var c=8;function l(x){return k(e(v(x),x.length*c))}function j(x){return o(e(v(x),x.length*c))}function d(x){return t(e(v(x),x.length*c))}function b(x,y){return k(g(x,y))}function h(x,y){return o(g(x,y))}function n(x,y){return t(g(x,y))}function a(){return l("abc")=="a9993e364706816aba3e25717850c26c9cd0d89d"}function e(L,F){L[F>>5]|=128<<(24-F%32);L[((F+64>>9)<<4)+15]=F;var M=Array(80);var K=1732584193;var J=-271733879;var I=-1732584194;var H=271733878;var G=-1009589776;for(var C=0;C<L.length;C+=16){var E=K;var D=J;var B=I;var A=H;var y=G;for(var z=0;z<80;z++){if(z<16){M[z]=L[C+z]}else{M[z]=p(M[z-3]^M[z-8]^M[z-14]^M[z-16],1)}var N=r(r(p(K,5),u(z,J,I,H)),r(r(G,M[z]),m(z)));G=H;H=I;I=p(J,30);J=K;K=N}K=r(K,E);J=r(J,D);I=r(I,B);H=r(H,A);G=r(G,y)}return Array(K,J,I,H,G)}function u(y,x,A,z){if(y<20){return(x&A)|((~x)&z)}if(y<40){return x^A^z}if(y<60){return(x&A)|(x&z)|(A&z)}return x^A^z}function m(x){return(x<20)?1518500249:(x<40)?1859775393:(x<60)?-1894007588:-899497514}function g(z,C){var B=v(z);if(B.length>16){B=e(B,z.length*c)}var x=Array(16),A=Array(16);for(var y=0;y<16;y++){x[y]=B[y]^909522486;A[y]=B[y]^1549556828}var D=e(x.concat(v(C)),512+C.length*c);return e(A.concat(D),512+160)}function r(z,C){var B=(z&65535)+(C&65535);var A=(z>>16)+(C>>16)+(B>>16);return(A<<16)|(B&65535)}function p(x,y){return(x<<y)|(x>>>(32-y))}function v(A){var z=Array();var x=(1<<c)-1;for(var y=0;y<A.length*c;y+=c){z[y>>5]|=(A.charCodeAt(y/c)&x)<<(32-c-y%32)}return z}function t(z){var A="";var x=(1<<c)-1;for(var y=0;y<z.length*32;y+=c){A+=String.fromCharCode((z[y>>5]>>>(32-c-y%32))&x)}return A}function k(z){var y=q?"0123456789ABCDEF":"0123456789abcdef";var A="";for(var x=0;x<z.length*4;x++){A+=y.charAt((z[x>>2]>>((3-x%4)*8+4))&15)+y.charAt((z[x>>2]>>((3-x%4)*8))&15)}return A}function o(A){var z="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var C="";for(var y=0;y<A.length*4;y+=3){var B=(((A[y>>2]>>8*(3-y%4))&255)<<16)|(((A[y+1>>2]>>8*(3-(y+1)%4))&255)<<8)|((A[y+2>>2]>>8*(3-(y+2)%4))&255);for(var x=0;x<4;x++){if(y*8+x*6>A.length*32){C+=w}else{C+=z.charAt((B>>6*(3-x))&63)}}}return C}this.sha1_six_four=j(f)}
/*! Tiles.js | http://thinkpixellab.com/tilesjs | 2012-09-19 */
;var Tiles={};(function(){var a=Tiles.Tile=function(c,b){this.id=c;this.top=0;this.left=0;this.width=0;this.height=0;this.$el=$(b||document.createElement("div"))};a.prototype.appendTo=function(e,b,c,d){this.$el.hide().appendTo(e);if(b){this.$el.delay(c).fadeIn(d)}else{this.$el.show()}};a.prototype.remove=function(b,c){if(b){this.$el.fadeOut({complete:function(){$(this).remove()}})}else{this.$el.remove()}};a.prototype.resize=function(k,f,d,g,e){var c={},h=false;if(this.left!==f.x){c.left=f.x;this.left=f.x;h=true}if(this.top!==f.y){c.top=f.y;this.top=f.y;h=true}if(this.width!==f.width){c.width=f.width;this.width=f.width;h=true}if(this.height!==f.height){c.height=f.height;this.height=f.height;h=true}var j=this,b=function(){var l=j.$el[0];if(j.left!=l.offsetLeft){j.$el.css("left",j.left)}if(j.top!=l.offsetTop){j.$el.css("top",j.top)}if(e){e()}};if(d&&h){this.$el.animate(c,{duration:g,easing:"swing",complete:b})}else{if(h){this.$el.css(c)}setTimeout(b,g)}}})();(function(){var c=function(h){var g=[],j=h.length,e,l,k,f,d;for(l=0;l<j;l++){k=h[l];g[l]=[];for(e=0,f=k.length;e<f;e++){d=k[e];if(d!==" "){g[l].push(d)}}}return g};function a(e,g,f,d){this.x=e;this.y=g;this.width=f;this.height=d}a.prototype.copy=function(){return new a(this.x,this.y,this.width,this.height)};Tiles.Rectangle=a;var b=function(o){var m=[],h=o.length,g=h===0?0:o[0].length,l,n,f,k,j,e,d;o=o.slice();for(j=0;j<h;j++){o[j]=o[j].slice()}for(j=0;j<h;j++){for(k=0;k<g;k++){l=o[j][k];if(l==null){continue}f=1;n=1;if(l!==Tiles.Template.SINGLE_CELL){while(f+k<g&&l===o[j][k+f]){f++}while(n+j<h&&l===o[j+n][k]){n++}}for(d=0;d<n;d++){for(e=0;e<f;e++){o[j+d][k+e]=null}}m.push(new a(k,j,f,n))}}return m};Tiles.Template=function(d,f,e){this.rects=d;this.numTiles=this.rects.length;this.numRows=e;this.numCols=f};Tiles.Template.prototype.copy=function(){var f=[],d,e;for(e=0,d=this.rects.length;e<d;e++){f.push(this.rects[e].copy())}return new Tiles.Template(f,this.numCols,this.numRows)};Tiles.Template.prototype.append=function(f){if(this.numCols!==f.numCols){throw"Appended templates must have the same number of columns"}var e=this.numRows,g,d,h;for(g=0,d=f.rects.length;g<d;g++){h=f.rects[g];this.rects.push(new a(h.x,e+h.y,h.width,h.height))}this.numRows+=f.numRows};Tiles.Template.fromJSON=function(f){var e=c(f),d=b(e);return new Tiles.Template(d,e.length>0?e[0].length:0,e.length)};Tiles.Template.prototype.toJSON=function(){var f="ABCDEFGHIJKLMNOPQRSTUVWXYZ",n=f.length,d=0,m=[],e,g,j,l,h,k;for(h=0;h<this.numRows;h++){m[h]=[];for(l=0;l<this.numCols;l++){m[h][l]=Tiles.Template.SINGLE_CELL}}for(e=0,g=this.rects.length;e<g;e++){j=this.rects[e];if(j.width>1||j.height>1){k=f[d];for(h=0;h<j.height;h++){for(l=0;l<j.width;l++){m[j.y+h][j.x+l]=k}}d=(d+1)%n}}for(h=0;h<this.numRows;h++){m[h]=m[h].join("")}return m};Tiles.Template.SINGLE_CELL="."})();Tiles.UniformTemplates={get:function(e,b){var d=Math.ceil(b/e),c=[],a,f;for(f=0;f<d;f++){for(a=0;a<e;a++){c.push(new Tiles.Rectangle(a,f,1,1))}}return new Tiles.Template(c,e,d)}};(function(){var a=Tiles.Grid=function(d){this.$el=$(d);this.animationDuration=500;this.cellSizeMin=150;this.templateFactory=Tiles.UniformTemplates;this.priorityPageSize=Number.MAX_VALUE;this.cellPadding=10;this.cellSize=0;this.numCols=1;this.template=null;this.isDirty=true;this.tiles=[];this.tilesAdded=[];this.tilesRemoved=[]};a.prototype.getContentWidth=function(){return this.$el.width()};a.prototype.resizeColumns=function(){var d=this.getContentWidth();return Math.max(1,Math.floor((d+this.cellPadding)/(this.cellSizeMin+this.cellPadding)))};a.prototype.resizeCellSize=function(){var d=this.getContentWidth();return Math.ceil((d+this.cellPadding)/this.numCols)-this.cellPadding};a.prototype.resize=function(){var e=this.resizeColumns();if(this.numCols!==e&&e>0){this.numCols=e;this.isDirty=true}var d=this.resizeCellSize();if(this.cellSize!==d&&d>0){this.cellSize=d;this.isDirty=true}};a.prototype.updateTiles=function(h){h=c(h);var g=h.length,e=[],f,j,k,d;for(f=this.tiles.length-1;f>=0;f--){j=this.tiles[f];d=_.indexOf(h,j.id);if(d<0){this.tilesRemoved.push(j)}else{e[d]=j}}this.tiles=[];for(f=0;f<g;f++){j=e[f];if(!j){k=h[f];if(this.createTile){j=this.createTile(k);if(!j){continue}}else{j=new Tiles.Tile(k)}this.tilesAdded.push(j)}this.tiles.push(j)}};function c(d){var g=[],f=d?d.length:0,e,h;for(e=0;e<f;e++){h=d[e];if(_.indexOf(g,h)===-1){g.push(h)}}return g}a.prototype.insertTiles=function(d){this.addTiles(d,true)};a.prototype.addTiles=function(g,d){if(!g||g.length===0){return}var h=[],f=this.tiles.length,e;for(e=0;e<f;e++){h.push(this.tiles[e].id)}var j=d?g.concat(h):h.concat(g);this.updateTiles(j)};a.prototype.removeTiles=function(f){if(!f||f.length===0){return}var h=[],e,d,g;for(e=0,d=this.tiles.length;e<d;e++){g=this.tiles[e].id;if(_.indexOf(f,g)===-1){h.push(g)}}this.updateTiles(h)};a.prototype.createTemplate=function(f,d){f=Math.max(1,f);var e=this.templateFactory.get(f,d);if(!e){e=Tiles.UniformTemplates.get(f,d)}return e};a.prototype.ensureTemplate=function(e){if(!this.template||this.template.numCols!==this.numCols){this.template=this.createTemplate(this.numCols,e);this.isDirty=true}else{var d=e-this.template.rects.length;if(d>0){this.template.append(this.createTemplate(this.numCols,d));this.isDirty=true}}};function b(d,h,g){var e=d.y+d.height,f=d.x+d.width;if(h){if(!((h.top>e)||(h.top+h.height<d.y)||(h.left>f)||(h.left+h.width<d.x))){return true}}if(g){if(!((g.y>e)||(g.y+g.height<d.y)||(g.x>f)||(g.x+g.width<d.x))){return true}}return false}a.prototype.shouldRedraw=function(){if(this.cellSize<=0){this.resize()}this.ensureTemplate(this.tiles.length);var d=(this.isDirty||this.tilesAdded.length>0||this.tilesRemoved.length>0);return d};a.prototype.redraw=function(j,v){if(!this.shouldRedraw()){if(v){v(false)}return}var w=this.tiles.length,x=this.priorityPageSize,d=this.animationDuration,l=this.cellSize+this.cellPadding,p=0,f=0,q=new Tiles.Rectangle(this.$el.scrollLeft(),this.$el.scrollTop(),this.$el.width(),this.$el.height()),y,k,n,g,r,t,o,m,h,e,u;for(p=0;p<w;p+=x){n=this.template.rects.slice(p,p+x);g=this.tiles.slice(p,p+x);e=n.slice(0);u=g.slice(0);if(this.prioritizePage){this.prioritizePage(e,u)}for(r=0,t=u.length;r<t;r++){y=u[r];k=_.indexOf(this.tilesAdded,y)>=0;o=e[r];m=new Tiles.Rectangle(o.x*l,o.y*l,(o.width*l)-this.cellPadding,(o.height*l)-this.cellPadding);y.resize(o,m,j&&!k&&b(q,y,m),d);if(k){h=j&&b(q,null,m);if(h&&this.getAppendDelay){f=this.getAppendDelay(o,n,e,y,g,u)}else{f=0}y.appendTo(this.$el,h,f,d)}}}for(r=0,t=this.tilesRemoved.length;r<t;r++){y=this.tilesRemoved[r];h=j&&b(q,y,null);y.remove(h,d)}this.tilesRemoved=[];this.tilesAdded=[];this.isDirty=false;if(v){setTimeout(function(){v(true)},d+10)}}})();
/*! jquery.pxtouch.js | http://thinkpixellab.com/pxtouch | 2012-07-27 */
(function(){if(typeof(PxTouch)==="undefined"){PxTouch={}}(function(a){PxTouch.registerSpecialEvents=function(d,c,b){a.each(c,function(f,e){a.event.special[e]={setup:function(l,k,j){var h=a(this),g=h.data(d);if(!g){g=new b(h);g.activeEventTypes=0;g.start();h.data(d,g)}g.activeEventTypes++},teardown:function(h){var g=a(this).data(d);if(g){g.activeEventTypes--;if(g.activeEventTypes===0){g.stop()}}}}})}})(PxTouch.jQuery||jQuery);(function(e){function h(n){this.$el=n;this.activePointers=[];this.mouseEventsEnabled=false;var m=function(p,o){return function(u){var r=l(u),t,q;for(t=0,q=r.length;t<q;t++){p.call(o,r[t],u)}}};this.listeners={msPointer:{MSPointerDown:m(b,this),MSPointerMove:m(f,this),MSPointerUp:m(k,this),MSPointerCancel:m(c,this)},touch:{touchstart:m(d,this),touchmove:m(f,this),touchend:m(k,this),touchcancel:m(c,this)},mouse:{mousedown:m(b,this),mousemove:m(f,this),mouseup:m(k,this)}};this.docListeners={msPointer:{MSPointerUp:m(k,this)},mouse:{mouseup:m(k,this)}}}h.prototype.start=function(){if(window.navigator.msPointerEnabled){this.$el.on(this.listeners.msPointer);e(document).on(this.docListeners.msPointer)}else{if("ontouchstart" in window){this.$el.on(this.listeners.touch)}this.$el.on(this.listeners.mouse);e(document).on(this.docListeners.mouse);this.mouseEventsEnabled=true}};h.prototype.stop=function(){this.$el.off(this.listeners.msPointer).off(this.listeners.touch).off(this.listeners.mouse);e(document).off(this.docListeners.msPointer).off(this.docListeners.mouse);this.mouseEventsEnabled=false;this.activePointers=[]};function d(n,m){if(this.mouseEventsEnabled){this.$el.off(this.listeners.mouse);e(document).off(this.docListeners.mouse);this.mouseEventsEnabled=false}return b.call(this,n,m)}function b(n,m){this.activePointers.push(n);this.triggerEvent("pointerstart",n,m)}function f(o,n){var m=o.indexIn(this.activePointers);if(m>=0){this.activePointers.splice(m,1,o);this.triggerEvent("pointermove",o,n)}}function c(n,m){return k.call(this,n,m,true)}function k(p,o,n){var m=p.indexIn(this.activePointers);if(m>=0){this.activePointers.splice(m,1);this.triggerEvent("pointerend",p,o,n)}}function l(n){if(n.preventManipulation){n.preventManipulation()}var v=[],m=a(n),w=n.originalEvent,r=w.changedTouches||w.targetTouches||w.touches||[w],p,q,z,u,t,o;for(p=0,q=r.length;p<q;p++){z=r[p];u=t=0;if(z.pageX||z.pageY){u=z.pageX;t=z.pageY}else{if(z.clientX||z.clientY){u=z.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;t=z.clientY+document.body.scrollTop+document.documentElement.scrollTop}}o=z.pointerId||z.identifier||p;v.push(new j(u,t,o,m))}return v}h.prototype.triggerEvent=function(n,p,m,o){this.$el.trigger(new e.Event(n,{pointer:p,cancelled:(o===true),activePointers:this.activePointers,originalEvent:m}))};var g={MOUSE:"mouse",TOUCH:"touch",PEN:"pen"};function a(m){if(m.type.indexOf("touch")===0){return g.TOUCH}else{if(m.type.indexOf("mouse")===0){return g.MOUSE}}var n=m.originalEvent;switch(n.pointerType){case n.MSPOINTER_TYPE_MOUSE:return g.MOUSE;case n.MSPOINTER_TYPE_TOUCH:return g.TOUCH;case n.MSPOINTER_TYPE_PEN:return g.PEN}return g.MOUSE}function j(m,p,o,n){this.x=m;this.y=p;this.id=o;this.type=n}j.prototype.getDistance=function(n){var m=this.x-n.x,o=this.y-n.y;return Math.sqrt((m*m)+(o*o))};j.prototype.indexIn=function(o){for(var n=0,m=o.length;n<m;n++){if(o[n].id===this.id){return n}}return -1};PxTouch.registerSpecialEvents("pxtouch.pointers",["pointerstart","pointermove","pointerend"],h)})(PxTouch.jQuery||jQuery);(function(c){function d(e){this.$el=e;this.paths=[];var f=c.proxy(a,this);this.listeners={pointerstart:f,pointermove:f,pointerend:f}}d.prototype.start=function(){this.$el.on(this.listeners)};d.prototype.stop=function(){this.$el.off(this.listeners);this.paths=[]};function a(g){var e=g.pointer,k=this.paths.length,m=0,n,l,f,h,j;for(h=0;h<k;h++){n=this.paths[h];if(n.isActive){m++}if(n.id===e.id){j=h;l=n}}if(g.cancelled){if(l){this.paths.splice(j,1);m-=l.isActive?1:0}}else{if(l){l.movePointer=e;l.moveTime=+new Date}else{l=new b(e);this.paths.push(l);m++}if(g.type==="pointerend"&&l.isActive){m--;l.isActive=false}}if(m<=0){f="gestureend"}else{if(k===0){f="gesturestart"}else{f="gesturemove"}}this.$el.trigger(new c.Event(f,{paths:this.paths,cancelled:(this.paths.length===0),originalEvent:g.originalEvent}));if(m<=0){this.paths=[]}}function b(e){this.id=e.id;this.startPointer=e;this.startTime=+new Date;this.movePointer=e;this.moveTime=this.startTime;this.isActive=true}b.prototype.getLength=function(){return Math.abs(this.movePointer.getDistance(this.startPointer))};b.prototype.getElapsed=function(){return this.moveTime-this.startTime};b.prototype.getAngle=function(){var e=Math.atan2(this.movePointer.y-this.startPointer.y,this.startPointer.x-this.movePointer.x);return e/Math.PI*180+180};b.prototype.getDirection=function(){var e=this.getAngle();if(e>=45&&e<135){return"up"}if(e>=135&&e<225){return"left"}if(e>=225&&e<315){return"down"}return"right"};b.prototype.angleBetween=function(e){var f=Math.abs(this.getAngle()-e.getAngle());f=Math.min(f,360-f);return f};PxTouch.registerSpecialEvents("pxtouch.gestures",["gesturestart","gesturemove","gestureend"],d)})(PxTouch.jQuery||jQuery);(function(g){var f=10,c=500;var a={NONE:0,INVALID:1,TAP:2,HOLD:3};function e(h){this.$el=h;this.activeEventTypes=0;this.state=a.NONE;this.holdTimer=null;var j=g.proxy(b,this);this.listeners={gesturestart:j,gesturemove:j,gestureend:j}}e.prototype.start=function(){this.$el.on(this.listeners)};e.prototype.stop=function(){this.$el.off(this.listeners);this.state=a.NONE};function b(h){var m=h.paths,l=this.state,o=(h.type==="gestureend"),j=false,k,n;if(h.originalEvent.which){j=(h.originalEvent.which==3)}else{if(h.originalEvent.button){j=(h.originalEvent.button==2)}}if(l===a.INVALID||m.length!==1||j||h.cancelled){k=a.INVALID}else{n=m[0].getLength();if(n>f){k=a.INVALID}else{k=(l===a.HOLD)?a.HOLD:a.TAP}}if(!this.holdTimer&&k===a.TAP){this.holdTimer=setTimeout(d(h,this),c)}else{if(this.holdTimer&&(k===a.INVALID||o)){clearTimeout(this.holdTimer);this.holdTimer=null}}if((k===a.HOLD&&o)||(l===a.HOLD&&k!==l)){this.triggerEvent("holdend",h,k===a.INVALID)}else{if(o&&k===a.TAP){this.triggerEvent("tap",h)}}this.state=o?a.NONE:k}function d(j,h){return g.proxy(function(){this.state=a.HOLD;this.triggerEvent("holdstart",j);this.holdTimer=null},h)}e.prototype.triggerEvent=function(h,k,j){var l=k.paths.length>0?k.paths[0].movePointer:null;this.$el.trigger(new g.Event(h,{x:l?l.x:0,y:l?l.y:0,pointerType:l?l.type:null,cancelled:(j===true),originalEvent:k.originalEvent}))};PxTouch.registerSpecialEvents("pxtouch.taps",["tap","holdstart","holdend"],e)})(PxTouch.jQuery||jQuery);(function(e){var b=10,f=15,d=30;var g={NONE:0,PINCH:1,INVALID:2};function c(h){this.$el=h;this.state=g.NONE;var j=e.proxy(a,this);this.listeners={gesturestart:j,gesturemove:j,gestureend:j}}c.prototype.start=function(){this.$el.on(this.listeners)};c.prototype.stop=function(){this.$el.off(this.listeners);this.state=g.NONE};function a(l){var u=l.paths,r=this.state,j=(l.type==="gestureend"),n,m,p,k,q,h,o;if(r!==g.INVALID){if(u.length>2||l.cancelled){this.state=g.INVALID}else{if(u.length===2){n=u[0];m=u[1];p=n.getLength();k=m.getLength();if(p>b||k>b){if(p>f&&k>f){this.state=(n.angleBetween(m)>=d)?g.PINCH:g.INVALID}else{this.state=g.PINCH}}if(this.state===g.PINCH){q=n.movePointer.getDistance(m.movePointer);h=n.startPointer.getDistance(m.startPointer);var t={originX:(n.movePointer.x+m.movePointer.x)/2,originY:(n.movePointer.y+m.movePointer.y)/2,scale:q/h,paths:u,cancelled:false,originalEvent:l.originalEvent};if(r===g.NONE){this.$el.trigger(e.Event("pinchstart",t))}else{if(!j){this.$el.trigger(e.Event("pinchmove",t))}}if(j){this.$el.trigger(e.Event("pinchend",t))}}}}if(this.state===g.INVALID&&r===g.PINCH){this.$el.trigger(e.Event("pinchend",{originX:0,originY:0,scale:0,paths:[],cancelled:true,originalEvent:l.originalEvent}))}}if(j){this.state=g.NONE}}PxTouch.registerSpecialEvents("pxtouch.pinch",["pinchstart","pinchmove","pinchend"],c)})(PxTouch.jQuery||jQuery);(function(e){var d=10,g=200;var f={NONE:0,DRAG:1,INVALID:2};function a(h){this.$el=h;this.state=f.NONE;var j=e.proxy(b,this);this.listeners={gesturestart:j,gesturemove:j,gestureend:j}}a.prototype.start=function(){this.$el.on(this.listeners)};a.prototype.stop=function(){this.$el.off(this.listeners);this.state=f.NONE};function c(p){var k=p.length,m,l,o,h,n;if(k>1){for(m=0;m<k;m++){o=p[m];if(o.isActive){h=false;for(l=0;l<k;l++){if(m===l){continue}n=o.movePointer.getDistance(p[l].movePointer);if(n<=g){h=true;break}}if(!h){return false}}}}return true}function b(k){var n=k.paths,m=this.state,o=(k.type==="gestureend"),l,j;if(m!==f.INVALID){j=(n.length>0)?n[0].getLength():0;var h={paths:n,length:j,cancelled:k.cancelled,originalEvent:k.originalEvent};if(k.cancelled||!c(k.paths)){this.state=f.INVALID;h.cancelled=true}else{if(this.state===f.NONE){if(j>d){this.state=f.DRAG;this.$el.trigger(e.Event("dragstart",h))}}else{if(!o){this.$el.trigger(e.Event("dragmove",h))}}}if((m===f.DRAG&&this.state===f.INVALID)||(this.state===f.DRAG&&o)){this.$el.trigger(e.Event("dragend",h))}}if(o){this.state=f.NONE}}PxTouch.registerSpecialEvents("pxtouch.drag",["dragstart","dragmove","dragend"],a)})(PxTouch.jQuery||jQuery);(function(d){var f=20,c=20;var a={NONE:0,SWIPE:1,INVALID:2};function e(g){this.$el=g;this.state=a.NONE;this.maxLength=0;this.angle=0;var h=d.proxy(b,this);this.listeners={dragstart:h,dragmove:h,dragend:h}}e.prototype.start=function(){this.$el.on(this.listeners)};e.prototype.stop=function(){this.$el.off(this.listeners);this.state=a.NONE;this.maxLength=0;this.angle=0};function b(l){var o=l.paths,m=this.state,g=(l.type==="dragend"),k=l.length,n,j;if(this.state!==a.INVALID){n=(o.length>0)?o[0].getAngle():0;var h={length:k,angle:n,paths:o,cancelled:l.cancelled,originalEvent:l.originalEvent};if(l.cancelled){this.state=a.INVALID}else{if(this.state===a.NONE){this.state=a.SWIPE;this.maxLength=k;this.angle=n;this.$el.trigger(d.Event("swipestart",h))}else{if(k>=this.maxLength){this.maxLength=k}else{if(this.maxLength-k>f){this.state=a.INVALID}}j=Math.abs(this.angle-n);if(Math.min(j,360-j)>c){this.state=a.INVALID}if(this.state!==a.INVALID&&!g){this.$el.trigger(d.Event("swipemove",h))}}}if((m===a.SWIPE&&this.state===a.INVALID)||(this.state===a.SWIPE&&g)){h.cancelled=(this.state===a.INVALID);this.$el.trigger(d.Event("swipeend",h))}}if(g){this.state=a.NONE;this.maxLength=0;this.angle=0}}PxTouch.registerSpecialEvents("pxtouch.swipe",["swipestart","swipemove","swipeend"],e)})(PxTouch.jQuery||jQuery)})();var Sylvester={version:"0.1.3",precision:0.000001};function Matrix(){}Matrix.prototype={e:function(b,a){if(b<1||b>this.elements.length||a<1||a>this.elements[0].length){return null}return this.elements[b-1][a-1]},map:function(f){var e=[],d=this.elements.length,h=d,c,b,g=this.elements[0].length,a;do{c=h-d;b=g;e[c]=[];do{a=g-b;e[c][a]=f(this.elements[c][a],c+1,a+1)}while(--b)}while(--d);return Matrix.create(e)},multiply:function(q){if(!q.elements){return this.map(function(c){return c*q})}var h=q.modulus?true:false;var n=q.elements||q;if(typeof(n[0][0])=="undefined"){n=Matrix.create(n).elements}if(!this.canMultiplyFromLeft(n)){return null}var e=this.elements.length,f=e,l,b,d=n[0].length,g;var p=this.elements[0].length,a=[],m,k,o;do{l=f-e;a[l]=[];b=d;do{g=d-b;m=0;k=p;do{o=p-k;m+=this.elements[l][o]*n[o][g]}while(--k);a[l][g]=m}while(--b)}while(--e);var n=Matrix.create(a);return h?n.col(1):n},x:function(a){return this.multiply(a)},canMultiplyFromLeft:function(a){var b=a.elements||a;if(typeof(b[0][0])=="undefined"){b=Matrix.create(b).elements}return(this.elements[0].length==b.length)},setElements:function(h){var m,a=h.elements||h;if(typeof(a[0][0])!="undefined"){var d=a.length,f=d,b,c,l;this.elements=[];do{m=f-d;b=a[m].length;c=b;this.elements[m]=[];do{l=c-b;this.elements[m][l]=a[m][l]}while(--b)}while(--d);return this}var e=a.length,g=e;this.elements=[];do{m=g-e;this.elements.push([a[m]])}while(--e);return this}};Matrix.create=function(a){var b=new Matrix();return b.setElements(a)};$M=Matrix.create;(function(m){if(!m.cssHooks){throw ("jQuery 1.4.3+ is needed for this plugin to work");return}var c="transform",h,f,e,o,g,d=c.charAt(0).toUpperCase()+c.slice(1),l=["Moz","Webkit","O","MS"],b=document.createElement("div");if(c in b.style){f=c;e=b.style.perspective!==undefined}else{for(var k=0;k<l.length;k++){h=l[k]+d;if(h in b.style){f=h;if((l[k]+"Perspective") in b.style){e=true}else{o=true}break}}}if(!f){g=("filter" in b.style);f="filter"}b=null;m.support[c]=f;var q=f;var p={rotateX:{defaultValue:0,matrix:function(r){if(e){return $M([[1,0,0,0],[0,Math.cos(r),Math.sin(-r),0],[0,Math.sin(r),Math.cos(r),0],[0,0,0,1]])}else{return $M([[1,0,0],[0,1,0],[0,0,1]])}}},rotateY:{defaultValue:0,matrix:function(r){if(e){return $M([[Math.cos(r),0,Math.sin(r),0],[0,1,0,0],[Math.sin(-r),0,Math.cos(r),0],[0,0,0,1]])}else{return $M([[1,0,0],[0,1,0],[0,0,1]])}}},rotateZ:{defaultValue:0,matrix:function(r){if(e){return $M([[Math.cos(r),Math.sin(-r),0,0],[Math.sin(r),Math.cos(r),0,0],[0,0,1,0],[0,0,0,1]])}else{return $M([[Math.cos(r),Math.sin(-r),0],[Math.sin(r),Math.cos(r),0],[0,0,1]])}}},scale:{defaultValue:1,matrix:function(r){if(e){return $M([[r,0,0,0],[0,r,0,0],[0,0,r,0],[0,0,0,1]])}else{return $M([[r,0,0],[0,r,0],[0,0,1]])}}},translateX:{defaultValue:0,matrix:function(r){if(e){return $M([[1,0,0,0],[0,1,0,0],[0,0,1,0],[r,0,0,1]])}else{return $M([[1,0,0],[0,1,0],[r,0,1]])}}},translateY:{defaultValue:0,matrix:function(r){if(e){return $M([[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,r,0,1]])}else{return $M([[1,0,0],[0,1,0],[0,r,1]])}}},translateZ:{defaultValue:0,matrix:function(r){if(e){return $M([[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,r,1]])}else{return $M([[1,0,0],[0,1,0],[0,0,1]])}}}};var j=function(v){var u=m(v).data("transforms");var r;if(e){r=$M([[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]])}else{r=$M([[1,0,0],[0,1,0],[0,0,1]])}for(var t in p){r=r.x(p[t].matrix(u[t]||p[t].defaultValue))}if(e){s="matrix3d(";s+=r.e(1,1).toFixed(10)+","+r.e(1,2).toFixed(10)+","+r.e(1,3).toFixed(10)+","+r.e(1,4).toFixed(10)+",";s+=r.e(2,1).toFixed(10)+","+r.e(2,2).toFixed(10)+","+r.e(2,3).toFixed(10)+","+r.e(2,4).toFixed(10)+",";s+=r.e(3,1).toFixed(10)+","+r.e(3,2).toFixed(10)+","+r.e(3,3).toFixed(10)+","+r.e(3,4).toFixed(10)+",";s+=r.e(4,1).toFixed(10)+","+r.e(4,2).toFixed(10)+","+r.e(4,3).toFixed(10)+","+r.e(4,4).toFixed(10);s+=")"}else{if(o){s="matrix(";s+=r.e(1,1).toFixed(10)+","+r.e(1,2).toFixed(10)+",";s+=r.e(2,1).toFixed(10)+","+r.e(2,2).toFixed(10)+",";s+=r.e(3,1).toFixed(10)+"px,"+r.e(3,2).toFixed(10)+"px";s+=")"}else{if(g){s="progid:DXImageTransform.Microsoft.";s+="Matrix(";s+="M11="+r.e(1,1).toFixed(10)+",";s+="M12="+r.e(1,2).toFixed(10)+",";s+="M21="+r.e(2,1).toFixed(10)+",";s+="M22="+r.e(2,2).toFixed(10)+",";s+="SizingMethod='auto expand'";s+=")";v.style.top=r.e(3,1);v.style.left=r.e(3,2)}}}v.style[q]=s};var n=function(r){m.fx.step[r]=function(t){m.cssHooks[r].set(t.elem,t.now+t.unit)};return{get:function(w,v,t){var u=m(w).data("transforms");if(u===undefined){u={};m(w).data("transforms",u)}return u[r]||p[r].defaultValue},set:function(v,w){var u=m(v).data("transforms");if(u===undefined){u={}}var t=p[r];if(typeof t.apply==="function"){u[r]=t.apply(u[r]||t.defaultValue,w)}else{u[r]=w}m(v).data("transforms",u);j(v)}}};if(q){for(var a in p){m.cssHooks[a]=n(a);m.cssNumber[a]=true}}})(jQuery);var Easing=new function(){this.noEase=function(e,a,g,f){return g*e/f+a};this.easeOutCirc=function(e,a,g,f){return g*Math.sqrt(1-(e=e/f-1)*e)+a};this.easeInCirc=function(e,a,g,f){return -g*(Math.sqrt(1-(e/=f)*e)-1)+a};this.easeInOutCirc=function(e,a,g,f){if((e/=f/2)<1){return -g/2*(Math.sqrt(1-e*e)-1)+a}return g/2*(Math.sqrt(1-(e-=2)*e)+1)+a};this.easeInSine=function(e,a,g,f){return -g*Math.cos(e/f*(Math.PI/2))+g+a};this.easeOutSine=function(e,a,g,f){return g*Math.sin(e/f*(Math.PI/2))+a};this.easeInOutSine=function(e,a,g,f){return -g/2*(Math.cos(Math.PI*e/f)-1)+a};this.easeInCubic=function(e,a,g,f){return g*(e/=f)*e*e+a};this.easeOutCubic=function(e,a,g,f){return g*((e=e/f-1)*e*e+1)+a};this.easeInOutCubic=function(e,a,g,f){if((e/=f/2)<1){return g/2*e*e*e+a}return g/2*((e-=2)*e*e+2)+a};this.easeInExpo=function(e,a,g,f){return(e==0)?a:g*Math.pow(2,10*(e/f-1))+a};this.easeOutExpo=function(e,a,g,f){return(e==f)?a+g:g*(-Math.pow(2,-10*e/f)+1)+a};this.easeInOutExpo=function(e,a,g,f){if(e==0){return a}if(e==f){return a+g}if((e/=f/2)<1){return g/2*Math.pow(2,10*(e-1))+a}return g/2*(-Math.pow(2,-10*--e)+2)+a};this.easeInBounce=function(e,a,h,g,f){if(f==undefined){f=1.70158}return h*(e/=g)*e*((f+1)*e-f)+a};this.easeOutBounce=function(e,a,h,g,f){if(f==undefined){f=1.70158}return h*((e=e/g-1)*e*((f+1)*e+f)+1)+a};this.easeInOutBounce=function(e,a,h,g,f){if(f==undefined){f=1.70158}if((e/=g/2)<1){return h/2*(e*e*(((f*=(1.525))+1)*e-f))+a}return h/2*((e-=2)*e*(((f*=(1.525))+1)*e+f)+2)+a};this.easeInOutQuad=function(e,a,g,f){if((e/=f/2)<1){return g/2*e*e+a}return -g/2*((--e)*(e-2)-1)+a};this.easeOutQuad=function(e,a,g,f){return -g*(e/=f)*(e-2)+a}};function Environment(){var a="pulseapi-test.appspot.com",b="localhost:8000",c="www.pulse.me";this.determineHttpsHostname=function(){var d="http://";if(window.location.host.indexOf("localhost")==-1){d="https://"}return d+window.location.host},this.determineGaqId=function(){if(window.location.host===a){_gaq.push(["_setAccount","UA-23402081-3"])}else{if(window.location.host===c){_gaq.push(["_setAccount","UA-23402081-1"])}else{if(window.location.host==="pulseapi.appspot.com"){_gaq.push(["_setAccount","UA-23402081-1"])}}}},this.determineHttpHostname=function(){return"http://"+window.location.host},this.determineFacebookAppId=function(d){d=d||"http://"+window.location.host;if(d=="http://localhost:8000"){return"171610762890554"}else{if(d=="http://www.pulse.me"){return"110137889015352"}else{if(d=="http://pulseapi-test.appspot.com"){return"273651416048994"}}}},this.determineFacebookAppNamespace=function(d){if(d=="http://localhost:8000"){return"local_pulse"}else{if(d=="http://www.pulse.me"){return"al_pulse"}else{if(d=="http://pulseapi-test.appspot.com"){return"fb_pulsetest"}}}},this.determinetUserAgent=function(){var d=["iphone","ipod","ipad","android"];var e=navigator.userAgent.toLowerCase();for(var f=0;f<d.length;f++){if(e.search(d[f])>-1){return d[f]}}return"other"};this.determineDebugMode=function(){var e=window.location.host;var d=false;if(e==="localhost:8000"){d=true}else{if(e==="pulseapi-test.appspot.com"&&(typeof(console)!=="undefined"&&typeof(console.log)!=="undefined")){d=true}}return d};this.determineScrollBarWidth=function(){var e=document.createElement("div"),d;e.className="scrollbar-measure";document.body.appendChild(e);d=e.offsetWidth-e.clientWidth;document.body.removeChild(e);return d};this.isLoggedInUser=function(){if(PulseApp.Environment.Pixel){return true}if(PulseApp.Username){return true}else{return false}}}var pulse={};pulse.dummyConsole={assert:function(){},log:function(){},warn:function(){},error:function(){},debug:function(){},dir:function(){},info:function(){}};pulse.enableConsoleOutput=function(a){if(a&&window.console!==undefined){pulse.console=window.console}else{pulse.console=pulse.dummyConsole}};(function(){PulseApp.Environment=new Environment();PulseApp.Environment.determineGaqId();var b=document.createElement("script");b.type="text/javascript";b.async=true;b.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(b,a);if(!PulseApp.Environment.determineDebugMode()){pulse.enableConsoleOutput(false)}else{pulse.enableConsoleOutput(true)}})();PulseApp.Hostname=PulseApp.Environment.determineHttpHostname();PulseApp.Environment.PushStates=true;PulseApp.Environment.Constants={PAGE:0,SOURCE:1,CATALOG:2,SAVED:3,SETTINGS:4,ONBOARDING:5,SOURCES_MENU:6,DEV:7,RECOMMENDED:8,STORY:9,SOURCE_SYNC_DELAY:70*1000,UNSUPPORTED_BROWSER_STRING:"bypass_unsupported_browser",SETTING_SYNC:{}};PulseApp.Environment.Constants.SETTING_SYNC.web_onboarding=["first_time","xbox_hint","catalog_first_time","reading_first_time"];PulseApp.Version=2;PulseApp.PrivacyMessage=false;PulseApp.Environment.Endpoints={SettingSync:"/api/v2/user/setting_sync",SourceSync:"/api/v2/user/source_sync",SavedStories:"/api/v2/user/feed",RecommendedStories:"/api/v2/user/recommended_stories",Profile:"/api/v2/user/profile",ProfilePhoto:"/api/v2/user/profile_photo?user_id=",CatalogItems:"/api/v2/catalog/catalog_items",CatalogImage:"/api/v2/catalog/catalog_image?image_type=icon&catalog_item_primary_key=",CatalogSearch:"/api/v2/catalog/search",getAbsoluteUrl:function(a){return PulseApp.Hostname+a}};try{var supported_catalog_locales=localStorage.getItem("supported_catalog_locales")?localStorage.getItem("supported_catalog_locales").split(","):null,locale=(navigator.language||navigator.browserLanguage).toLowerCase().replace("-","_"),supported_locale;if(supported_catalog_locales){supported_locale=_.find(supported_catalog_locales,function(a){return a==locale});if(supported_locale){PulseApp.Environment.Endpoints.CatalogItems+="?catalog_locale="+supported_locale}}}catch(err){_gaq.push(["_trackEvent","error_settings_catalog_locale",err.toString()])}if(location.protocol==="https:"){PulseApp.Environment.Endpoints.Batch="https://hr-pulsesubscriber.appspot.com/batch_feeds?combine_entries=false"}else{PulseApp.Environment.Endpoints.Batch="http://hr-pulsesubscriber.appspot.com/batch_feeds?combine_entries=false"}PulseApp.Environment.ReservedRoutes=["catalog","saved","settings","logout","onboarding","dev","send-log","load-profile","read"];PulseApp.Environment.ReadingPref={mode:"light",font_size:"medium",font_style:"sans"};PulseApp.Environment.GridMode={MAGAZINE:"smart",UNIFORM_NORMAL:"grid",UNIFORM_SMALL:"zoom"};PulseApp.GridSetting="smart";PulseApp.Environment.Accounts={Bitly:{User:"pulseme",Key:"R_40c11b3d1e8d5c505731c70492da0826"}};if(PulseApp.Hostname==="http://localhost:8000"||!PulseApp.Environment.isLoggedInUser()){PulseApp.Hostname="https://pulseapi.appspot.com"}PulseApp.UserPages={};PulseApp.Templates={};PulseApp.User={};PulseApp.User.Models={};PulseApp.User.Collections={};PulseApp.Views={};PulseApp.ActiveViews={};PulseApp.Models={};PulseApp.Collections={};PulseApp.Helpers={};PulseApp.Intervals={};PulseApp.Hint=null;PulseApp.Models.Service=Backbone.Model.extend({});PulseApp.User.Collections.SettingSync=Backbone.Collection.extend({model:PulseApp.Models.Service,url:PulseApp.Environment.Endpoints.SettingSync,sync:function(c,b,a){return Backbone.sync(c,b,a)},initialize:function(a){if(a==undefined){this.fetch()}},parse:function(a){return a.data.settings_json},syncWithBackend:function(c,b,d){var a={};if(this.models.length>0&&b&&d){setting=this.models[0].get(c);return_json={};if(setting==undefined){this.models[0].set(c,{});setting=this.models[0].get(c)}setting[b]=d;return_json[c]={};return_json[c]["updated"]=Math.round((new Date()).getTime()/1000);return_json[c][b]=d;a.url=this.url;a.data='settings_json={"settings_json":'+escape(JSON.stringify(return_json))+"}";this.sync("create",PulseApp.SettingsSync,a)}}});try{if(__settings){PulseApp.SettingSync=new PulseApp.User.Collections.SettingSync(__settings.data.settings_json);__settings=null}else{PulseApp.SettingSync=new PulseApp.User.Collections.SettingSync()}}catch(err){}PulseApp.Notify={$container:$("#reader_notification_container"),$message:$("#notification_message"),isShowing:false,set:function(c,a){var b=this;if(this.isShowing){window.setTimeout(function(){b.$message.html(c);if(a){if(a.remove){b.remove()}}},1500)}else{this.$message.html(c);this.$container.fadeIn(250)}this.isShowing=true;return this},remove:function(){this.isShowing=false;this.$container.delay(500).fadeOut(750);return this}};PulseApp.CDNPrefix={count:4,start:1,base_url:"http://cdn",prefixUrl:function(c){var e=0,d,a,b;for(d=0,a=c.length;d<a;d++){e=((e<<5)-e)+c.charCodeAt(d);e=e&e}b=this.base_url+((Math.abs(e)%this.count)+this.start)+".";return c.replace("http://",b)}};PulseApp.Environment.Pubs=["http://lifehacker.com/","http://www.fastcompany.com/superfeed/superfeed.xml","http://feedproxy.google.com/TechCrunch","http://feeds.feedburner.com/gizmodo/vip","http://www.popsci.com/rss.xml","http://www.theverge.com/rss/full.xml","http://feeds.feedburner.com/mashable/pulse","http://feeds.feedburner.com/gawker/vip","http://feeds2.feedburner.com/TheAwl","http://maddowblog.msnbc.msn.com/_feeds/rss2/author","http://www.buzzfeed.com/pulsebuzzfeed.xml?bfsrc=pulse","http://cuteoverload.com/feed/","http://feeds.feedburner.com/ICanHasCheezburger","http://feeds.feedburner.com/io9/vip","http://www.linkedin.com/channels/rss/channels/10000306","full://feeds.feedburner.com/DiscoveryNews-Top-Stories","http://www.joystiq.com/rss.xml","http://www.gamesradar.com/all-platforms/all-articles/feed/","http://www.theverge.com/rss/full.xml","http://feeds2.feedburner.com/thenextweb","http://feeds.feedburner.com/core77/blog","http://feeds.feedburner.com/failblog","http%3A%2F%2Fwww.businessinsider.com%2Fws%2Fcustomfeed%3Fid%3D4e949d77ecad04f562000027","http%3A%2F%2Fmobapp.bloomberg.com%2Fapps%2Fnews%2Ffeed%2Fpartner%2Fpulse%3Fproduct%3Dbbw","http://blog.foodnetwork.com/fn-dish/feed/","http://www.okmagazine.com/feeds/full-stories","http://www.popsugar.com/api/pulse/fitsugar","http://feeds.feedburner.com/PetaPixel","http://feeds.feedburner.com/selectism/rss","http://hypebeast.com/feed/","http://www.booooooom.com/feed","http://www.mensfitness.com/feeds/full-stories","http%3A%2F%2Fdata.msnbc.msn.com%2Ffeeds%2Ftravel%2Fpulse%3Foutput%3Datom","api://motortrend","http://feeds.feedburner.com/TheAtlanticWire","http://feeds.boingboing.net/boingboing/iBag","http%3A%2F%2Fmashable.com%2Ffeed%2F%3Fcampaign%3DMash-BD-Synd-Pulse-All-Full%26mpp%3Dfalse%26full%3D1","http://feeds.feedburner.com/cnet/pRza","http%3A%2F%2Fpipes.yahoo.com%2Fpipes%2Fpipe.run%3F_id%3Dd0f11f71c7db0ddb409f24431f767024%26_render%3Drss"];PulseApp.Environment.Preloads={};PulseApp.Environment.Preloads.Science=[{page_position:0,sources:[{updated:1348868328,source_title:"Popular Science",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.popsci.com/rss.xml",is_deleted:false,source_position:0},{updated:1348868328,source_title:"Wired Science",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.wired.com/wiredscience/feed/",is_deleted:false,source_position:1},{updated:1348868328,source_title:"Popular Mechanics",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://subscribe.hearstmags.com/feeds/pulse/pulse_rss",is_deleted:false,source_position:2},{updated:1348868328,source_title:"Discovery News",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=full://feeds.feedburner.com/DiscoveryNews-Top-Stories",is_deleted:false,source_position:3}],page_title:"Science"}];PulseApp.Environment.Preloads.Gaming=[{page_position:0,sources:[{updated:1348868328,source_title:"IGN",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=api://youtube-IGNEntertainment",is_deleted:false,source_position:0},{updated:1348868328,source_title:"GamesBeat",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://venturebeat.com/category/games/feed",is_deleted:false,source_position:1},{updated:1348868328,source_title:"Joystiq",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.joystiq.com/rss.xml",is_deleted:false,source_position:2,},{updated:1348868328,source_title:"GamesRadar",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.gamesradar.com/all-platforms/all-articles/feed/",is_deleted:false,source_position:3,}],page_title:"Gaming"}];PulseApp.Environment.Preloads.WomensFashion=[{page_position:0,sources:[{updated:1348868328,source_title:"People Style Watch",source_url:"http://stylenews.peoplestylewatch.com/feed/",is_deleted:false,source_position:0},{updated:1348868328,source_title:"HuffPost Style",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.huffingtonpost.com/feeds/android/Style_pulse.xml",is_deleted:false,source_position:1},{updated:1348868328,source_title:"Styleite",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.styleite.com/feed/",is_deleted:false,source_position:2},{updated:1348868328,source_title:"The ZOE Report",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.thezoereport.com/rss-feed/",is_deleted:false,source_position:3}],page_title:"Women's Fashion"}];PulseApp.Environment.Preloads.FunAndHumor=[{page_position:0,sources:[{updated:1348868329,source_title:"I Can Has Cheezburger?",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://feeds.feedburner.com/ICanHasCheezburger",is_deleted:false,source_position:0},{updated:1348868329,source_title:"Buzzfeed",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http%3A%2F%2Fwww.buzzfeed.com%2Fpulsebuzzfeed.xml%3Fbfsrc%3Dpulse",is_deleted:false,source_position:1},{updated:1348868329,source_title:"Cracked",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.cracked.com/crackedrss/featuredarticlesfull.xml",is_deleted:false,source_position:2},{updated:1348868329,source_title:"Fail Blog",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://feeds.feedburner.com/failblog",is_deleted:false,source_position:3}],page_title:"Fun & Humor"}];PulseApp.Environment.Preloads.Business=[{page_position:0,sources:[{updated:1348868329,source_title:"Fast Company",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.fastcompany.com/rss.xml",is_deleted:false,source_position:0},{updated:1348868329,source_title:"Inc. Magazine",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.inc.com/rss.xml",is_deleted:false,source_position:1},{updated:1348868329,source_title:"Business Insider",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http%3A%2F%2Fwww.businessinsider.com%2Fws%2Fcustomfeed%3Fid%3D4e949d77ecad04f562000027",is_deleted:false,source_position:2},{updated:1348868329,source_title:"Bloomberg Businessweek",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http%3A%2F%2Fmobapp.bloomberg.com%2Fapps%2Fnews%2Ffeed%2Fpartner%2Fpulse%3Fproduct%3Dbbw",is_deleted:false,source_position:3}],page_title:"Business"}];PulseApp.Environment.Preloads.Food=[{page_position:0,sources:[{updated:1348868329,source_title:"Saveur",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.saveur.com/rss_newrecipes.jsp",is_deleted:false,source_position:0},{updated:1348868329,source_title:"Punchfork",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=api://punchfork",is_deleted:false,source_position:1},{updated:1348868329,source_title:"Food Network Dish",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://blog.foodnetwork.com/fn-dish/feed/",is_deleted:false,source_position:2},{updated:1348868329,source_title:"Serious Eats",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://feeds.seriouseats.com/seriouseatsfeaturesvideos",is_deleted:false,source_position:3}],page_title:"Food"}];PulseApp.Environment.Preloads.WomensHealth=[{page_position:0,sources:[{updated:1348868330,source_title:"SELF Magazine",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.self.com/ipad/blogs/pulse/ext.xml",is_deleted:false,source_position:0},{updated:1348868330,source_title:"Women's Health",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.womenshealthmag.com/washpofeed",is_deleted:false,source_position:1},{updated:1348868330,source_title:"FITSUGAR",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.popsugar.com/api/pulse/fitsugar",is_deleted:false,source_position:2}],page_title:"Women's Health"}];PulseApp.Environment.Preloads.Photography=[{page_position:0,sources:[{updated:1348868330,source_title:"500px",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://feed.500px.com/500px-best",is_deleted:false,source_position:0},{updated:1348868330,source_title:"Popular Photography",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.popphoto.com/rss.xml",is_deleted:false,source_position:1},{updated:1348868330,source_title:"American Photo",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.americanphotomag.com/rss.xml",is_deleted:false,source_position:2},{updated:1348868330,source_title:"PetaPixel",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://feeds.feedburner.com/PetaPixel",is_deleted:false,source_position:3}],page_title:"Photography"}];PulseApp.Environment.Preloads.MensFashion=[{page_position:0,sources:[{updated:1348868330,source_title:"The GQ Eye",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.gq.com/style/blogs/the-gq-eye/rss.xml",is_deleted:false,source_position:0},{updated:1348868330,source_title:"Selectism",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://feeds.feedburner.com/selectism/rss",is_deleted:false,source_position:1},{updated:1348868330,source_title:"Hypebeast",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://hypebeast.com/feed/",is_deleted:false,source_position:2},{updated:1348868330,source_title:"Enterase",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://feeds.feedburner.com/Enterase",is_deleted:false,source_position:3}],page_title:"Men's Fashion"}];PulseApp.Environment.Preloads.Art=[{page_position:0,sources:[{updated:1348868330,source_title:"Drawn",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://drawn.ca/feed/",is_deleted:false,source_position:0},{updated:1348868331,source_title:"BOOOOOOOM!",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.booooooom.com/feed",is_deleted:false,source_position:1},{updated:1348868331,source_title:"Doodlers Anonymous",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://feeds.feedburner.com/DoodlersAnonymous",is_deleted:false,source_position:2}],page_title:"Art"}];PulseApp.Environment.Preloads.MensHealth=[{page_position:0,sources:[{updated:1348868331,source_title:"Men's Fitness",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.mensfitness.com/feeds/full-stories",is_deleted:false,source_position:0},{updated:1348868331,source_title:"Men's Health",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.menshealth.com/events-promotions/pulse",is_deleted:false,source_position:1}],page_title:"Men's Health"}];PulseApp.Environment.Preloads.Auto=[{page_position:0,sources:[{updated:1348868331,source_title:"MOTOR TREND",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=api://motortrend",is_deleted:false,source_position:0},{updated:1348868331,source_title:"Road & Track",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://blog.roadandtrack.com/feed/",is_deleted:false,source_position:1},{updated:1348868331,source_title:"CNET Cars",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://feeds.feedburner.com/cnet/SEcv",is_deleted:false,source_position:2},{updated:1348868331,source_title:"Car and Driver",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://feeds.feedburner.com/caranddriver/blog",is_deleted:false,source_position:3}],page_title:"Auto"}];PulseApp.Environment.Preloads.Travel=[{page_position:0,sources:[{updated:1348868331,source_title:"Lonely Planet",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://inside-digital.blog.lonelyplanet.com/feed/atom/",is_deleted:false,source_position:0},{updated:1348868331,source_title:"Fodor's Travel",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.fodors.com/wire/feedlimited.xml",is_deleted:false,source_position:1},{updated:1348868331,source_title:"LandLopers",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://feeds.feedburner.com/landlopers",is_deleted:false,source_position:2},{updated:1348868331,source_title:"MSNBC Travel",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http%3A%2F%2Fdata.msnbc.msn.com%2Ffeeds%2Ftravel%2Fpulse%3Foutput%3Datom",is_deleted:false,source_position:3}],page_title:"Travel"}];PulseApp.Environment.Preloads.Architecture=[{page_position:0,sources:[{updated:1348868331,source_title:"plusMOOD",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://feeds.feedburner.com/plusmood",is_deleted:false,source_position:0},{updated:1348868331,source_title:"Freshome",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://freshome.com/feed/",is_deleted:false,source_position:1},{updated:1348868331,source_title:"Archinect",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://archinect.com/ws/currents/featured/01",is_deleted:false,source_position:2}],page_title:"Architecture"}];PulseApp.Environment.Preloads.Comics=[{page_position:0,sources:[{updated:1348868331,source_title:"Dilbert Daily Strip",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://feeds.feedburner.com/DilbertDailyStrip",is_deleted:false,source_position:0},{updated:1348868331,source_title:"Spiked Math Comics",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://spikedmath.com/atom.xml",is_deleted:false,source_position:1},{updated:1348868332,source_title:"Bad Machinery",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://badmachinery.com/index.xml",is_deleted:false,source_position:2}],page_title:"Comics"}];PulseApp.Environment.Preloads.Design=[{page_position:0,sources:[{updated:1348868332,source_title:"Core77",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://feeds.feedburner.com/core77/blog",is_deleted:false,source_position:0},{updated:1348868332,source_title:"Coolhunting",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.coolhunting.com/index.xml",is_deleted:false,source_position:1},{updated:1348868332,source_title:"Contemporist",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://feeds.feedburner.com/contemporist",is_deleted:false,source_position:2},{updated:1348868332,source_title:"My Modern Met",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http%3A%2F%2Fwww.mymodernmet.com%2Fprofiles%2Fblog%2Ffeed%3Fpromoted%3D1%26xn_auth%3Dno",is_deleted:false,source_position:3}],page_title:"Design"}];PulseApp.Environment.Preloads.Politics=[{page_position:0,sources:[{updated:1348868327,source_title:"AP Politics",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=api://ap-politics",is_deleted:false,source_position:0},{updated:1348868328,source_title:"Slate Politics",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.slate.com/articles/news_and_politics.fulltext.all.20.rss",is_deleted:false,source_position:1}],page_title:"Politics"}];PulseApp.Environment.Preloads.Music=[{page_position:0,sources:[{updated:1348868327,source_title:"Earmilk",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.earmilk.com/feed",is_deleted:false,source_position:0},{updated:1348869193,source_title:"The 405",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.thefourohfive.com/feed",is_deleted:false,source_position:1}],page_title:"Music"}];PulseApp.Environment.Preloads.News=[{page_position:0,sources:[{updated:1348254480,source_title:"The New Yorker",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http%3A%2F%2Fpipes.yahoo.com%2Fpipes%2Fpipe.run%3F_id%3Dd0f11f71c7db0ddb409f24431f767024%26_render%3Drss",is_deleted:false,source_position:0},{updated:1348254480,source_title:"AP Top News",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=api://ap-topnews",is_deleted:false,source_position:1},{updated:1348254480,source_title:"The Daily Beast",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.thedailybeast.com/feed/partner/pulse.fullbody.xml",is_deleted:false,source_position:2},{updated:1348254480,source_title:"Wall Street Journal",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://online.wsj.com/xml/rss/3_7865.xml",is_deleted:false,source_position:3}],page_title:"News"}];PulseApp.Environment.Preloads.Sports=[{page_position:0,sources:[{updated:1348254480,source_title:"ESPN",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=api://espn/espn",is_deleted:false,source_position:0},{updated:1348254480,source_title:"AP Sports",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=api://ap-sports",is_deleted:false,source_position:1},{updated:1348254480,source_title:"Bleacher Report Top Stories",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http%3A%2F%2Fbleacherreport.com%2Fpartner_feeds%2F%3Fcolumnists%3Dtrue%26full%3Dtrue%26thumbs%3Dinline%26hook%3Dtrue%26items%3D25%26utm_source%3Dpulse%26utm_medium%3Dreferral",is_deleted:false,source_position:2}],page_title:"Sports"}];PulseApp.Environment.Preloads.Technology=[{page_position:0,sources:[{updated:1348254480,source_title:"The Verge",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.theverge.com/rss/full.xml",is_deleted:false,source_position:0},{updated:1348254480,source_title:"Engadget",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.engadget.com/rss.xml",is_deleted:false,source_position:1},{updated:1348254480,source_title:"The Next Web",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://feeds2.feedburner.com/thenextweb",is_deleted:false,source_position:2},{updated:1348254480,source_title:"All Things Digital",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://allthingsd.com/feed",is_deleted:false,source_position:3},{updated:1348254480,source_title:"PCMag",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://rssnewsapps.ziffdavis.com/static/pcmagmobilefeed.xml",is_deleted:false,source_position:4}],page_title:"Technology"}];PulseApp.Environment.Preloads.Entertainment=[{page_position:0,sources:[{updated:1348254481,source_title:"SPIN Magazine",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.spin.com/blog/feed",is_deleted:false,source_position:0},{updated:1348254481,source_title:"Gawker",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://gawker.com/vip.xml",is_deleted:false,source_position:1},{updated:1348254481,source_title:"OK! Magazine",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=http://www.okmagazine.com/feeds/full-stories",is_deleted:false,source_position:2},{updated:1348254481,source_title:"AP Entertainment",source_url:"http://hr-pulsesubscriber.appspot.com/items?feed=api://ap-entertainment",is_deleted:false,source_position:3}],page_title:"Entertainment"}];PulseApp.Views.ModalPrompt=Backbone.View.extend({parent:$("body"),id:"modalprompt",className:"abs",onLeftClick:function(a){this.$el.find("#modalprompt-button-left").click(a)},onRightClick:function(a){this.$el.find("#modalprompt-button-right").click(a)},events:{"click #modalprompt-clickoff":"clickoffClick","click .icon-close":"clickoffClick"},template:function(a){return _.template(PulseApp.Templates.ModalPrompt,{data:a})},initialize:function(d,k,b,e,h,g){_.bindAll(this,"onRightClick","onLeftClick","clickoffClick");pulse.console.log(this.cid);if(h&&g){h=Math.max(0,h);g=Math.max(0,g)}else{h=$(window).width()/2-(315/2);g=$(window).height()/2-(315/2)}var j=this.template({header:d,message:k,leftButton:b,rightButton:e,x:h,y:g});this.$el.append(j);this.parent.append(this.$el);var a=$("#modalprompt-dialog");var f=$(window).width()-a.width();var c=$(window).height()-a.height();if(h>f){a.css({left:f})}if(g>c){a.css({top:c})}},clickoffClick:function(){this.remove()}});PulseApp.Views.ForceSignUpUpsellModal=Backbone.View.extend({parent:$("body"),id:"modalprompt",className:"abs",events:{"click .icon-close":"remove","click #facebook-signup":"facebookLogin","click #email-signup":"showEmailSignup","click #email-signup-text":"showEmailSignup"},template:function(){return _.template(PulseApp.Templates.ForceSignUpUpsellModal,{})},initialize:function(a){this.render();this.source=a.source},render:function(){this.$el.append(this.template);this.parent.append(this.$el);try{var d=$("#modal-dialog"),a=($(window).height()/2-d.height()/2)+"px",c=($(window).width()/2-d.width()/2)+"px";d.css({top:a,left:c})}catch(b){}},facebookLogin:function(){PulseApp.Helpers.loginWithFacebook(function(){PulseApp.Helpers.syncCurrentPage();window.location.href=document.location.origin.replace("https","http")},this.source)},showEmailSignup:function(){new PulseApp.Views.SignUpModal("Sign Up",null,"Sign Up",null,null,null,this.source);this.remove()}});PulseApp.Views.SignUpUpsellModal=Backbone.View.extend({parent:$("body"),id:"modalprompt",className:"abs",events:{"click #modalprompt-clickoff":"remove","click .icon-close":"remove","click #facebook-signup":"facebookLogin","click #email-signup":"showEmailSignup","click #email-signup-text":"showEmailSignup"},template:function(){return _.template(PulseApp.Templates.SignUpUpsellModal,{})},initialize:function(a){this.render();this.source=a.source},render:function(){this.$el.append(this.template);this.parent.append(this.$el);try{var d=$("#modal-dialog"),a=($(window).height()/2-d.height()/2)+"px",c=($(window).width()/2-d.width()/2)+"px";d.css({top:a,left:c})}catch(b){}},facebookLogin:function(){PulseApp.Helpers.loginWithFacebook(function(){PulseApp.Helpers.syncCurrentPage();window.location.href=document.location.origin.replace("https","http")},this.source)},showEmailSignup:function(){new PulseApp.Views.SignUpModal("Sign Up",null,"Sign Up",null,null,null,this.source);this.remove()}});PulseApp.Views.SignUpModal=Backbone.View.extend({parent:$("body"),id:"modalprompt",className:"abs signup",events:{"click #modalprompt-clickoff":"clickoffClick","click .icon-close":"clickoffClick","click #modalprompt-button-left":"submitForm"},template:function(a){return _.template(PulseApp.Templates.SignUpModal,{data:a})},initialize:function(e,l,c,f,j,h,a){this.source=a;_.bindAll(this,"onLeftClick");if(j&&h){j=Math.max(0,j);h=Math.max(0,h)}else{j=$(window).width()/2-(425/2);h=$(window).height()/2-(490/2)}var k=this.template({header:e,message:l,leftButton:c,rightButton:f,x:j,y:h,signupPath:a,});this.$el.append(k);this.parent.append(this.$el);var b=$("#modalprompt-dialog");var g=$(window).width()-b.width();var d=$(window).height()-b.height();if(j>g){b.css({left:g})}if(h>d){b.css({top:d})}},submitForm:function(){var b=this.$el.find("#signup-form"),d=this.$el.find("#throbber"),a=true,f=/^([\w.!#$%&'*+-\/=?\^_`{|}~-]+@([\w-]+\.)+[\w-]{2,4})?$/,c=/^[\w-\u00C0-\u024F ]+$/,e=this.source;b.find(".error").remove();d.show();_.each(b.find("input"),function(g,h){g.value=$.trim(g.value);if(g.id=="name"){if(g.value===""){$(g).after('<span class="error">Required Field</span>');a=false}else{if(!c.test(g.value)){$(g).after('<span class="error">Please use letters and numbers only</span>');a=false}}}if(g.id=="email"){if(!f.test(g.value)||g.value===""){$(g).after('<span class="error">Invalid Email</span>');a=false}}if(g.id=="password"&&g.value===""){$(g).after('<span class="error">Required Field</span>');a=false}});if(a){$.ajax({url:b.attr("action"),type:"POST",data:b.serialize(),success:function(g){PulseApp.Helpers.syncCurrentPage();window.location.href=document.location.origin.replace("https","http")},error:function(h){d.hide();try{var g=JSON.parse(h.responseText);if(g.error.message.email){b.find("#email").after('<span class="error">'+g.error.message.email+"</span>")}else{if(g.error.message.password){b.find("#password").after('<span class="error">'+g.error.message.password+"</span>")}else{b.append('<span class="error">Please fill in all the required fields.</span>')}}}catch(j){}}})}else{d.hide()}},onLeftClick:function(a){this.$el.find("#modalprompt-button-left").click(a)},clickoffClick:function(){this.remove()}});PulseApp.Views.SettingSynced=Backbone.View.extend({initialize:function(a){this.namespace=a.namespace,this.key=a.key,this.callback=a.callback,this.is_valid_setting=false,this.is_unset=false;if(_.has(PulseApp.Environment.Constants.SETTING_SYNC,this.namespace)&&_.indexOf(PulseApp.Environment.Constants.SETTING_SYNC[this.namespace],this.key)!=-1){this.is_valid_setting=true;if(PulseApp.Helpers.checkCookiefunction(this.key)!="True"){this.is_unset=true}if(PulseApp.Helpers.hasSettingSyncKey({sync_namespace:this.namespace,sync_key:this.key})){this.is_unset=false}}},remove:function(){PulseApp.Helpers.setCookie(this.key,"True",null);PulseApp.SettingSync.syncWithBackend(this.namespace,this.key,"True");Backbone.View.prototype.remove.call(this)}});PulseApp.Views.Hint=PulseApp.Views.SettingSynced.extend({parent:$("#reader_container"),id:"hint",className:"abs",events:{click:"closeHint"},initialize:function(a){this.constructor.__super__.initialize.apply(this,[a]);if(this.is_valid_setting&&this.is_unset){if(PulseApp.Hint){PulseApp.Hint.remove()}PulseApp.Hint=this;this.template=function(){return _.template(PulseApp.Templates.Modals[this.key],{})};this.render()}else{this.remove();if(this.callback){this.callback()}}},render:function(){this.$el.append(this.template());this.parent.append(this.$el)},closeHint:function(b){PulseApp.Hint=null;var a=this;this.$el.fadeOut(1000,function(){a.remove();if(a.callback){a.callback()}})}});PulseApp.Templates.Modals={};PulseApp.Templates.Modals.xbox_hint=['<div id="hint-center-container">',"<h3>Welcome to Pulse on Xbox!</h3>","<span>Here's a quick tip for using Pulse with your controller.<br>(Click anywhere to close.)</span>",'<div id="hint-image" class="xbox-controller"></div>','<div id="hint-tip" class="first-time-xbox">',"<h4>Scrolling</h4>","<span>Use the right thumbstick to scroll the page.</span>","</div>","</div>"].join("");PulseApp.Templates.Modals.first_time=['<div id="hint-center-container">',"<h3>Welcome to Pulse!</h3>","<span>We've added some popular sources based on your selection.<br> Go ahead, customize and make it your own! <br/> (Click anywhere to close.)</span>",'<div id="hint-image" class="hint-add-content"></div>','<div id="hint-tip" class="hint-add-content">',"<h4>Explore the Pulse Catalog</h4>",'<span>Use the "Add Content" button <br/> to add your favorite blogs <br/> and websites.</span>',"</div>","</div>"].join("");PulseApp.Templates.Modals.catalog_first_time=['<div id="hint-center-container">',"<h3>Add more content to your Pulse!</h3>","<span>Easily find new, interesting and popular sources to read <br/>(Click anywhere to close.)</span>",'<div id="hint-image" class="hint-catalog"></div>','<div id="hint-tip" class="hint-catalog">',"<h4>Explore the Pulse Catalog</h4>","<span>Use the “Add Content” button <br/> to explore new sources and <br/> search for your favorite blogs </br> and websites.</span>","</div>","</div>"].join("");PulseApp.Templates.Modals.reading_first_time=['<div id="hint-center-container">',"<h3>Use your keyboard to browse!</h3>","<span>Keyboard shortcuts make it easier to use Pulse.<br/>(Click anywhere to close.)</span>",'<div id="hint-image" class="hint-shortcuts"></div>','<div id="hint-tip" class="hint-shortcuts">',"<span><strong>Right/Left:</strong> Go to next/prev article <br/> <strong>Esc:</strong> Close the article <br/> <strong>Up/Down:</strong> Scroll up/down</span>","</div>","</div>"].join("");PulseApp.Templates.Modals.BrowserCompatibility=['<div id="browser-upgrade-clickoff" class="abs"></div>','<div id="browser-upgrade-dialog" class="abs">','<div class="modal-close-button abs"></div>','<div id="header-icon" class="browser_sprite"></div>',"<h1 >Sorry! We do not support your browser</h1>","<p>Pulse works best in modern browsers. Unfortunately, your browser is not supported. We recommend updating your browser for a better experience on Pulse and the web in general.</p>",'<ul id="browsers">',"<li>",'<a href="http://windows.microsoft.com/en-US/internet-explorer/downloads/ie-9/worldwide-languages" target="_blank"><div class="browser_sprite ie icon"></div>Internet Explorer 9+</a>',"</li>","<li>",'<a href="www.google.com/chrome/" target="_blank"><div class="browser_sprite chrome icon"></div>Chrome</a>',"</li>","<li>",'<a href="http://www.apple.com/safari/" target="_blank"><div class="browser_sprite safari icon"></div>Safari 5+</a>',"</li>","<li>",'<a href="http://mozilla.org/firefox" target="_blank"><div class="browser_sprite firefox icon"></div>Firefox 4+</a>',"</li>","</ul>","</div>"].join("");$(document).ready(function(){var b=640;var a=true;testMobile=function(){PulseApp.isMobile=($(window).width()<=b)};testXbox=function(){if(navigator.userAgent.match(/(Xbox)/i)){PulseApp.isXbox=true}if(PulseApp.isXbox){$("body").addClass("xbox")}};testSnapView=function(){PulseApp.isSnapView=(($(window).width()<=b)&&navigator.userAgent.match(/(Windows NT 6.2)/i))};testMobile();testSnapView();testXbox();$(window).resize(function(){testMobile();testSnapView()});$("#header-mobileview-toggle").click(function(){$("#reader_container").toggleClass("mobile-showsidebar")});$("#left-nav-catalog").click(function(){$("#reader_container").removeClass("mobile-showsidebar")})});PulseApp.Templates.TextPopUp=['<div id="clear-mask"></div>','<div id="popup-inner">',"<h3>Reading Mode</h3>","<ul>",'<li id="light" class="popup-item <% if(data.mode == "light"){ %>selected<%}%>">Light</li>','<li id="dark" class="popup-item <% if(data.mode == "dark"){ %>selected<%}%>">Dark</li>',"</ul>","<h3>Font Size</h3>","<ul>",'<li id="small" class="popup-item <% if(data.font_size == "small"){ %>selected<%}%>">Small</li>','<li id="medium" class="popup-item <% if(data.font_size == "medium"){ %>selected<%}%>">Medium</li>','<li id="large" class="popup-item <% if(data.font_size == "large"){ %>selected<%}%>">Large</li>',"</ul>","<h3>Font Style</h3>","<ul>",'<li id="serif" class="popup-item <% if(data.font_style == "serif"){ %>selected<%}%>">Serif</li>','<li id="sans" class="popup-item <% if(data.font_style == "sans"){ %>selected<%}%>">Sans Serif</li>',"</ul>",'<div id="buttonoverlay" class="icon readingsettings"></div>',"</div>"].join("");PulseApp.Templates.PopUp=['<div id="mask"></div>','<div id="popup">','<div id="popup-inner" class="rel">',"<h3>Add source to...</h3>",'<div class="add-button-small abs"></div>','<ul id="popup-list"></ul>',"</div>","</div>"].join("");PulseApp.Templates.StreamContent=['<div id="tile-grid">','<div id="tile-grid-changing"></div>',"</div>",'<div id="new-content-info" class="border-box">','<i class="icon-refresh blue" id="new-content-info-icon"></i>','<span id="new-content-info-message">Load New Stories</span>','<div id="new-content-info-shadow"></div>',"</div>"].join("");PulseApp.Templates.StoryTile=['<div class="story-bg rel<%if(data.is_read){%> read<%}%>"',"<% if (data.tile_img_url) { %> ",'style="background-image: url(<%= data.tile_img_url %>)"',"<% } else if (data.image_url) { %>",'style="background-image: url(<%= data.image_url %>)"',"<% } %> >",'<div class="story-color story-color-<%= Math.floor(Math.random() * 6 + 1) %>"></div>','<div class="story-tile-byline<% if (data.textOnly) { %> story-text-only<% } %><% if (data.truncatedTitle && data.truncatedTitle.length > 50) { %> long-title<% } else { %> short-title<% } %>">','<div class="title"><%= data.truncatedTitle %></div>','<div class="source">','<% if ("source_title" in data && data.source_title !== null){ %><%= data.source_title %>','<% } else if ("domain" in data && data.domain !== null){ %> <%= data.domain %><% } %>',"</div>","</div>","</div>"].join("");PulseApp.Templates.ReadingListStory=['<div class="story-bg rel<%if(data.is_read){%> read<%}%>"',"<% if (data.tile_img_url) { %> ",'style="background-image: url(<%= data.tile_img_url %>)"',"<% } else if (data.image_url) { %>",'style="background-image: url(<%= data.image_url %>)"',"<% } %> >",'<div class="story-color story-color-<%= Math.floor(Math.random() * 6 + 1) %>"',"></div>",'<div class="story-tile-byline<% if (data.textOnly) { %> story-text-only <% } else { %> story-text-w-img <% } %> <% if (data.truncatedTitle && data.truncatedTitle.length > 50) { %> long-title<% } else { %> short-title<% } %>">','<div class="title"><%= data.truncatedTitle %></div>',"</div>","</div>","</div>"].join("");PulseApp.Templates.ReadingListStoryIE10=['<div class="story story-color story-color-<%= Math.floor(Math.random() * 6 + 1) %>">','<div class="title"><%= data.truncatedTitle %></div>',"<% if (data.tile_img_url || data.image_url) { %>",'<div class="story-bg"',"<% if (data.tile_img_url) { %> ",'style="background-image: url(<%= data.tile_img_url %>)"',"<% } else if (data.image_url) { %>",'style="background-image: url(<%= data.image_url %>)"',"<% } %> ></div>","<% } %>","</div>"].join("");PulseApp.Templates.ReadingView=['<div class="reading-container">','<div id="reading-modal" class="reading-content" class="abs">','<div class="reading-shadow-left"></div>','<div class="reading-shadow-right"></div>',"</div>","</div>",'<div id="reading-header-container">','<div id="reading-header-content">','<div id="reading-header">','<div id="back_button" class="reading-header-button"><i class="icon-closethin white"></i></div>','<div id="prev_article_button" class="reading-header-button"><i class="icon-leftthin white"></i></div>','<div id="next_article_button" class="reading-header-button"><i class="icon-rightthin white"></i></div>','<h2 class="topbar_title">',"<% if (data.publisher_img) { %>",'<div class="topbar_icon" style="background: url(<%= data.publisher_img %>&width=22&height=22);"></div>',"<% } %>",'<span id="source-title" class="ellipsis" <% if (!data.publisher_img) { %> style="left:0;" <% } %>>','<% if ("source_title" in data && data.source_title !== null){ %><%= data.source_title %>','<% } else if ("domain" in data && data.domain !== null){ %> <%= data.domain %><% } %>',"</span>","</h2>",'<div class="reading-shadow-left"></div>','<div class="reading-shadow-right"></div>',"</div>","</div>","</div>",'<div id="reading-ui">','<div id="article-navigation-bar" class="border-box abs">','<ul id="reading_view_share" class="border-box">','<li class="border-box rel">','<a id="linkedin" class="share border-box" title="Post to Linkedin">','<i class="icon-linkedin light"></i>',"</a>","</li>",'<li class="border-box rel">','<a id="facebook" class="share border-box" title="Post to Facebook">','<i class="icon-facebook light"></i>',"</a>","</li>",'<li class="border-box rel">','<a id="twitter" class="share border-box" title="Post to Twitter">','<i class="icon-twitter light"></i>',"</a>","</li>",'<li class="border-box rel">','<a id="email" class="share border-box" title="Mail">','<i class="icon-mail light"></i>',"</a>","</li>",'<li class="border-box rel">','<a id="save" class="share border-box <% if(data.is_saved ){ %>selected<% } %>" title="Save">','<i class="icon-star light"></i>',"</a>","</li>",'<li class="border-box rel">','<a id="text-options" class="border-box" title="Options">','<i class="icon-readsettings light"></i>',"</a>","</li>","</ul>","</div>",'<div id="draglist-shadow"></div>','<div id="draglist">','<div id="rightlist">','<div id="rightlist-wrapper">','<div id="rightlist-content" class="reading-list-items"></div>','<div id="rightlist-overlay"></div>',"</div>","</div>",'<div id="leftlist">','<div id="leftlist-wrapper">','<div id="leftlist-content" class="reading-list-items"></div>','<div id="leftlist-overlay"></div>',"</div>","</div>","</div>","</div>",'<div id="reading-modal-clickoff" class="reading-container">','<div id="reading-frames-content" class="reading-content">','<div id="reading-frames" ></div>',"</div>","</div>"].join("");PulseApp.Templates.ReadingContentTemplate=['<iframe sandbox="allow-same-origin allow-scripts allow-forms" class="reading-view-frame" src="about:blank"></iframe>'].join("");PulseApp.Templates.OtherReadingContentTemplate=['<iframe class="reading-view-frame" src="about:blank"></iframe>'].join("");PulseApp.Templates.ReadingRecommendedHeaderTemplate=["<div id=__pulse_ref_header>","<div class='referral_pic'>","<img width=70 height=70 src='/api/v2/user/profile_photo?user_id=<%= user_id %>'></img>","</div>","<div id=__pulse_ref_header_text>","<b><%= user_name %></b> recommended this story on <b>Pulse, the visual news reader</b>. Organize and follow your favorite sites.","</div>","<div id='getstarted' class='blue-button'>","<span>Join Pulse</span>","</div>","</div>","<div id=__pulse_ref_header_filler></div>",].join("");PulseApp.Templates.ReadingTemplate=['<div id="__pulse_article">','<div id="__pulse_header" style="overflow: hidden; position: relative;">','<a id="__pulse_story_title_link" target="_blank" href="',"<% if (data.url != undefined){%>","<% url = data.url %>","<% }else if (data.link != undefined){ %>","<% url = data.link %>","<% } %>",'<% if (url.indexOf("?") == -1 && url.indexOf("pulse.me") == -1){ %>','<% url += "?utm_medium=referral&utm_source=pulsenews"; %>','<% }else if (url.indexOf("pulse.me") == -1){ %>','<% url += "&utm_medium=referral&utm_source=pulsenews"; %>',"<% } %>",'<%= url %>">','<h1 id="__pulse_story_title"><%= data.title %></h1>',"</a>",'<h2 id="__pulse_story_byline">',"<% if (data.author){ %>",'by <%= data.author %><span class="__pulse_story_byline_divider">|</span>',"<% } %>","<% if (data.type == 'bookmark'){ %>",'<span class="__pulse_story_date"><%= data.date %></span><span class="__pulse_story_byline_divider">|</span>',"<% } %>","<% if (data.prettyDate){ %>",'<span class="__pulse_story_date"><%= data.prettyDate %></span>',"<% } else { %>",'<% if (data.publishedDate) { %><br><span class="__pulse_story_date"><%= data.publishedDate %> <% } %></span>',"<% } %>","</h2>","</div>",'<div id="__pulse_content">','<% if ("text" in data){%>',"<%= data.text %>","<% } else { %>","<%= data.content %>","<% } %>","</div>","</div>"].join("");PulseApp.Templates.NoSavedStories=['<div id="no-saved-container">',"<hgroup>","<h1>Save stories to read later</h1>","<h2>Access them on your mobile, tablets and the web</h2>","</hgroup>",'<ul id="saved-tutorial-items">','<li class="first">','<img id="saved-onboarding-1" class="tile" src="<%=PulseApp.Environment.Constants.saved_onboarding_placeholder[0]%>" />',"<p>Click on the star when reading a story to save it to read later</p>","</li>","<li>",'<img id="saved-onboarding-2" class="tile" src="<%=PulseApp.Environment.Constants.saved_onboarding_placeholder[1]%>" />',"<p>Access Saved stories on your mobile devices, on the go</p>","</li>",'<li class="last">','<img id="saved-onboarding-3" class="tile" src="<%=PulseApp.Environment.Constants.saved_onboarding_placeholder[2]%>" />','<p>Use our <a href="/bookmarklet" target="_blank">bookmarklet</a> to save stories from anywhere</p>',"</li>","</ul>","</div>"].join("");PulseApp.Templates.CatalogResultRow=['<img src="<%= data.image_url %>"></img>','<div class="name"><%= data.domain %></div>','<div class="add-button <% if(data.is_added){ %> added<% } %>"></div>'].join("");PulseApp.Templates.BaseModal=['<div id="modalprompt-clickoff"></div>','<div id="modal-dialog" style="left:<%= data.x %>px; top:<%= data.y %>px;">','<% if(data.header){%><h2 id="modalprompt-header" class="ellipsis"><i class="icon-closethin white abs"></i><%= data.header %></h2><% } %>',"</div>","</div>"].join("");PulseApp.Templates.SignUpUpsellModal=['<div id="modalprompt-clickoff"></div>','<div id="modal-dialog">','<div id="signup-upsell-container">','<i class="icon-close dark abs"></i>','<h1 class="upsell-top-header">Create a Pulse Account to:</h1>','<div class="upsell-tile-row clear">','<div class="upsell-tile blue-gradient rel border-box">',"<h3>Add Your </br> Favorite Sources</h3>",'<div class="sprite-modal-upsell companies abs"></div>',"</div>",'<div class="upsell-tile gray-gradient rel border-box">',"<h3>Read </br> Anywhere</h3>",'<div class="sprite-modal-upsell devices abs"></div>',"</div>",'<div class="upsell-tile blue-gradient rel border-box">',"<h3>Save Stories To </br> Read Later</h3>",'<div class="sprite-modal-upsell saved abs"></div>',"</div>","</div>",'<div class="upsell-bottom">','<div id="facebook-signup" class="upsell-button facebook-gradient">','<span class="icon-facebook white"></span>Sign Up via Facebook',"</div>",'<div id="email-signup" class="upsell-button">Sign Up via Email</div>','<p id="email-signup-text">or sign up via email</p>',"</div>","</div>","</div>","</div>"].join("");PulseApp.Templates.ForceSignUpUpsellModal=['<div id="modalprompt-clickoff" style="opacity:0.6"></div>','<div id="modal-dialog">','<div id="signup-upsell-container">','<i class="icon-close dark abs" style="font-size: 8px"></i>','<h1 class="upsell-top-header" style="padding:30px 0 20px 0">Pulse is better with friends.</br>Join now to get started!</h1>','<div class="upsell-tile-row clear" style="width:550px">','<div style="left: 80px;" class="fb-facepile" data-size="large" data-app_id=110137889015352 data-max-rows="1" data-width="390"></div>',"</div>",'<div class="upsell-bottom">','<div id="facebook-signup" class="upsell-button facebook-gradient" style="margin: 0 auto 10px auto;">','<span class="icon-facebook white"></span>Sign Up via Facebook',"</div>",'<div id="email-signup" class="upsell-button">Sign Up via Email</div>','<span style="font-size: 12px; text-align: center; width: 100%; display: inline-block; padding: 0 0 20px 0;">Pulse will not post without your permission.</span>','<p id="email-signup-text" style="font-size: 14px">Don\'t have Facebook?</p>',"</div>","</div>","</div>","</div>"].join("");PulseApp.Templates.ModalPrompt=['<div id="modalprompt-clickoff"></div>','<div id="modalprompt-dialog" style="left:<%= data.x %>px; top:<%= data.y %>px;">','<h2 id="modalprompt-header" class="ellipsis"><i class="icon-close white abs"></i><%= data.header %></h2>','<span id="modalprompt-message"><%= data.message %></span>','<div id="modalprompt-button-left" class="modalprompt-button <% if (data.leftButton == "Connect Facebook"){ %> facebook-button <% } %> "><%= data.leftButton %></div>',"<% if (data.rightButton.length > 0) { %>",'<div id="modalprompt-button-right" class="modalprompt-button"><%= data.rightButton %></div>',"<% } %>","</div>"].join("");PulseApp.Templates.SignUpModal=['<div id="modalprompt-clickoff"></div>','<div id="modalprompt-dialog" style="left:<%= data.x %>px; top:<%= data.y %>px;">','<h2 id="modalprompt-header"><i class="icon-close dark abs"></i><%= data.header %></h2>','<form id="signup-form" action="/signup" method="post" novalidate="" _lpchecked="1">','<input type="hidden" name="mode" value="direct-signup">','<input type="hidden" name="signupPath" value="<%= data.signupPath %>">',"<fieldset>",'<label for="name" style="">Full Name</label>','<input id="name" class="border-box" type="text" name="full_name" placeholder="John Smith" maxlength="30" tabindex="1" autofocus="autofocus">',"</fieldset>","<fieldset>",'<label for="email" style="">Email</label>','<input id="email" class="border-box" type="email" name="email" placeholder="john@domain.com" tabindex="2">',"</fieldset>","<fieldset>",'<label for="password" style="">Password</label>','<input id="password" class="border-box" type="password" name="password" placeholder="password" tabindex="3">',"</fieldset>","<fieldset>",'<div id="throbber"></div>','<div id="modalprompt-button-left" class="modalprompt-button" tabindex="4"><%= data.leftButton %></div>',"<fieldset>","</form>","</div>"].join("");PulseApp.Templates.NotSupported=['<div class="feed-not-supported">This feed is currently not supported in the web app</div>'].join("");PulseApp.Helpers.beautifyDate=function(d){var b,g,a={},h,c,f,e;a="January,February,March,April,May,June,July,August,September,October,November,December".split(",");if(d.toString().replace(/[^a-z]/gi,"").length!=0){f=new Date(d)}else{f=new Date(d*1000)}g=f.getMonth();b=f.getDate();e=f.getFullYear();g=a[g];c=(g+" "+b+", "+e);return c};PulseApp.Helpers.streamDate=function(e){var a,d,c,g,b,f;a=Date.parse(e);d=new Date(a);g=Math.ceil(d.getTime()/1000);c=Math.ceil(new Date().getTime()/1000);b=Math.round(c-g);if(Math.round(b/60)<1){if(b<0){return"Just Now"}else{return Math.round(b/60)+" seconds ago"}}else{if(Math.round(b/3600)<1){return Math.round(b/60)+" minutes ago"}else{if(Math.round(b/3600)-24<1){b=Math.round(b/3600);if(b>1){return b+" hours ago"}else{return b+" hour ago"}}else{if(Math.round(b/(3600*24))<7){return Math.round(b/(3600*24))+" days ago"}else{return PulseApp.Helpers.beautifyDate(e)}}}}};PulseApp.Helpers.beautifyUrl=function(c){var b,e,d;d=c.get("link");b=document.createElement("a");b.href=d;e=b.hostname;c.set("prettyLink",e);return e};PulseApp.Helpers.shortenUrlBitly=function(b){var a,c;if(!b.model){pulse.console.log("model was not passed");return}else{a=b.model;service=b.service}$.ajax({url:"http://api.bitly.com/v3/shorten",async:false,data:{login:PulseApp.Environment.Accounts.Bitly.User,apiKey:PulseApp.Environment.Accounts.Bitly.Key,longUrl:a.get("link")||a.get("url")},dataType:"json",error:function(){pulse.console.log("bit.ly shortner failed");return},success:function(d){c=d.data.url;if(a.type==="bookmark"){a.set("shortened_url",c)}else{a.set("shortened_link",c)}PulseApp.Helpers.createShareUrl({model:a,service:service})}})};PulseApp.Helpers.shortenUrl=function(e){var d,f,c,b=[],a=e.service;if(!e.model){pulse.console.log("model was not passed");return}else{d=e.model;f=d.get("url")||d.get("link");b.push({name:"url",value:f})}c=[{url_param:"feedUrl",param:"feed_url"},{url_param:"websiteTitle",param:"source_title"},{url_param:"websiteUrl",param:"link"}];if(a){b.push({name:"channelType",value:a})}if(d.title){b.push({name:"storyTitle",value:d.title})}if(d.collection){_.each(c,function(g){if(d.collection[g.param]){b.push({name:g.url_param,value:d.collection[g.param]})}})}$.ajax({url:"/api/shorten_url",data:b,async:false,error:function(){PulseApp.Helpers.shortenUrlBitly(e)},success:function(g){var h=g.shortened_url;if(d.type==="bookmark"){d.set("shortened_url",h)}else{d.set("shortened_link",h)}PulseApp.Helpers.createShareUrl({model:d,service:a})}})};PulseApp.Helpers.createShareUrl=function(r){var f=r.model,k=r.service;var e={},n=f.get("link")||f.get("url"),j=f.get("shortened_link")||f.get("shortened_url"),o=j.split("s/")[1],d="",h="",p="320",b="640";e.feedUrl=encodeURIComponent(encodeURIComponent(f.collection.feed_url));e.websiteUrl=encodeURIComponent(encodeURIComponent(f.get("website_url")));e.storyUrl=encodeURIComponent(encodeURIComponent(n));e.storyTitle=encodeURIComponent(encodeURIComponent(f.get("title")));e.websiteTitle=encodeURIComponent(encodeURIComponent(f.collection.source_title));e.shortCode=encodeURIComponent(encodeURIComponent(o));e.shortUrl=encodeURIComponent(encodeURIComponent(j));e.channelType=encodeURIComponent(encodeURIComponent(k));e.contentSnippet=encodeURIComponent(encodeURIComponent(f.get("contentSnippet")));d+="/share?feedURL="+e.feedUrl;d+="&storyTitle="+e.storyTitle;d+="&storyUrl="+e.storyUrl;d+="&websiteTitle="+e.websiteTitle;d+="&websiteUrl="+e.websiteUrl;d+="&shortCode="+e.shortCode;d+="&channelType="+e.channelType;d+="&shortUrl="+e.shortUrl;d+="&contentSnippet="+e.contentSnippet;if(k==="email"){h=f.get("title")+"\n \n"+j+"\n\nSent from Pulse - http://pulse.me";d="mailto:?body="+encodeURIComponent(h)+"&subject="+encodeURIComponent(f.get("title"));p="640"}else{if(k==="facebook_v2"){var m=PulseApp.Environment.determineHttpHostname(),l=PulseApp.Environment.determineFacebookAppId(m);d+="&appId="+l;d+="&redirectUri="+m+"/app/successful-share";b="1000";p="550"}else{if(k==="twitter"){if(f.get("catalog_item")){var c=f.get("catalog_item").get("twitter_username");if(c!=undefined){d+="&via="+c}}}else{if(k==="linkedin"){b="600";p="378"}else{if(k==="recommend"){if(!f.get("is_recommended")){var q=PulseApp.Environment.determineHttpHostname(),a,g;if(q==="http://localhost:8000"){a=q;q="http://pulse.me"}if(__pulse_uid){g=j.replace(/http:\/\/.+\/s\//,q+"/r/")+"?u="+__pulse_uid}if(a){q=a}FB.api("/me/"+PulseApp.Environment.determineFacebookAppNamespace(q)+":recommend","post",{article:g},function(t){pulse.console.log(t);if(t.id){PulseApp.Helpers.sendRecommendedStory({model:f,action:"recommend"})}})}return}}}}}window.open(d,"_blank","width="+b+", height="+p)};PulseApp.Helpers.getLocation=function(a,b){$.ajax({url:"/api/catalog/location_lookup",data:"location="+a,async:false,error:function(){pulse.console.log("Error receiving response from server")},success:function(c){b.lat=c.data.latitude;b["long"]=c.data.longitude}})};PulseApp.Helpers.truncateWithEllipsis=function(d,a){var b;a-=3;try{if(d.length>a){b=d.substr(0,a);b=b.replace(/\s+(\S*)$/,"...")}else{b=d}}catch(c){pulse.console.log(d)}return b};PulseApp.Helpers.fetchOtherPages=function(a){_.each(a.collection.models,function(b){if(a.cid!==b.cid){b.get("page_sources").getSources();b.get("page_sources").Sources.fetch()}})};PulseApp.Helpers.refreshProfilePhotos=function(){var d=$("#form-profile-photo"),a=$("#user-avatar"),c=d.attr("src"),b=(Math.random().toString()).substr(2);a.attr("src",c+"&version="+b);d.attr("src",c+"&version="+b)};PulseApp.Helpers.refreshName=function(b,a){$("#username").text(b+" "+a)};PulseApp.Helpers.getPage=function(a){var b;a=unescape(decodeURI(a));_.each(PulseApp.UserPages.models,function(c){if(a.toLowerCase()==c.get("page_title").toLowerCase()){b=c;return}},this);return b};PulseApp.Helpers.storePreviousHistory=function(){Backbone.history.old_fragment=Backbone.history.fragment;Backbone.history.options.old_root=Backbone.history.options.root};PulseApp.Helpers.linkFacebookAccount=function(c,a,b){$.ajax({type:"PUT",url:PulseApp.Environment.Endpoints.Profile,data:"fb_token="+c,error:b,success:a})};PulseApp.Helpers.unlinkFacebookAccount=function(a,b){$.ajax({type:"PUT",url:PulseApp.Environment.Endpoints.Profile,data:"unlink_account=fb",error:b,success:a})};PulseApp.Helpers.isSupportedSource=function(b){var a=b.get("source_url");if(a.indexOf("http://")==-1){return false}else{if(a.indexOf("paid_feed")!=-1){return false}else{return true}}};PulseApp.Helpers.isSupportedFeed=function(a){if(a.indexOf("http://")==-1&&a.indexOf("https://")==-1){return false}else{if(a.indexOf("pulse.me")!=-1){return false}else{if(a.indexOf("paid_feed")!=-1){return false}else{return true}}}};PulseApp.Helpers.isSupportedBrowser=function(){try{var b=$.browser,a=parseInt(b.version);if(b.msie&&a>=9){return true}else{if(b.chrome){return true}else{if(b.mozilla&&a>=4){return true}else{if(b.webkit){return true}else{if(navigator.userAgent.match(/(Xbox)/i)){return true}else{return false}}}}}}catch(c){return false}};PulseApp.Helpers.setCookie=function(b,d,a){var c=new Date();c.setDate(c.getDate()+a);var e=escape(d)+((a==null)?"":"; expires="+c.toUTCString());document.cookie=b+"="+e};PulseApp.Helpers.checkCookiefunction=function(b){var c,a,e,d=document.cookie.split(";");for(c=0;c<d.length;c++){a=d[c].substr(0,d[c].indexOf("="));e=d[c].substr(d[c].indexOf("=")+1);a=a.replace(/^\s+|\s+$/g,"");if(a==b){return unescape(e)}}return null};PulseApp.Helpers.hasSettingSyncKey=function(a){var c=a.sync_namespace,b=a.sync_key;if(PulseApp.Environment.isLoggedInUser()){if(PulseApp.SettingSync.models.length>0){if(PulseApp.SettingSync.models[0].get(c)){if(PulseApp.SettingSync.models[0].get(c)[b]=="True"){return true}}}}return false};PulseApp.Helpers.removeAds=function(a){var b=[];try{_.each(a,function(d){if(d.ad_clients&&d.ad_clients.indexOf("web")==-1){pulse.console.log("Ad detected")}else{b.push(d)}})}catch(c){_gaq.push(["_trackEvent","error_removing_ad",c.toString()])}return b};PulseApp.Helpers.validatePageName=function(e){var c=30,b,g,a=[],d=PulseApp.Environment.ReservedRoutes,f="";e=_.stripTags(e);e=_.clean(e);_.each(PulseApp.UserPages.models,function(h){a.push(h.get("page_title"))});if(e==""){f="Page name is empty."}else{if(e.length>c){f="Page name is too long."}else{b=_.find(d,function(h){return e.toLowerCase()==h.toLowerCase()});g=_.find(a,function(h){return h.toLowerCase()==e.toLowerCase()});if(b||g){f="Page name is taken."}}}return f};PulseApp.Helpers.sendRecommendedStory=function(b){var a,c;if(b.model){c=b.model;new_model={type:"recommendation",author:c.get("author"),title:c.get("title"),text:c.get("content"),domain:c.collection.source_title,is_deleted:false};if(b.action=="remove"){new_model.url=c.get("url");new_model.image_url=c.get("image_url");new_model.is_deleted=true;this.remove(b.model);b.model.destroy()}else{if(b.action=="recommend"){new_model.image_url=c.get("image_urls")[0];new_model.url=c.get("link");pulse.console.log(b.model);PulseApp.LoggingHelper.recStory(b.model)}}b.data="stories_json="+escape(JSON.stringify([new_model]));pulse.console.log("sending recommended story");$.ajax({type:"PUT",url:PulseApp.Environment.Endpoints.SavedStories,data:b.data})}};PulseApp.Helpers.createSignUpModal=function(c,a,b){new PulseApp.Views.SignUpUpsellModal({source:b})};PulseApp.Helpers.syncCurrentPage=function(){$.ajax({url:PulseApp.Environment.Endpoints.SourceSync,async:false,success:function(a){if(a.data.pages.length==0){if(PulseApp.Helpers.isBrowsingRequestedUser()){PulseApp.UserPages.syncAll(new Array(PulseApp.RequestedUser.page.get("page_sources").getSyncJson()),false)}else{PulseApp.UserPages.syncAll(PulseApp.Environment.Preloads.active,false)}}}})};PulseApp.Helpers.loginWithFacebook=function(b,a){if(PulseApp.Environment.isLoggedInUser()){}else{FB.login(function(c){PulseApp.Helpers.createAccount(b,c,a)},{scope:"publish_actions, read_stream, email"})}};PulseApp.Helpers.createAccount=function(f,a,e){var d=a.authResponse.accessToken;try{var d=a.authResponse.accessToken,c=PulseApp.Environment.determineHttpsHostname()+"/signup";if(a.authResponse){_gaq.push(["_trackEvent","Homepage","Signup Complete","",1,false]);_gaq.push(["_trackEvent","Homepage","Signup Complete - Facebook","",1,false]);$.ajax({url:c,type:"POST",data:{mode:"fb",fb_token:d,signupPath:e,},success:function(g){if(PulseApp.Environment.IsFacebookConnected&&!PulseApp.Environment.isLoggedInUser()){_gaq.push(["_trackEvent","Homepage","Signup Complete","",1,false]);_gaq.push(["_trackEvent","Homepage","Signup Complete - Facebook","",1,false])}f()},error:function(g){pulse.console.log("response",g)}})}}catch(b){_gaq.push(["_trackEvent","error_facebook_auth",b.toString()])}};PulseApp.Helpers.isBrowsingRequestedUser=function(){var a=window.location.pathname.split("/")[1];if(PulseApp.RequestedUser&&PulseApp.RequestedUser.username&&a==PulseApp.RequestedUser.username){return true}else{return false}};PulseApp.Helpers.resetPersonalUrl=function(){if(Backbone.history.options.root.indexOf("publishers")!=-1){Backbone.history.options.root=PulseApp.Username?"/"+PulseApp.Username+"/":Backbone.history.options.root="/app/";Backbone.history.fragment="";return}if(PulseApp.RequestedUser){if(PulseApp.Username){if(PulseApp.RequestedUser){var a="/"+PulseApp.RequestedUser.username+"/"}if(Backbone.history.options.root==a){Backbone.history.options.root="/"+PulseApp.Username+"/";Backbone.history.fragment=""}}else{Backbone.history.options.root="/app/";Backbone.history.fragment=""}}};PulseApp.Helpers.ResetRequestedUserContexts=function(a){PulseApp.ActiveViews.Header.switchContext();PulseApp.RequestedUser.is_browsing=false};PulseApp.Helpers.CreateSourceHash=function(a){var c,b=new Sha1Generator(a.get("source_url"));c=b.sha1_six_four.replace("+","");c=c.replace(/\//g,"");c=_.truncate(c,5," ").trim(c).toLowerCase();return c};PulseApp.Helpers.markDuplicatesInCatalog=function(a,b){_.each(PulseApp.Catalog.models,function(c){if(c.items){_.each(c.items.models,function(d){if(d.items){_.each(d.items.models,function(e){if(e.get("feed_url")===(a.get("source_url")||d.get("feed_url")===a.get("feed_url"))){e.set("is_added",a.get("is_added"),{silent:true})}})}else{if(d.get("feed_url")===a.get("source_url")||d.get("feed_url")===a.get("feed_url")){d.set("is_added",a.get("is_added"),{silent:true})}}})}})};PulseApp.Helpers.SlugRoute=function(a){slugged_route=_.slugify(a);if(slugged_route.length>0){a=slugged_route}return a};PulseApp.LoggingHelper={log_batch:[],sendLog:function(a){var e=a,f=new Date(),c;try{e.hour=""+f.getHours();e.minute=""+f.getMinutes();e.username=PulseApp.Username;if(PulseApp.Profile){e.user_id=PulseApp.Profile.get("user_id");e.fb_id=PulseApp.Profile.get("fb_id")}e.pulseVersion=""+PulseApp.Version;e.session_timestamp=PulseApp.Session.start_date;$.ajax({url:"/app/send-log",type:"POST",data:{log_data:JSON.stringify(e)},dataType:"json",error:function(d){_gaq.push(["_trackEvent","error_send_log_response",d.toString()]);pulse.console.error(d.toString());return}})}catch(b){_gaq.push(["_trackEvent","error_send_log",b.toString()])}},sendBatchLogs:function(){try{$.ajax({url:"/app/send-batch-log",type:"POST",data:{batch_log_data:JSON.stringify(this.log_batch)},dataType:"json",error:function(b){_gaq.push(["_trackEvent","error_send_batch_log_response",b.toString()]);pulse.console.error(b.toString());return},success:function(b){this.log_batch=[]}})}catch(a){_gaq.push(["_trackEvent","error_send_batch_log",a.toString()]);pulse.console.error(a.toString())}},addToLogQueue:function(a){var c=a,e=new Date();try{c.hour=""+e.getHours();c.minute=""+e.getMinutes();c.username=PulseApp.Username;c.pulseVersion=""+PulseApp.Version;this.log_batch.push(c)}catch(b){_gaq.push(["_trackEvent","error_add_log_to_queue",b.toString()]);pulse.console.error(b.toString())}},logReadingSplash:function(a){try{var c={name:"Viewed Splash Story",userId:PulseApp.Profile.get("user_id"),storyTitle:a.get("title"),storyUrl:a.get("link")||this.current.model.get("url"),feedTitle:a.get("source_title"),feedUrl:a.collection.feed_url,websiteUrl:a.collection.link,websiteTitle:a.collection.source_title,fromUser:__referring_user_id};this.sendLog(c)}catch(b){_gaq.push(["_trackEvent","error_logging_reading_splash",b.toString()]);pulse.console.error(b.toString())}},logSessionStart:function(){try{PulseApp.Session={start_time:new Date().getTime(),start_date:new Date().getFullYear()+"-"+(new Date().getMonth()+1)+"-"+new Date().getDate()+" "+new Date().getHours()+":"+new Date().getMinutes()+":"+new Date().getSeconds()};var c=navigator.language||navigator.browserLanguage;var b={name:"Session Started",language:c.split("-")[0]||c.split("-")[0],country:c.split("-")[1]||c.split("-")[1]};this.sendLog(b)}catch(a){_gaq.push(["_trackEvent","error_logging_session_start",a.toString()]);pulse.console.error(a.toString())}},logSessionEnd:function(){try{var c=navigator.language||navigator.browserLanguage;var b={name:"Session Ended",secondsSpent:""+Math.floor((new Date().getTime()-PulseApp.Session.start_time)/1000),language:c.split("-")[0]||c.split("-")[0],country:c.split("-")[1]||c.split("-")[1]};this.sendLog(b)}catch(a){_gaq.push(["_trackEvent","error_logging_session_end",a.toString()]);pulse.console.error(a.toString())}},accountLogout:function(){try{var b={name:"Account Logout",channelType:"",logoutSource:"webSettings"};this.sendLog(b)}catch(a){_gaq.push(["_trackEvent","error_logging_account_logout",a.toString()]);pulse.console.error(a.toString())}},logProfileView:function(){try{var b={name:"Viewed Profile",userid:PulseApp.Profile.get("user_id")};this.sendLog(b)}catch(a){_gaq.push(["_trackEvent","error_logging_profile_view",a.toString()]);pulse.console.error(a.toString())}},starredStory:function(a){try{var c={name:"Starred Story",profileSource:"bookmark",userId:PulseApp.Profile.get("user_id"),storyTitle:a.get("title"),storyUrl:a.get("link")||this.current.model.get("url"),feedTitle:a.get("source_title"),feedUrl:a.collection.feed_url,websiteUrl:a.collection.link,websiteTitle:a.collection.source_title};this.sendLog(c)}catch(b){_gaq.push(["_trackEvent","error_logging_starred_story",b.toString()]);pulse.console.error(b.toString())}},recStory:function(a){try{var c={name:"Recommended Story",profileSource:"recommend",userId:PulseApp.Profile.get("user_id"),storyTitle:a.get("title"),storyUrl:a.get("link")||this.current.model.get("url"),feedTitle:a.get("source_title"),feedUrl:a.collection.feed_url,websiteUrl:a.collection.link,websiteTitle:a.collection.source_title};this.sendLog(c)}catch(b){_gaq.push(["_trackEvent","error_logging_recommended_story",b.toString()]);pulse.console.error(b.toString())}},removedStarredStory:function(a){try{var c={name:"Removed Starred Story",profileSource:"bookmark",userId:PulseApp.Profile.get("user_id"),storyTitle:a.get("title"),storyUrl:a.get("link")||a.get("url"),feedTitle:a.get("source_title"),feedUrl:a.collection?a.collection.feed_url:a.get("feed_url"),websiteUrl:a.collection?a.collection.link:a.get("domain_url"),websiteTitle:a.collection?a.collection.source_title:a.get("domain")};this.sendLog(c)}catch(b){_gaq.push(["_trackEvent","error_logging_starred_story",b.toString()]);pulse.console.error(b.toString())}},sharedStory:function(b,a){try{var d={name:"Shared Story",channelType:a,storyTitle:b.get("title"),storyUrl:b.get("link")||b.get("url"),feedTitle:b.get("source_title"),feedUrl:(b.collection?b.collection.feed_url:""),websiteUrl:(b.collection?b.collection.link:""),websiteTitle:(b.collection?b.collection.source_title:"")};this.sendLog(d)}catch(c){_gaq.push(["_trackEvent","error_logging_shared_story",c.toString()]);pulse.console.error(c.toString())}},visitedSharedPage:function(a){try{var c={name:"Visited Shared Page",referrer:document.referrer,fromUser:PulseApp.RequestedUser.username,pageTitle:a.get("page_title").toLowerCase(),pagePosition:a.get("page_position"),pageLayout:PulseApp.GridSetting?PulseApp.GridSetting:"smart"};this.sendLog(c)}catch(b){_gaq.push(["_trackEvent","error_logging_visited_shared_page",b.toString()]);pulse.console.error(b.toString())}},sharedPage:function(b,a){try{var d={name:"Shared Page",channelType:a,pageTitle:b.get("page_title").toLowerCase(),pagePosition:b.get("page_position"),pageLayout:PulseApp.GridSetting?PulseApp.GridSetting:"smart"};this.sendLog(d)}catch(c){_gaq.push(["_trackEvent","error_logging_shared_page",c.toString()]);pulse.console.error(c.toString())}},visitedSharedSource:function(a){try{var c={name:"Visited Shared Source",referrer:document.referrer,fromUser:PulseApp.RequestedUser.username,feedUrl:a.get("source_url"),feedTitle:a.get("source_title"),catalogItemPrimaryKey:(a.catalog_item?a.catalog_item.get("primary_key"):""),pagePosition:(a.collection?a.collection.get("page_position"):""),pageLayout:PulseApp.GridSetting?PulseApp.GridSetting:"smart"};this.sendLog(c)}catch(b){_gaq.push(["_trackEvent","error_logging_visited_shared_source",b.toString()]);pulse.console.error(b.toString())}},sharedSource:function(b,a){try{var d={name:"Shared Source",channelType:a,feedUrl:b.get("source_url"),feedTitle:b.get("source_title"),catalogItemPrimaryKey:(b.catalog_item?b.catalog_item.get("primary_key"):""),pagePosition:(b.collection?b.collection.get("page_position"):""),pageLayout:PulseApp.GridSetting?PulseApp.GridSetting:"smart"};this.sendLog(d)}catch(c){_gaq.push(["_trackEvent","error_logging_shared_source",c.toString()]);pulse.console.error(c.toString())}},addedSource:function(a,b){try{var d={name:"Added Source",feedUrl:a.get("feed_url")||a.get("source_url"),feedTitle:a.get("title")||a.get("source_title"),catalogItemPrimaryKey:a.get("string_primary_key"),catalogSource:b};if(b==="category"){d.catalogCategory=a.get("collections")}else{if(b==="shared"){d.fromUser=PulseApp.RequestedUser.username}else{d.searchTerm=$("#catalog-search").val()}}this.sendLog(d)}catch(c){_gaq.push(["_trackEvent","error_logging_added_source",c.toString()]);pulse.console.error(c.toString())}},addedPage:function(a){try{var c={name:"Added Page",pageTitle:this.model.get("page_title").toLowerCase(),fromUser:PulseApp.RequestedUser.username};this.sendLog(c)}catch(b){_gaq.push(["_trackEvent","error_logging_added_page",b.toString()]);pulse.console.error(b.toString())}},openedPage:function(c,a){try{var d={name:"Opened Page",pageType:a,pageTitle:a==="page"?c.get("page_title"):"",pagePosition:a==="page"?""+c.get("page_position"):"",pageLayout:PulseApp.GridSetting?PulseApp.GridSetting:"smart"};this.sendLog(d)}catch(b){_gaq.push(["_trackEvent","error_logging_opened_page",b.toString()]);pulse.console.error(b.toString())}},openedSource:function(b){try{var c={name:"Opened Source",feedUrl:b.get("source_url"),feedTitle:b.get("source_title"),catalogItemPrimaryKey:b.get("primary_key"),sourcePosition:""+b.get("source_position"),pagePosition:""+b.collection.page_position};this.sendLog(c)}catch(a){_gaq.push(["_trackEvent","error_logging_opened_source",a.toString()]);pulse.console.error(a.toString())}},searchQuery:function(b){try{var d=navigator.language||navigator.browserLanguage;var c={name:"Search Query",searchTerm:b,language:d.split("-")[0]||d.split("-")[0],country:d.split("-")[1]||d.split("-")[1]};this.sendLog(c)}catch(a){_gaq.push(["_trackEvent","error_logging_search_query",a.toString()]);pulse.console.error(a.toString())}},logLinkClicked:function(b,f){try{var a=f.currentTarget.href,d=f.currentTarget.hostname;var g={name:"Link Clicked",storyTitle:b.get("title"),storyUrl:b.get("link")||b.get("url"),feedTitle:b.get("source_title"),feedUrl:b.collection?b.collection.feed_url:b.get("feed_url"),websiteUrl:b.collection?b.collection.link:b.get("domain_url"),websiteTitle:b.collection?b.collection.source_title:b.get("domain"),linkUrl:a,baseLinkUrl:d};this.sendLog(g)}catch(c){_gaq.push(["_trackEvent","error_logging_link_click",c.toString()]);pulse.console.error(c.toString())}},logOnboardingSourceAdded:function(b){try{this.addToLogQueue({name:"Added Source",feedUrl:b.get("feed_url"),feedTitle:b.get("title"),catalogItemPrimaryKey:b.get("string_primary_key"),catalogSource:"onboarding"})}catch(a){_gaq.push(["_trackEvent","error_logging_onboard_source_added",a.toString()]);pulse.console.error(a.toString())}},logMovedPage:function(a,c){try{var d={name:"Moved Page",originalPagePosition:""+a,pagePosition:""+c};this.addToLogQueue(d)}catch(b){_gaq.push(["_trackEvent","error_logging_moved_page",b.toString()]);pulse.console.error(b.toString())}}};PulseApp.Helpers.localStorageCollection=Backbone.Collection.extend({initialize:function(b){if(b!==undefined){this.updateLocalStorage(b);Backbone.Collection.prototype.reset.call(this,b)}else{if(this.checkExistence()){var a=this.getFromLocalStorage();if(a!==null){this.reset(a)}}this.fetch()}},reset:function(a){if(this.models.length===0){Backbone.Collection.prototype.reset.call(this,a)}else{if(this.checkExistence()){this.updateLocalStorage(a)}}},updateLocalStorage:function(a){window.localStorage.setItem(this.localKey,JSON.stringify(a))},getFromLocalStorage:function(){return JSON.parse(window.localStorage.getItem(this.localKey))},checkExistence:function(){if(window.localStorage===undefined){return false}else{return true}},syncWithLocalStorage:function(d){var g=false,a,f,e=this.comparatorKey,c,b;if(this.checkExistence()){a=this.getFromLocalStorage();if(a!==null){_.each(a,function(j,h){f=d[h];if(f!==undefined){if(this.depth>1){for(i=0;i<this.depth.length;i++){level=this.levels[i];level_items=f[level];if(typeof(j[level])!==undefined){if(j[level].length!==level_items.length){g=true}else{_.each(j[level],function(l,k){level_item=level_items[k];level_key=this.levelKeys[i];if((typeof(level_item)=="undefined")||(l[level_key]!==level_item[level_key])){g=true;return false}},this)}}}}if(j[e]!==f[e]){g=true;return false}}},this)}else{g=true}}else{g=true}if(g){this.updateLocalStorage(d)}return g},modifyLocalStorage:function(d,g,a,c){var e=this.getFromLocalStorage(),f=[],b=0;if(!e){}else{if(g===0){f=e}else{f=e;for(b=0;b<(a.length-1);b++){f=f[a[b]];if(typeof(this.levels[b])!=="undefined"){f=f[this.levels[b]]}}}if(d==="add"){f[a[g]]=c}else{if(d==="delete"){f.splice(a[g],1)}else{if(d==="update"){f[a[g]]=c}}}if(f.length===0){e.splice(a[0],1)}this.updateLocalStorage(e)}}});PulseApp.User.Collections.RequestedUserPages=Backbone.Collection.extend({model:PulseApp.User.Models.Page});PulseApp.Models.Story=Backbone.Model.extend({defaults:{is_selected:false,is_shared:false,is_read:false,is_saved:false,is_recommended:false},initialize:function(k,l){_.bindAll(this,"removeSaved");var c=400,h=265,b=199,f=1.8,g=0,d,e,a,j;if(l&&l.collection.source_title!==undefined){k.source_title=l.collection.source_title;k.publisher_img=l.collection.publisher_img;k.twitter_username=l.collection.twitter_username;k.primary_key=l.collection.primary_key;k.Source=l.collection.Source;k.catalog_item=l.collection.catalog_item}if(!k.image_urls||k.image_urls.length===0){k=this.setImgUrl(k)}else{if(_.indexOf(k.image_urls,"pulsesubscriber")==-1){}}if(k.image_dimensions&&k.image_dimensions.length>0){e=Math.min(k.image_dimensions.length,k.image_urls.length);for(d=0;d<e;d++){a=parseInt(k.image_dimensions[d][0],10)||0;j=parseInt(k.image_dimensions[d][1],10)||0;if(a*j>g){k.tile_img_url=k.image_urls[d];k.tile_img_width=a;k.tile_img_height=j;g=a*j}}}else{if(k.image_urls.length>0){k.tile_img_url=k.image_urls[0]}}if(!k.tile_img_url){k.tile_img_url=k.image_url||(k.image_urls.length>0)?k.image_urls[0]:null;k.tile_img_width=k.tile_img_height=0}scaled_tile_img_width=k.tile_img_width*f;scaled_tile_img_height=k.tile_img_height*f;k.textOnly=(k.tile_img_url==null);if(!k.textOnly){if(!PulseApp.isMobile){if(scaled_tile_img_width>=c&&scaled_tile_img_height>=c){k.tile_img_width=c;k.tile_img_height=c}else{if(scaled_tile_img_width>=h&&scaled_tile_img_height>=h){k.tile_img_width=h;k.tile_img_height=h}else{if(scaled_tile_img_width>=b&&scaled_tile_img_height>=b){k.tile_img_width=b;k.tile_img_height=b}else{if(!scaled_tile_img_width&&!scaled_tile_img_height){k.tile_img_width=h;k.tile_img_height=h}}}}}else{k.tile_img_width=b;k.tile_img_height=b}k.tile_img_url=PulseApp.CDNPrefix.prefixUrl(k.tile_img_url+"&width="+(k.tile_img_width||h)+"&height="+(k.tile_img_height||h))}this.attributes=k;this.collection=l?l.collection:null},setImgUrl:function(b){var c,a="http://img.youtube.com/vi/{{VIDEO_HASH}}/0.jpg";b.image_urls=[];img_strs=b.content.match(/<img[^>]+>/g);_.each(img_strs,function(f){var e,g,d;g=f.match(/height="[^"]/g);d=f.match(/width="[^"]/g);(g!==null)?g=g[0].substr(8):null;(d!==null)?d=d[0].substr(7):null;if(g!=1&&d!=1){e=f.match(/src="[^"]+"/g);if(e){e=e[0];e=e.substr(5);e=e.substr(0,e.length-1);if(e&&e.indexOf("http://ads.")===-1&&e.indexOf("http://feedads.")===-1){if(e.indexOf("pulsesubscriber")===-1){b.image_urls.push("http://pulsecontentserver.appspot.com/image?link="+encodeURIComponent(e))}else{b.image_urls.push(e)}}}}});if(b.image_urls.length==0){youtube_reg=new RegExp("(?:https?://)?(?:www\\.)?(?:youtu\\.be/|youtube\\.com(?:/embed/|/v/|/watch\\?v=))([\\w-]{10,12})","g");video_reg=/poster="([^"]*)"/;video_strs=video_reg.exec(b.content);youtube_video_strs=youtube_reg.exec(b.content);if(youtube_video_strs){c=a.replace("{{VIDEO_HASH}}",youtube_video_strs[1])}else{if(video_strs){c=video_strs[1]}}if(c){b.image_urls.push("http://pulsecontentserver.appspot.com/image?link="+encodeURIComponent(c))}}return b},getUrl:function(){return this.get("url")||this.get("link")},removeSaved:function(){this.set("is_saved",false);this.set("saved_story",undefined)},removeSaved:function(){this.set("is_recommended",false)},markRead:function(){this.set("is_read",true)},toggleRecommendedState:function(){this.set("is_recommended",true);return this.get("is_recommended")}});PulseApp.Collections.UpdateStories=Backbone.Collection.extend({model:PulseApp.Models.Story,url:function(){var a;if(this.last_updated){a=this.feed_url+"&last_updated="+this.last_updated}else{a=this.feed_url}return a},initialize:function(b,a){_.bindAll(this,"updateStories");this.bind("reset",this.processChanges);this.collection=a.collection;this.feed_url=a.feed_url;this.last_updated=a.last_updated},updateStories:function(){this.fetch()},processChanges:function(){var b=this.collection.pluck("link"),c,a,d;a=this.models;d=this.models.length;for(c=0;c<d;c++){if($.inArray(a[c].get("link"),b)===-1){if(!a[c].get("ad_id")&&!a[c].get("campaign_id")){this.collection.add(a[c],{at:0})}}}},parse:function(a){this.last_updated=a.last_updated;return a.responseData.feed.entries},sync:function(c,b,a){a.dataType="jsonp";return Backbone.sync(c,b,a)}});PulseApp.Collections.Stories=Backbone.Collection.extend({model:PulseApp.Models.Story,google_feed_url:"https://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=ENTER_NUM&key=ABQIAAAATHfGGYW_Q4P_wEmpvHtDuRRqxLtO1l3CLFNAN--GVTKS1AKtchRB3pde6MUzUp13706OEclppgiTfA&q=",url:function(){var a=this.google_feed_url;this.trigger("fetching");if(this.feed_url.indexOf("hr-pulsesubscriber")==-1){if(this.offset===0){a=a.replace("ENTER_NUM",25)}else{a=a.replace("ENTER_NUM",this.offset)}return a+encodeURIComponent(this.feed_url)}else{if(location.protocol==="https:"){this.feed_url.replace("http://","https://")}return this.feed_url+"&last_story_updated="+this.last_story_updated+"&last_story_published="+this.last_story_published}},sync:function(d,c,b){var a=this;b.dataType="jsonp";b.statusCode={200:function(e){a.trigger("successful_sync");a.parse(e)}};return Backbone.sync(d,c,b)},parse:function(a){var e,d;if(a.responseData!==undefined){if(this.updateStories!==undefined){this.updateStories.last_updated=a.last_updated}this.last_updated=a.last_updated;if(this.feed_url.indexOf("hr-pulsesubscriber")==-1){var c=this.pluck("link"),b=[];this.offset+=a.responseData.feed.entries.length;_.each(a.responseData.feed.entries,function(f){if($.inArray(f.link,c)===-1){b.push(f)}});return b}else{this.offset+=25;a.responseData.feed.entries=PulseApp.Helpers.removeAds(a.responseData.feed.entries);d=_.last(a.responseData.feed.entries);if(d!==undefined){this.last_story_updated=d.last_updated;this.last_story_published=this.getLastPublishedDate(d)}return a.responseData.feed.entries}}},getLastPublishedDate:function(a){if(a.publishedDate!=""){return new Date(a.publishedDate).getTime()/1000}else{return 0}},initialize:function(){_.bindAll(this,"loadMore");this.newContentCount=0;this.bind("add",this.processNewContent)},setUpAutoUpdate:function(){this.updateStories=StoryChanges=new PulseApp.Collections.UpdateStories(this.models,{collection:this,feed_url:this.feed_url,last_updated:this.last_updated})},loadMore:function(){this.fetch({add:true})},processNewContent:function(c,b,a){if(a.index===0){this.newContentCount+=1;c.set("source_title",this.source_title);c.set("publisher_img",this.publisher_img);c.set("twitter_username",this.twitter_username);c.set("primary_key",this.primary_key);c.set("Source",this.Source);c.set("catalog_item",this.catalog_item)}},getNewContent:function(){var a;a=this.models.slice(0,(this.newContentCount-1));return a},destroying:function(){pulse.console.log("eyo")}});PulseApp.Models.Source=Backbone.Model.extend({initialize:function(){if(this.get("entries")!=undefined){var c=this.get("entries"),f=c.length-1,e=c[f],d=(e===undefined)?0:new Date(e.publishedDate).getTime(),b;b=this.get("PageSource");b.set("Source",this);b.bind("destroy",this.destroy,this);this.Stories=new PulseApp.Collections.Stories();this.Stories.Source=this;this.Stories.source_title=this.get("title");this.Stories.feed_url=this.get("feedUrl");this.Stories.catalog_item=b.get("catalog_item");this.Stories.publisher_img=this.get("PageSource").get("publisher_img");this.Stories.primary_key=this.get("PageSource").get("primary_key");this.Stories.link=this.get("link");this.Stories.last_updated=this.get("latest_story_updated")||0;this.Stories.last_story_updated=(e===undefined)?0:e.last_updated;this.Stories.last_story_published=((e===undefined)?0:(new Date(e.publishedDate).getTime())/1000);this.Stories.offset=25;this.Stories.setUpAutoUpdate();var a=this.get("entries");a=PulseApp.Helpers.removeAds(a);this.Stories.reset(a);this.bind("destroy",this.Stories.destroying,this)}else{this.Stories=new PulseApp.Collections.Stories();this.Stories.offset=0}},publisherImageAdded:function(){pulse.console.log("Publisher image added",this.publisher_img)},removed:function(){pulse.console.log("Source removed")}});PulseApp.Collections.Sources=Backbone.Collection.extend({model:PulseApp.Models.Source,url:PulseApp.Environment.Endpoints.Batch,is_syncing:false,sync:function(d,c,b){var a=this;this.trigger("fetching");b.type="GET";b.dataType="jsonp";this.is_syncing=true;b.data={deflated_feeds:this.prepFeedsArray()};b.statusCode={200:function(e){a.trigger("successful_sync");a.parse(e)},400:function(e){_gaq.push(["_trackEvent","error_batch_fetch",e])},500:function(e){_gaq.push(["_trackEvent","error_batch_fetch",e])}};return Backbone.sync(d,c,b)},parse:function(d){var f,a,b=[],c=this,h=0,g,e=false;if(d.responseData===undefined){_.each(d,function(j,k){for(f=0,a=c.PageSources.models.length;f<a;f++){g=c.PageSources.models[f];if(decodeURIComponent(k)==decodeURIComponent(g.get("source_url"))){if(g.get("Source")&&g.get("Source").Stories.models.length>0){try{if(j.responseData.feed.entries.length>0){last_story=_.last(j.responseData.feed.entries);last_existing_story=_.last(g.get("Source").Stories.models);if(last_existing_story.get("link")!=last_story.link){e=true;j.responseData.feed.entries=PulseApp.Helpers.removeAds(j.responseData.feed.entries);g.get("Source").Stories.last_story_published=g.get("Source").Stories.getLastPublishedDate(last_story);g.get("Source").Stories.last_story_updated=last_story.last_updated;g.get("Source").Stories.add(j.responseData.feed.entries)}else{if(c.models.length!==c.PageSources.models.length){j.responseData.feed.last_updated=j.last_updated;j.responseData.feed.PageSource=g;j.responseData.feed.title=g.get("source_title");j.responseData.feed.PageSource.set("last_updated",j.last_updated);b.push(j.responseData.feed)}}}}catch(l){_gaq.push(["_trackEvent","error_parse_batch",l.toString()])}}else{try{if(j.responseData!==null){j.responseData.feed.last_updated=j.last_updated;j.responseData.feed.PageSource=g;j.responseData.feed.title=g.get("source_title");j.responseData.feed.PageSource.set("last_updated",j.last_updated);b.push(j.responseData.feed)}else{feed={};feed.last_updated=j.last_updated;feed.PageSource=g;feed.title=g.get("source_title");feed.PageSource.set("last_updated",j.last_updated);b.push(feed)}}catch(l){_gaq.push(["_trackEvent","error_parse_batch",l.toString()])}}}}},this);if(e){this.CombinedSourcesStories.loadMoreStories();this.is_syncing=false}else{return b}}},prepFeedsArray:function(){var a=[],d="",c,b,e;_.each(this.PageSources.models,function(g){c=g.get("source_url");try{e=g.get("Source").Stories.last_story_updated;b=g.get("Source").Stories.last_story_published;pulse.console.log("Load more for batch request")}catch(f){pulse.console.log("First time through the batch request")}if(PulseApp.Helpers.isSupportedSource(g)){if(c.indexOf("pulsesubscriber")!=-1){a.push({feed:c,last_updated:g.get("last_updated")||"",last_story_updated:e||"",last_story_published:b||""})}else{a.push({feed:c})}}},this);d=JSON.stringify(a);d=Base64.toBase64(RawDeflate.deflate(Base64.utob(d),4));return d},initialize:function(){_.bindAll(this,"loadAllStories");this.CombinedSourcesStories=new PulseApp.Collections.CombinedSourcesStories([],{collection:this});this.remaining_feeds=[];this.fetchMore=false;this.otherSources=[];this.last_updated=0;this.refresh_required=false;this.bind("reset",this.loadAllStories,this);this.bind("add",this.loadMoreStories,this);this.updateCombinedStories=new PulseApp.Collections.UpdateCombinedStories(this.models,{collection:this})},loadAllStories:function(a){this.CombinedSourcesStories.addStories();this.is_syncing=false},loadMoreStories:function(a){if(!(a.get("source_url")||(a.get("feedUrl")))){this.remove(a,{silent:true})}else{if(a.Stories.length>0){this.loadAllStories()}else{a.Stories.bind("reset",this.loadAllStories)}}},loadMore:function(){if(!this.is_syncing){this.fetch({add:true})}},setRefreshRequired:function(){this.refresh_required=true}});PulseApp.Collections.UpdateCombinedStories=Backbone.Collection.extend({model:PulseApp.Models.Source,url:PulseApp.Environment.Endpoints.Batch,initialize:function(b,a){_.bindAll(this,"updateStories");this.bind("reset",this.processChanges);this.collection=a.collection},updateStories:function(){this.fetch()},parse:function(e){var g,h,d=[],k=this,b=0,a,j,f,c;if(e.responseData===undefined){_.each(e,function(l,m){for(g=0,h=k.collection.PageSources.models.length;g<h;g++){a=k.collection.PageSources.models[g];if(decodeURIComponent(m)==decodeURIComponent(a.get("source_url"))){if(l.responseData.feed.entries.length>0){pulse.console.log("New Stories");if(a.get("Source")){c=a.get("Source").Stories;a.set("last_updated",l.last_updated);j=c.pluck("link");f=l.responseData.feed.entries;for(b=0;b<f.length;b++){if($.inArray(f[b].link,j)===-1){try{f[b].source_title=c.source_title;f[b].publisher_img=c.publisher_img;f[b].twitter_username=c.twitter_username;f[b].primary_key=c.primary_key;f[b].Source=c.Source;f[b].catalog_item=c.catalog_item}catch(n){pulse.console.log("Error in setting parameters to new story object")}if(!f[b].ad_id&&!f[b].campaign_id){a.get("Source").Stories.add(f[b],{at:0});k.collection.CombinedSourcesStories.add(f[b],{at:0})}}}}}else{pulse.console.log("No New Stories")}}}},this);return d}},sync:function(c,b,a){a.type="GET";a.dataType="jsonp";this.is_syncing=true;a.data={deflated_feeds:this.prepFeedsArray()};return Backbone.sync(c,b,a)},prepFeedsArray:function(){var a=[],d="",c,b,e;_.each(this.collection.PageSources.models,function(f){c=f.get("source_url");if(PulseApp.Helpers.isSupportedSource(f)){if(c.indexOf("pulsesubscriber")!=-1){a.push({feed:c,last_updated:f.get("last_updated")!==undefined?f.get("last_updated"):""})}else{a.push({feed:c})}}},this);d=JSON.stringify(a);d=Base64.toBase64(RawDeflate.deflate(Base64.utob(d)));return d},});PulseApp.Collections.CombinedSourcesStories=Backbone.Collection.extend({model:PulseApp.Models.Story,load_more_limit:2,initialize:function(b,a){_.bindAll(this,"loadMoreStories");this.collection=a.collection;this.offset=0;this.addStoriesLock=false;this.newStoriesLoaded=[]},addStories:function(){var e,c,b=[],d=false,a;e=this.getAllStoriesFromAllSources();e=this.sortStoriesChronologically(e);e=_.uniq(e,true,function(f){return f.get("link")});a=0;this.reset(e)},removeStories:function(c){var a=c.get("source_title"),b=_.filter(this.CombinedSourcesStories.models,function(d){return d.get("source_title")==a});_.each(b,function(d){this.CombinedSourcesStories.remove(d);d.destroy()},this)},reset:function(a){this.offset=0;Backbone.Collection.prototype.reset.call(this,a)},fetch:function(){return},getCombinedPageStories:function(){var a=this.models.slice(this.offset,this.offset+25);this.offset+=25;if(this.offset>(this.models.length/2)&&this.load_more_limit>=0&&this.models.length!=0){this.collection.loadMore();this.load_more_limit--}return a},getAllStoriesFromAllSources:function(){var a=[];_.each(this.collection.models,function(b){a=_.union(a,b.Stories.models)},this);return a},sortStoriesChronologically:function(a){a=_.sortBy(a,function(c){var b=(c===undefined)?0:new Date(c.get("publishedDate")),d=b.getTime()/1000;return d}).reverse();return a},loadMoreStories:function(){this.add(this.getAllStoriesFromAllSources(),{silent:true})},addStory:function(a){while(this.addStoriesLock){}if(a.Stories.models.length===0){a.Stories.bind("reset",this.updateStories,this)}else{this.updateStories(a.Stories)}},updateStories:function(a){if(!this.addStoriesLock){this.addStoriesLock=true;var b=this.models;b=_.union(b,a.models);b=_.sortBy(b,function(d){var c=(d===undefined)?0:new Date(d.get("publishedDate")),e=c.getTime()/1000;return e}).reverse();b=_.uniq(b,true,function(c){return c.get("link")});this.reset(b);this.offset=0;this.addStoriesLock=false}}});PulseApp.User.Models.PageSource=Backbone.Model.extend({defaults:{is_selected:false},getOrCreateSource:function(){if(this.get("Source")!=undefined){var b=this.get("Source"),a=(new Date().getTime())/1000;if((a-b.get("last_updated"))>3600){b.fetch()}return this.get("Source")}else{this.set("Source",new PulseApp.Models.Source());b=this.get("Source");b.set("feedUrl",this.get("source_url"));b.set("title",this.get("source_title"));b.Stories.feed_url=this.get("source_url");b.Stories.source_title=this.get("source_title");b.Stories.catalog_item=this.get("catalog_item");b.Stories.publisher_img=this.get("publisher_img");b.Stories.primary_key=this.get("primary_key");b.Stories.last_story_updated=0;b.Stories.last_story_published=0;b.Stories.setUpAutoUpdate();return this.get("Source")}},initialize:function(d,c){this.bind("destroy",this.processDeletion);if(this.collection!=undefined){this.set("page_route",this.collection.page.get("page_route"))}else{this.set("page_route",c.page.get("page_route"))}this.preparePageSourceRoute();var b=this.attributes,a=this;_.each(b,function(f,e){if(f===null){a.unset(e)}})},toggleSelected:function(){this.set("is_selected",!this.get("is_selected"))},processDeletion:function(){this.set("is_deleted",true)},preparePageSourceRoute:function(){var a;a=this.get("source_title");a=PulseApp.Helpers.SlugRoute(a);a=encodeURIComponent(a);a+="-"+PulseApp.Helpers.CreateSourceHash(this);this.set("source_route",a)}});PulseApp.User.Collections.PageSources=Backbone.Collection.extend({model:PulseApp.User.Models.PageSource,getSources:function(){if(this.Sources==undefined){this.Sources=new PulseApp.Collections.Sources();this.Sources.PageSources=this;this.bind("destroy",this.Sources.destroy,this.Sources);this.bind("remove",this.Sources.CombinedSourcesStories.removeStories,this.Sources)}return this},fetchSources:function(){},initialize:function(b,a){this.bind("remove",this.sourceRemoved);this.bind("change:source_title",this.processSourceNameChange);this.bind("reset",this.fetchSources);_.each(_.keys(a),function(c){this[c]=a[c]},this);this.page_route=a.page_route},getSelectedSource:function(){var a;_.each(this.models,function(b){if(b.get("is_selected")==true){a=b;return}});return a},clearSelectedSources:function(){_.each(this.models,function(a){a.set("is_selected",false)},this)},fixSourcePositions:function(b){var a=b.get("source_position");_.each(this.models,function(c){var d=c.get("source_position");if(d>a){c.set("source_position",d-1)}})},getSyncJson:function(){var b,a=$.extend([],this.models),c;b={page_title:this.page.get("page_title"),page_position:this.page.get("page_position"),sources:[]};_.each(a,function(d){c=$.extend({},d.attributes);delete c.Source;delete c.catalog_item;delete c.primary_key;delete c.page_title;delete c.is_selected;delete c.publisher_img;delete c.publisher_primary_key;delete c.last_updated;delete c.page_route;delete c.source_route;c.updated=Math.floor((new Date().getTime())/1000);b.sources.push(c)});return b},sourceRemoved:function(e){var b={},f={},a,d,c=e.get("source_position");this.fixSourcePositions(e);e.set("is_deleted",true);a=e.toJSON();delete a.last_updated;delete a.updated;f=a;d=e.collection.page_position;delete f.Source;delete f.catalog_item;delete f.primary_key;delete f.page_title;delete f.is_selected;delete f.publisher_img;delete f.publisher_primary_key;delete f.page_route;delete f.source_route;b.data="deleted_sources_json="+escape(JSON.stringify(f));pages_json=this.getSyncJson();PulseApp.UserPages.syncSources(f,pages_json);this.page.trigger("change:page_sources");if(this.models.length==0){this.trigger("destroy")}},processSourceNameChange:function(d){var c={},b=[],a,e=[{page_position:this.page_position,page_title:this.page_title}];a=d.toJSON();delete a.last_updated;delete a.updated;b.push(a);delete b[0].Source;delete b[0].page_title;delete b[0].is_selected;delete b[0].publisher_img;delete b[0].publisher_primary_key;e[0].sources=b;c.data="pages_json="+escape(JSON.stringify(e));PulseApp.UserPages.syncSources(undefined,e)},reorderSources:function(b,e,d){var c,a=this;e=e-1;_.each(this.models,function(f){if(f.get("source_title")===b){c=f}});if(c){c.set("source_position",d);if(e>d){_.each(this.models,function(f){if(f.get("source_title")!==b){var g=f.get("source_position");if(g<=e&&g>=d){f.set("source_position",g+1)}}});PulseApp.UserPages.addtoQueues(null,a.getSyncJson())}else{_.each(this.models,function(f){if(f.get("source_title")!==b){var g=f.get("source_position");if(g>=e&&g<=d){f.set("source_position",g-1)}}});PulseApp.UserPages.addtoQueues(null,a.getSyncJson())}}}});PulseApp.User.Models.Page=Backbone.Model.extend({defaults:{is_selected:false},toggleSelected:function(){this.set("is_selected",!this.get("is_selected"))},isReservedRoute:function(){var a=_.indexOf(PulseApp.Environment.ReservedRoutes,this.get("page_title").toLowerCase());if(a==-1){return false}else{return true}},prepareRoute:function(){var a,b;if(this.isReservedRoute()){a=this.get("page_title")+"!"}else{a=this.get("page_title")}b=encodeURIComponent(PulseApp.Helpers.SlugRoute(a));collection=this.collection||PulseApp.UserPages;if(this.collection&&_.indexOf(this.collection.existing_routes,b)!=-1){b+=this.collection.existing_routes.length}if(this.collection){this.collection.existing_routes.push(b)}this.set("page_route",b)},initialize:function(){if(!this.get("sources")){this.set("sources",[])}var c=this.get("page_title"),a=_.escape(c);this.prepareRoute();var b=new PulseApp.User.Collections.PageSources(this.get("sources"),{page:this});b.page_title=this.get("page_title");b.page_position=this.get("page_position");this.bind("change:page_position",this.updatePosition,this);this.bind("change:page_title",this.updateTitle,this);this.set("page_sources",b);this.get("page_sources").bind("destroy",this.removePage,this)},removePage:function(b){try{this.collection.rearrangePages(this)}catch(a){pulse.console.log("Failed to remove page collection.")}this.destroy()},updatePosition:function(){var a=this.get("page_sources");a.page_position=this.get("page_position");this.set("page_sources",a)},updateTitle:function(){var a=this.get("page_sources");a.page_title=this.get("page_title");this.set("page_sources",a);PulseApp.UserPages.addtoQueues(null,this.get("page_sources").getSyncJson())}});PulseApp.User.Collections.UserPages=Backbone.Collection.extend({model:PulseApp.User.Models.Page,url:PulseApp.Environment.Endpoints.SourceSync,addedSources:[],pages_sync_queue:[],deleted_sync_queue:[],pages_waiting_queue:[],deleted_waiting_queue:[],existing_routes:[],currently_syncing:false,initialize:function(){_.bindAll(this,"sync","checkForSync","forceSync");this.bind("reset",this.fetchStories)},getSyncTimeout:function(){return this.sync_timeout},setSyncTimeout:function(){var a=this;this.removeSyncTimeout();this.sync_timeout=window.setTimeout(function(){a.checkForSync("update",a,{})},PulseApp.Environment.Constants.SOURCE_SYNC_DELAY)},removeSyncTimeout:function(){window.clearTimeout(this.sync_timeout);delete this.sync_timeout},addtoQueues:function(c,d){var b=false,a=this;if(c){this.deleted_waiting_queue.push(c)}if(d){_.each(this.pages_waiting_queue,function(f,e){if(f.page_position===d.page_position){a.pages_waiting_queue[e]=d;b=true}});if(!b){this.pages_waiting_queue.push(d)}}},syncSources:function(a,b){this.addtoQueues(a,b);if(!this.sync_timeout){this.setSyncTimeout()}},checkForSync:function(a){if((this.pages_sync_queue.length!==0||this.deleted_sync_queue.length!==0||this.pages_waiting_queue.length!==0||this.deleted_waiting_queue.length!==0)&&!this.currently_syncing){Backbone.emulateJSON=true;this.sync(a,this,{});Backbone.emulateJSON=false}if(this.pages_waiting_queue.length===0&&this.deleted_waiting_queue.length===0){this.removeSyncTimeout()}},forceSync:function(a){if((this.pages_sync_queue.length!==0||this.deleted_sync_queue.length!==0||this.pages_waiting_queue.length!==0||this.deleted_waiting_queue.length!==0)&&!this.currently_syncing){Backbone.emulateJSON=true;this.sync("update",this,{async:a});Backbone.emulateJSON=false}else{if(!this.sync_timeout){this.setSyncTimeout()}}},syncAll:function(c,a){this.pages_waiting_queue=c;var b={};if(a==undefined){a=true}b.data="has_all_sources=True";b.async=a;Backbone.emulateJSON=true;this.sync("update",this,b);Backbone.emulateJSON=false},sync:function(d,c,b){if(!b.data){b.data=""}if(this.pages_sync_queue.length===0&&this.deleted_sync_queue.length===0){if(this.pages_waiting_queue.length!==0){if(b.data.length>0){b.data+="&"}b.data+="pages_json="+encodeURIComponent(JSON.stringify(this.pages_waiting_queue));this.pages_sync_queue=this.pages_waiting_queue;this.pages_waiting_queue=[]}if(this.deleted_waiting_queue.length!==0){if(b.data.length>0){b.data+="&"}b.data+="deleted_sources_json="+encodeURIComponent(JSON.stringify(this.deleted_waiting_queue));this.deleted_sync_queue=this.deleted_waiting_queue;this.deleted_waiting_queue=[]}}else{if(this.pages_sync_queue.length!==0){this.pages_sync_queue=this.pages_sync_queue.concat(this.pages_waiting_queue);b.data="pages_json="+encodeURIComponent(JSON.stringify(this.pages_sync_queue))}if(this.deleted_sync_queue.length!==0){if(b.data.length>0){b.data+="&"}this.deleted_sync_queue=this.deleted_sync_queue.concat(this.deleted_waiting_queue);b.data="deleted_sources_json="+encodeURIComponent(JSON.stringify(this.deleted_sync_queue))}}if(this.url.indexOf("pulseapi-test")!=-1){b.dataType="jsonp"}var a=this;this.currently_syncing=true;b.statusCode={200:function(e){a.currently_syncing=false;a.pages_sync_queue=[];a.deleted_sync_queue=[];if(e.data){}},400:function(e){a.currently_syncing=false},401:function(e){a.currently_syncing=false;pulse.console.log("User unauthorized")},500:function(e){a.currently_syncing=false;pulse.console.log("Server unavailable")}};return Backbone.sync(d,c,b)},parse:function(a){return a.data.pages},reset:function(a){_.each(a,function(b){this.addedSources=_.union(this.addedSources,_.pluck(b.sources,"source_url"))},this);Backbone.Collection.prototype.reset.call(this,a)},clearSelectedPages:function(){_.each(this.models,function(a){a.set("is_selected",false)},this)},addSourceToPage:function(c,e){var b={source_url:e.get("feed_url")||e.get("source_url"),source_title:e.get("title")||e.get("source_title"),is_deleted:false,updated:Math.floor((new Date().getTime())/1000),catalog_primary_key:e.get("string_primary_key")},m={},d,f,l=e.get("image_url");publisher_primary_key=e.get("primary_key");if(e.get("product_id")){b.product_id=e.get("product_id")}if(e.get("supported_parameter_types")){b.supported_parameter_types=e.get("supported_parameter_types")}b.source_position=this.models[c].get("page_sources").length;if(b.source_position<12){var h=new PulseApp.User.Models.PageSource(b,{page:this.models[c]}),j=this.models[c],g=jQuery.extend({},j),a;g=g.toJSON();this.models[c].get("page_sources").add(h);a=h.getOrCreateSource();a.set("publisher_img",l);a.set("publisher_primary_key",publisher_primary_key);a.set("catalog_item",e);h.bind("change:is_deleted",e.sourceDeleted);e.source=h;if(this.models[c].get("page_sources").Sources!==undefined){this.models[c].get("page_sources").Sources.add(a);if(this.models[c].get("page_sources").Sources.CombinedSourcesStories.models.length===0){this.models[c].get("page_sources").Sources.fetch()}}else{this.models[c].get("page_sources").getSources();this.models[c].get("page_sources").Sources.add(a)}this.addedSources.push(e.get("feed_url")||e.get("source_url"));a.Stories.fetch();var k=this.models[c].get("page_sources");g.sources=jQuery.extend({},k);f=this.models[c].get("page_sources").getSyncJson();this.syncSources(null,f)}},rearrangePages:function(b){var c,a=this;this.remove(b);_.each(this.models,function(e){var d=e.get("page_position");if(d>b.get("page_position")){e.set("page_position",(d-1));a.syncSources(null,e.get("page_sources").getSyncJson())}});this.forceSync(true)},reorderPages:function(b,e,d){var c=PulseApp.Helpers.getPage(b),a=this;c.set("page_position",d);this.addtoQueues(null,c.get("page_sources").getSyncJson());PulseApp.LoggingHelper.logMovedPage(d,e);if(e>d){_.each(this.models,function(f){if(f.get("page_title").toLowerCase()!==b){var g=f.get("page_position");if(g<=e&&g>=d){f.set("page_position",g+1);a.addtoQueues(null,f.get("page_sources").getSyncJson())}}})}else{_.each(this.models,function(f){if(f.get("page_title").toLowerCase()!==b){var g=f.get("page_position");if(g>=e&&g<=d){f.set("page_position",g-1);a.addtoQueues(null,f.get("page_sources").getSyncJson())}}})}this.models=_.sortBy(this.models,function(f){return f.get("page_position")})},getSourceModel:function(a){var b=[];_.each(this.models,function(c){if(b.length===0){b=c.get("page_sources").where({source_url:a})}});return b[0]},fetchStories:function(){var b=window.location.pathname,a=b.substring(5),d;d=_.find(this.models,function(e){return e.get("page_route").toLowerCase()===a.toLowerCase()});if(d===undefined){var d=this.models[0];_.each(this.models,function(e){e.get("page_sources").getSources();e.get("page_sources").Sources.fetch()})}else{d.get("page_sources").getSources();d.get("page_sources").Sources.fetch();var c=d.get("page_position");_.each(this.models,function(e){if(e.get("page_position")!==c){e.get("page_sources").getSources();e.get("page_sources").Sources.fetch()}})}},loadOthers:function(a){var b=this.models[a];b.get("page_sources").Sources.CombinedSourcesStories.unbind("reset",function(){this.loadOthers(b.get("page_position"))});_.each(this.models,function(c){if(c.get("page_position")!==a){c.get("page_sources").getSources();c.get("page_sources").Sources.fetch()}})}});PulseApp.Models.Profile=Backbone.Model.extend({url:PulseApp.Environment.Endpoints.Profile,sync:function(d,c,b){if(this.url.indexOf("pulseapi-test")!=-1){b.dataType="jsonp"}var a=this,d=d;b.statusCode={200:function(e){a.unset("fb_token");a.unset("unlink_account");pulse.console.log("Changes saved");if(d=="create"||d=="update"){a.trigger("notify",{message:"Saved!"})}},400:function(e){var f=JSON.parse(e.responseText).error;if(f.type=="ExistingUserException"){a.trigger("notify",{message:"An account for this user already exists"})}if(f.type=="PasswordRequiredException"){PulseApp.ActiveViews.Main.subViews.overlay.needPassword(e)}if(f.type=="ParameterValidationException"){if(f.message){if(f.message.email){a.trigger("notify",{message:"An account with this email already exists."})}}}},500:function(e){this.currently_syncing=false;pulse.console.log("Server unavailable")}};return Backbone.sync(d,c,b)},parse:function(a){delete a.data.profile_background_photo_url;delete a.data.fb_token;delete a.data.tw_key;delete a.data.tw_secret;return a.data},setFbId:function(a){if(a.authResponse){this.set("fb_token",a.authResponse.accessToken);if(this.get("first_name").length===0){this.unset("first_name")}if(this.get("last_name").length===0){this.unset("last_name")}}Backbone.emulateJSON=true;this.save();Backbone.emulateJSON=false}});PulseApp.Models.Service=Backbone.Model.extend({});PulseApp.User.Collections.SettingsSync=Backbone.Collection.extend({model:PulseApp.Models.Service,url:function(){return PulseApp.Environment.Endpoints.SettingSync},sync:function(c,b,a){if(this.url().indexOf("pulseapi-test")!=-1){a.dataType="jsonp"}return Backbone.sync(c,b,a)},parse:function(a){return a.data.settings_json},syncWithBackend:function(b){var a={};a.data="settings_json="+escape(JSON.stringify(b));a.async=false;this.sync("create",PulseApp.SettingsSync,a)},isFirstTimeUser:function(){var a=false;if(this.models.length===0){a=true}else{_.each(this.models,function(b){if(b.get("web_onboarding")===undefined||b.get("web_onboarding").firsttime==="True"){a=true}})}return a}});PulseApp.Models.CatalogItem=Backbone.Model.extend({defaults:{is_added:false,is_selected:false},url:function(){return PulseApp.Environment.Endpoints.getAbsoluteUrl(PulseApp.Environment.Endpoints.CatalogItems)+"?collection="+this.get("title")+"&supported_parameter_types="+this.get("supported_parameter_types")},initialize:function(a){_.bindAll(this,"sourceDeleted");this.hidden_collections=["Google Reader","Facebook","Twitter","Readability","Social","Recommended","Local"];var d,b=this,c;a.is_loaded=false;a.image_url=PulseApp.Environment.Endpoints.getAbsoluteUrl(PulseApp.Environment.Endpoints.CatalogImage)+a.primary_key;if(a.is_collection){this.items=new PulseApp.Collections.Items(a.items)}if(a.feed_url!==undefined){this.addToCatalogFeedArray(a);if(a.feed_url.indexOf("hr-pulsesubscriber")==-1){a.feed_url=a.feed_url.replace("pulsesubscriber","hr-pulsesubscriber")}is_found_in_catalog=false;for(added_source in PulseApp.UserPages.addedSources){if(PulseApp.UserPages.addedSources[added_source].indexOf(a.feed_url)!=-1){is_found_in_catalog=true;found_source_url=PulseApp.UserPages.addedSources[added_source];break}else{if(a.feed_url.indexOf(PulseApp.UserPages.addedSources[added_source])!=-1){is_found_in_catalog=true;found_source_url=PulseApp.UserPages.addedSources[added_source];break}}}if(is_found_in_catalog){a.is_added=true;c=PulseApp.UserPages.getSourceModel(found_source_url);if(c!==undefined){c.set("publisher_img",a.image_url);c.set("primary_key",a.primary_key);c.set("catalog_item",this);c.bind("change:is_deleted",this.sourceDeleted);this.source=c}}else{a.is_added=false}}delete a.items;this.attributes=a},sync:function(c,b,a){if(this.get("domain").toLowerCase()==="local"){document.cookie="catalog="+escape(this.createCookie())+"; path=/"}a.type="GET";a.dataType="jsonp";a.async=false;return Backbone.sync(c,b,a)},parse:function(a){if(a.data){this.items=new PulseApp.Collections.Items(a.data.catalog_items);this.set("is_loaded",true)}return a},sourceDeleted:function(){if(this.source.get("is_deleted")==true){this.set("is_added",false);PulseApp.Helpers.markDuplicatesInCatalog(this);PulseApp.UserPages.addedSources=_.without(PulseApp.UserPages.addedSources,this.source.get("source_url"),this)}},createCookie:function(){var a={user:{device_type:"Web",lat:Number(this["lat"]),"long":Number(this["long"])},cookie_version:1};return JSON.stringify(a)},toggleSelected:function(){this.set("is_selected",!this.get("is_selected"))},addToCatalogFeedArray:function(a){PulseApp.CatalogFeedArray=PulseApp.CatalogFeedArray||[];PulseApp.CatalogFeedArray.push(this.trimCatalogFeedUrl(a))},trimCatalogFeedUrl:function(d){var c="http://hr-pulsesubscriber.appspot.com/items?feed=",b="http://pulsesubscriber.appspot.com/items?feed=",a=null;if(d.feed_url){a=d.feed_url;if(a.indexOf(c)!=-1){a=a.replace(c,"")}else{if(a.indexOf(b)!=-1){a=a.replace(b,"")}}}return a}});PulseApp.Collections.Items=Backbone.Collection.extend({model:PulseApp.Models.CatalogItem});PulseApp.Collections.CatalogItems=Backbone.Collection.extend({model:PulseApp.Models.CatalogItem,url:PulseApp.Environment.Endpoints.getAbsoluteUrl(PulseApp.Environment.Endpoints.CatalogItems),sourceImages:[],duplicates:[],initialize:function(){this.sourceImages=[];this.flat_item_list=[];this.bind("reset",this.createFlatList,this);this.fetch()},sync:function(c,b,a){a.type="GET";a.dataType="jsonp";document.cookie="catalog="+escape(this.createCookie())+"; path=/";return Backbone.sync(c,b,a)},parse:function(a){if(Modernizr.localstorage){try{window.localStorage.setItem("supported_catalog_locales",a.data.supported_catalog_locales)}catch(b){_gaq.push(["_trackEvent","error_settings_catalog_locale",b.toString()])}}return a.data.catalog_items},createCookie:function(){var a={user:{device_type:"Web",lat:Number(this["lat"]),"long":Number(this["long"])},cookie_version:1};return JSON.stringify(a)},clearSelected:function(){_.each(this.models,function(a){a.set("is_selected",false)},this)},createFlatList:function(){var a=this;_.each(this.models,function(b){if(b.items){_.each(b.items.models,function(c){if(c.items){_.each(c.items.models,function(d){a.flat_item_list.push(d.toJSON())})}else{a.flat_item_list.push(c.toJSON())}})}else{a.flat_item_list.push(b.toJSON())}})}});PulseApp.Models.CatalogSearchResult=Backbone.Model.extend({defaults:{is_added:true},initialize:function(a){var b;if(a.external_icon_url){if(a.external_icon_url.indexOf(".ico")==-1){separator=(a.external_icon_url.indexOf("?")==-1)?"?":"&";if(a.external_icon_url.indexOf("width=")==-1&&a.external_icon_url.indexOf("height=")==-1){a.external_icon_url=a.external_icon_url+separator+"height=65&width=65"}}}if(a.image_url){a.image_url=a.image_url+"&image_type=icon&width=65&height=65"}if((a.feed_url.indexOf("hr-pulsesubscriber")===-1)&&(a.feed_url.indexOf("test-hr-pulsesubscriber")===-1)){a.feed_url=a.feed_url.replace("pulsesubscriber","hr-pulsesubscriber")}if($.inArray(a.feed_url,PulseApp.UserPages.addedSources)!==-1){a.is_added=true}else{a.is_added=false}this.attributes=a}});PulseApp.Collections.SearchResults=Backbone.Collection.extend({model:PulseApp.Models.CatalogSearchResult});PulseApp.Collections.SearchServiceResults=Backbone.Collection.extend({model:PulseApp.Models.CatalogSearchResult});PulseApp.Collections.CatalogSearch=Backbone.Collection.extend({url:function(){var a=PulseApp.Environment.Endpoints.CatalogItems.indexOf("?")==-1?"?prefix_search_query=":"&prefix_search_query=";return PulseApp.Environment.Endpoints.getAbsoluteUrl(PulseApp.Environment.Endpoints.CatalogItems)+a+this.keyword},initialize:function(){this.keyword=""},sync:function(c,b,a){a.type="GET";a.dataType="jsonp";PulseApp.LoggingHelper.searchQuery(this.keyword);return Backbone.sync(c,b,a)},updateKeyword:function(a){this.keyword=a;this.fetch()},parse:function(b){var c=[],a=[];PulseApp.Catalog.SupportedSearchTypes=b.data.supported_search_types;_.each(b.data.catalog_items,function(d){if(d.title=="Pulse Catalog"){c=_.union(c,d.items)}},this);_.each(c,function(d){if(d.is_collection!=true){a.push(d)}},this);this.search_results_collection=new PulseApp.Collections.SearchResults(a)}});PulseApp.Collections.CatalogServiceSearch=Backbone.Collection.extend({url:function(){return PulseApp.Environment.Endpoints.getAbsoluteUrl(PulseApp.Environment.Endpoints.CatalogSearch)+"?query="+this.keyword+"&search_type="+this.service_type},initialize:function(a){this.keyword=a.keyword;this.service_type=a.service_type;this.fetch()},sync:function(c,b,a){a.type="GET";a.dataType="jsonp";return Backbone.sync(c,b,a)},parse:function(b){var d=[],c=[],a=[];_.each(b.data.catalog_items,function(e){_.each(e.items,function(f){if(!f.is_collection){if(f.feed_url){if($.inArray(f.feed_url,PulseApp.CatalogFeedArray)===-1){if($.inArray(f.feed_url,PulseApp.ServiceSearchFeedArray)===-1){d.push(f);PulseApp.ServiceSearchFeedArray.push(f.feed_url)}}else{_gaq.push(["_trackEvent","Catalog_View","Duplicate Search Result Feed",f.feed_url])}}}},this);this.title=e.title},this);this.search_results_collection=new PulseApp.Collections.SearchResults(d)}});PulseApp.Models.SavedStory=Backbone.Model.extend({defaults:{is_saved:true,is_read:false},initialize:function(c,b){c.textOnly=(c.image_url===undefined||c.image_url.length===0);this.attributes=c;this.collection=b.collection;var a=_.find(PulseApp.Catalog.flat_item_list,function(d){if(d.domain_url){if(this.get("feed_url")&&this.get("feed_url").indexOf(d.feed_url)!=-1){return true}if(d.domain&&this.get("domain")){if(d.domain.indexOf(this.get("domain"))!=-1){return true}else{if(d.domain.indexOf(this.get("domain"))!=-1){return true}}}if(d.title==this.get("domain")){return true}if(d.domain_url&&this.get("domain_url")){if(this.get("domain_url").indexOf(d.domain_url)!=-1){return true}else{if(d.domain_url.indexOf(this.get("domain_url"))!=-1){return true}else{if(this.get("url").indexOf(d.domain_url)!=-1){return true}}}}return false}return false},this);if(a){this.set("publisher_img",a.image_url);if(!this.get("source_title")){this.set("source_title",a.title)}}},getUrl:function(){return this.get("url")||this.get("link")},markRead:function(){this.set("is_read",true)}});PulseApp.Collections.SavedStories=Backbone.Collection.extend({model:PulseApp.Models.SavedStory,url:function(){if(this.offset>0){return PulseApp.Environment.Endpoints.SavedStories+"?offset="+this.offset+"&type=bookmark"}else{return PulseApp.Environment.Endpoints.SavedStories+"?type=bookmark"}},initialize:function(){this.collection_type="saved";this.fetch()},sync:function(d,c,b){var a=this;this.trigger("fetching");if(this.url().indexOf("pulseapi-test")!=-1){b.dataType="jsonp"}b.statusCode={200:function(e){a.trigger("successful_sync");a.parse(e)},401:function(e){pulse.console.log("User unauthorized")},500:function(e){pulse.console.log("Server unavailable")}};if(d==="read"){b.data="no_default_image=true"}return Backbone.sync(d,c,b)},parse:function(a){this.offset=Number(a.data.next_offset);return a.data.stories},loadMoreSavedStories:function(){pulse.console.log("Saved Stories Offset ::: "+this.offset);if(!isNaN(this.offset)){this.fetch({add:true})}},isDuplicate:function(b){var a=this.pluck("url");if(_.indexOf(a,b)===-1){return false}else{return true}},addRemove:function(b){var a,c;pulse.console.log(b.model);if(b.model){c=b.model;new_model={type:"bookmark",author:c.get("author"),title:c.get("title"),text:c.get("content"),domain:c.collection.source_title,domain_url:c.collection.link?c.collection.link:0,feed_url:c.collection.feed_url,is_deleted:false};if(b.action=="remove"){new_model.url=c.get("url");new_model.image_url=c.get("image_url");new_model.is_deleted=true;this.remove(b.model);b.model.destroy()}else{if(b.action=="save"){new_model.image_url=c.get("image_urls")[0];new_model.url=c.get("link");pulse.console.log(b.model);PulseApp.LoggingHelper.starredStory(b.model);if(!this.isDuplicate(new_model.url)){this.add(new_model,{at:0});saved_story=this.models[0];c.set("saved_story",saved_story);saved_story.set("story",c);saved_story.bind("destroy",c.removeSaved,c)}}}b.data="stories_json="+escape(JSON.stringify([new_model]));this.sync("update",this,b)}}});PulseApp.Views.SavedStories=Backbone.View.extend({parent:$("#reader_container"),id:"saved_story_container",className:"main rel clear",template:function(){return _.template(PulseApp.Templates.NoSavedStories,{})},initialize:function(){var a;if(this.collection!==undefined){this.collection.bind("reset",this.render,this);this.collection.bind("remove",this.render,this)}this.stream=[]},render:function(){$("li.nav-section.highlight").removeClass("highlight");$("#left-nav-saved").addClass("highlight");var a={is_page:false,header_title:"Saved",searchable:false};if((this.collection===undefined)||(this.collection.models.length===0)){if(this.$el.html().length<=0){this.$el.append(this.template());$("#main-throbber").hide()}}else{if($(".no-saved-stories").length>0){$(".no-saved-stories").remove()}if(this.stream.length===0){this.stream=new PulseApp.Views.Stream({collection:this.collection});var b=this.$el.parent().find("#no-saved-container");if(b){b.remove()}this.$el.append(this.stream.$el);this.stream.grid.holdToSave=false;this.stream.grid.onDomInsertion()}else{this.stream.collection=this.collection;this.stream.loadNewContent()}}return this},onScrollHandler:function(){if(($(window).scrollTop()+450)>=$(document).height()-$(window).height()){window_scroll_refresh=true;if($(".black_spinner").length===0){$("#main_container").append("<div class='black_spinner' style='visibility: hidden;'></div>");this.loadMoreSavedStories()}}},showPopup:function(){var a={header:"Saved Stories",content:"Read your saved stories here",left:$("#left-nav-saved").offset().left+$("#left-nav-saved").innerWidth(),top:this.$el.offset().top};new PulseApp.Views.OnboardingPopUp({options:a})},remove:function(){if(_.has(this.stream,"grid",this)){this.stream.grid.onRemove();this.stream.remove()}this.collection.unbind("reset",this.render,this);this.collection.unbind("remove",this.render,this);this.collection.unbind("add");$("#left-nav-saved").removeClass("highlight");Backbone.View.prototype.remove.call(this)}});PulseApp.Views.SavedStoryListItem=Backbone.View.extend({tagName:"li",className:"saved_story_item border-box clear rel",events:{click:"loadStory","click .trash_btn":"removeSaved"},template:function(a){return _.template($("#saved_story_item").html(),a)},initialize:function(){var b=this.model.get("publishedDate")||this.model.get("updated"),a=this.model.get("title");this.model.set("title",unescape(a));this.model.bind("destroy",this.remove,this);if(b&&b!==""){this.model.set("prettyDate",PulseApp.Helpers.beautifyDate(b))}this.render()},render:function(){this.$el.append(this.template({story:this.model}));return this},loadStory:function(){_gaq.push(["_trackEvent","Saved_Story_View","story_click"]);if(PulseApp.Views.currentStory!==undefined){PulseApp.Views.currentStory.remove()}PulseApp.Views.currentStory=new PulseApp.Views.RightPane({model:this.model})},removeSaved:function(a){_gaq.push(["_trackEvent","Saved_Story_View","delete_click"]);a.stopPropagation();this.model.destroy()}});PulseApp.Views.Reading=Backbone.View.extend({parent:$("body"),className:"reading_parent",events:{"click #logo-container":"remove","click #prev_article_button":"goToPrevStory","click #next_article_button":"goToNextStory","click #back_button":"goBack","click .share":"initShareSave","click #text-options":"openTextPane","click #reading-modal-clickoff":"goBack","pulse.articlepinchmove":"articlePinchMove","pulse.articlepinchend":"articlePinchEnd","pulse.articleswipemove":"articleSwipeMove","pulse.articleswipeend":"articleSwipeEnd","click .topbar_title":"goToSource"},template:function(a){a.position=this.position;return _.template(PulseApp.Templates.ReadingView,{data:a})},initialize:function(b,a){this.animationTimeout=null;this.is_splash_story=a.is_splash_story||false;_.bindAll(this,"keyPressed","bindSavedStates","updateRecommendedUI");$(document).on("keydown",this.keyPressed);PulseApp.ActiveViews.Main.removeOverlay();PulseApp.ActiveViews.Main.subViews.overlay=this;var c=this;$(window).on("resize",function(d){c.windowResize(d)});this.start_time=0;this.model=b.model;if(a!==undefined){this.streamCollection=a.collection}if(!this.model.get("is_saved")){this.model.set("is_saved",this.isSaved());if(this.model.get("is_saved")&&!this.model.get("saved_story")){this.bindSavedStates()}}this.model.markRead();this.model.bind("change:is_recommended",this.updateRecommendedUI,this);this.position=a.position;if(this.model.get("type")==undefined){this.model.set("type","reader")}if(this.model.get("url")){this.is_saved_story=true;this.model.set("source_title",this.model.get("domain"))}else{if(this.is_splash_story){this.model.set("source_title",this.model.get("feed_title"))}else{if(this.model.get("source_title")===undefined){this.model.set("source_title",this.model.collection.source_title)}}}this.render();this.windowResize();this.removed=false;if(this.streamCollection){this.route=$.isFunction(this.streamCollection.getCombinedPageStories)?"aggregatedStream":"individualStream"}this.read_count=0;$("#reading_view_share a").tipsy({gravity:"w"})},render:function(){this.parent.addClass("no_scroll");if(PulseApp.Environment.ReadingPref.mode=="dark"){this.$el.addClass("__pulse_dark")}this.$el.append(this.template(this.model.toJSON()));this.reading_element=this.$el.find(".reading-view-frame-container");$(this.parent).append(this.$el);this.current=new PulseApp.Views.ReadingContent({model:this.model},{collection:this.streamCollection,position:"center"});var a=this;yepnope({test:Modernizr.touch&&!PulseApp.isMobile&&a.streamCollection,yep:_loader([_p.reading_list]),complete:function(){if(!PulseApp.isMobile&&a.streamCollection){a.reading_list=new PulseApp.Views.ReadingListIE10({collection:a.streamCollection});a.reading_list.readingViewParent=a;a.reading_list.selectStory(_.indexOf(a.reading_list.collection.models,a.model),false,true)}}});if(this.is_splash_story){$("#next_article_button, #prev_article_button").remove()}this.start_time=new Date().getTime();this.current.iframe.contentWindow.focus()},openTextPane:function(){if(this.text_settings&&this.text_settings.is_visible){this.text_settings.close()}else{this.text_settings=new PulseApp.Views.TextSettingsPopUp()}},articlePinchMove:function(a){if(a.scale>=0.85){this.$el.css("scale",1).removeClass("pinch")}else{var b=1-((1-a.scale)*0.4);this.$el.css("scale",b).addClass("pinch")}},articlePinchEnd:function(a){if(a.cancelled||a.scale>0.4){this.$el.animate({scale:1},200).removeClass("pinch")}else{this.goBack(a)}},articleSwipeMove:function(a){},articleSwipeEnd:function(a){if(a.cancelled){}else{if(a.offsetX>0){this.goToPrevStory()}else{this.goToNextStory()}}},goBack:function(b){_gaq.push(["_trackEvent","Reading_View","back_click"]);try{PulseApp.LoggingHelper.sendLog({name:"Read Story",readingMode:"",secondsSpent:""+Math.floor((new Date().getTime()-this.start_time)/1000),routeToStory:this.read_count===0?this.route:"swipe",storyTitle:this.current.model.get("title"),storyUrl:this.current.model.get("link")||this.current.model.get("url"),feedTitle:this.current.model.get("source_title"),feedUrl:(this.current.model.collection?this.current.model.collection.feed_url:""),websiteUrl:(this.current.model.collection?this.current.model.collection.link:""),websiteTitle:(this.current.model.collection?this.current.model.collection.source_title:"")})}catch(a){pulse.console.log("Error in sending Read Story log")}this.read_count++;this.remove()},initShareSave:function(c){var a=c.currentTarget.id;if(a==="save"){if(PulseApp.Username){if(this.isSaved()){if(!this.is_saved_story){saved_model=_.find(PulseApp.SavedStories.models,function(d){return d.get("url")==this.model.get("link")},this)}else{saved_model=this.model}PulseApp.SavedStories.addRemove({model:saved_model,action:"remove"});PulseApp.LoggingHelper.removedStarredStory(saved_model);this.model.set("is_saved",false);$(c.currentTarget).removeClass("selected");if(this.streamCollection.localKey==="saved"){this.remove()}return}else{PulseApp.SavedStories.addRemove({model:this.model,action:"save"});this.model.set("is_saved",true);$(c.currentTarget).addClass("selected")}_gaq.push(["_trackEvent","Reading_View","save_click","reading_view"])}else{PulseApp.Helpers.createSignUpModal("Save "+this.model.get("title"),"Sign up to save stories for reading later.","save_story")}}else{if(a==="facebook"){a+="_v2";PulseApp.LoggingHelper.sharedStory(this.current.model,"facebook");_gaq.push(["_trackEvent","Reading_View","facebook_share_click","reading_view"])}else{if(a==="linkedin"){PulseApp.LoggingHelper.sharedStory(this.current.model,"linkedin");_gaq.push(["_trackEvent","Reading_View","linkedin_share_click","reading_view"])}else{if(a==="twitter"){PulseApp.LoggingHelper.sharedStory(this.current.model,"twitter");_gaq.push(["_trackEvent","Reading_View","twitter_share_click","reading_view"])}else{if(a==="email"){PulseApp.LoggingHelper.sharedStory(this.current.model,"email");_gaq.push(["_trackEvent","Reading_View","email_share_click","reading_view"])}else{if(a==="recommend"){var b=this;_gaq.push(["_trackEvent","Reading_View","recommend_share_click","reading_view"]);if(!this.model.get("is_recommended")){if(!PulseApp.Environment.isLoggedInUser()){PulseApp.Helpers.createSignUpModal("Recommend on Facebook","Sign up to recommend stories on Facebook.","recommend_story");return}else{if(!PulseApp.Environment.IsFacebookConnected){PulseApp.Helpers.loginWithFacebook(function(d){if(d.authResponse){$(c.currentTarget).addClass("selected");b.createShareUrl({model:b.model,service:a})}},"recommend_fb_linked");return}}}$(c.currentTarget).addClass("selected");this.createShareUrl({model:this.model,service:a});this.model.toggleRecommendedState();return}}}}}this.createShareUrl({model:this.model,service:a})}return},goToSource:function(){pulse.console.log(this);if($.isFunction(this.streamCollection.getCombinedPageStories)){var b=this.current.model.get("Source").get("PageSource").get("source_route"),a=this.current.model.get("Source").get("PageSource").get("page_route");this.remove();PulseApp.RouterObject.navigate(a+"/"+b,{trigger:true})}},createShareUrl:function(c){var b=c.model,a=c.service;if(b.get("shortened_link"||"shortened_url")===undefined){PulseApp.Helpers.shortenUrl({model:b,service:a})}else{PulseApp.Helpers.createShareUrl({model:b,service:a})}},isSaved:function(){var b=false,a;if(this.model.get("is_saved")){b=true}else{if(PulseApp.SavedStories){a=_.find(PulseApp.SavedStories.models,function(c){return c.get("url")==this.model.get("link")},this);if(a){b=true}}}return b},bindSavedStates:function(){var a=this;saved_model=_.find(PulseApp.SavedStories.models,function(b){return b.get("url")==this.model.get("link")},this);saved_model.set("story",a);this.model.set("saved_story",saved_model);saved_model.bind("destroy",this.removeSaved,this.model)},keyPressed:function(a){switch(a.which){case 37:_gaq.push(["_trackEvent","Reading_View","keypress_left"]);this.goToPrevStory();break;case 39:_gaq.push(["_trackEvent","Reading_View","keypress_right"]);this.goToNextStory();break;case 27:_gaq.push(["_trackEvent","Reading_View","keypress_esc"]);this.goBack();return false;break;default:break}},windowResize:function(d){if(PulseApp.Environment.isIE10){$("#reading-ui").css({left:$("#reading-modal").offset().left});$("#readinglist-ie10").css({left:$("#reading-modal").offset().left});return}var c=$("#reading-frames-content");if($(window).width()>=1180){var b=$("#reading-modal").offset().left-110;$("#reading-ui").css({left:b});var a=b;c.css({"margin-left":a});$("#readinglist").css({left:a+1024});if(this.reading_list){this.reading_list.showReadingList()}$("#reading-header-content").css("max-width","1244px")}else{$("#reading-ui").css({left:$("#reading-modal").offset().left});$("#readinglist").css({left:$("#reading-modal").offset().left});c.css({margin:"0 auto"});if(this.reading_list){this.reading_list.hideReadingList()}$("#reading-header-content").css("max-width","1024px")}},remove:function(){var a=(+new Date)-this.start_time;if(!this.removed&&a>500){this.removed=true;$(document).off("keydown",this.keyPressed);$(window).off("resize",this.windowResize);this.parent.removeClass("no_scroll");if(this.reading_list){this.reading_list.remove()}$(".tipsy").remove();var b=this;this.$el.fadeOut(150,function(){Backbone.View.prototype.remove.call(b);$(".tipsy").remove()})}},updateSavedState:function(){var a=this.$el.find("a#save");if(this.isSaved()){if(!a.hasClass("selected")){a.addClass("selected")}}else{a.removeClass("selected")}},updateRecommendedUI:function(){var a=this.$el.find("#recommend"),b=this.model.get("is_recommended");if(b){a.addClass("selected");$(a).attr("title","Recommended on Facebook").tipsy({gravity:"w"})}else{a.removeClass("selected");$(a).attr("title","Recommend on Facebook").tipsy({gravity:"w"})}},updateReadState:function(){this.model.markRead()},updateSource:function(){var c=this.model.get("source_title")||this.model.get("domain"),b=this.current.model.get("publisher_img")||false,a;if(b){a=$(this.$el.find(".topbar_icon")[0]);a.removeAttr("style");a.attr("style","background:url("+b+"&width=22&height=22);")}$(this.$el.find("#source-title")).text(c);if(!PulseApp.isMobile){this.reading_list.notifyStoryChanged(this.getCurrentIndex())}},getCurrentIndex:function(){return this.streamCollection.indexOf(this.model)},getPreviousStory:function(){var a=this.streamCollection.indexOf(this.model),c=a-1,b=this.streamCollection.at(c);return b},getNextStory:function(){var a=this.streamCollection.indexOf(this.model),c=a+1,b=this.streamCollection.at(c);return b},getStoryAtIndex:function(a){var b=Math.min(this.streamCollection.length-1,Math.max(0,a));return this.streamCollection.at(b)},goToPrevStory:function(){_gaq.push(["_trackEvent","Reading_View","previous_click"]);if(this.previous){if(this.next){this.next.remove()}this.stopVideos();try{PulseApp.LoggingHelper.sendLog({name:"Read Story",readingMode:"",secondsSpent:""+Math.floor((new Date().getTime()-this.start_time)/1000),routeToStory:this.read_count===0?this.route:"swipe",storyTitle:this.current.model.get("title"),storyUrl:this.current.model.get("link")||this.current.model.get("url"),feedTitle:this.current.model.get("source_title"),feedUrl:(this.current.model.collection?this.current.model.collection.feed_url:""),websiteUrl:(this.current.model.collection?this.current.model.collection.link:""),websiteTitle:(this.current.model.collection?this.current.model.collection.source_title:"")})}catch(a){pulse.console.log("Error in sending Read Story log")}this.read_count++;this.next=this.current;this.current=this.previous;this.current.startTime=new Date().getTime();this.model=this.previous.model;this.updateSource();this.updateSavedState();this.updateReadState();this.updateRecommendedUI();this.animationTimeout=this.current.animateRight(this.next,this.animationTimeout);this.setUpPrevious();this.current.iframe.contentWindow.focus()}},goToNextStory:function(){_gaq.push(["_trackEvent","Reading_View","next_click"]);if(this.next){if(this.previous){this.previous.remove()}this.stopVideos();try{PulseApp.LoggingHelper.sendLog({name:"Read Story",readingMode:"",secondsSpent:""+Math.floor((new Date().getTime()-this.start_time)/1000),routeToStory:this.read_count===0?this.route:"swipe",storyTitle:this.current.model.get("title"),storyUrl:this.current.model.get("link")||this.current.model.get("url"),feedTitle:this.current.model.get("source_title"),feedUrl:(this.current.model.collection?this.current.model.collection.feed_url:""),websiteUrl:(this.current.model.collection?this.current.model.collection.link:""),websiteTitle:(this.current.model.collection?this.current.model.collection.source_title:"")})}catch(a){pulse.console.log("Error in sending Read Story log")}this.read_count++;this.previous=this.current;this.current=this.next;this.current.startTime=new Date().getTime();this.model=this.next.model;this.updateSource();this.updateSavedState();this.updateReadState();this.updateRecommendedUI();this.animationTimeout=this.current.animateLeft(this.previous,this.animationTimeout);this.setUpNext();this.current.iframe.contentWindow.focus()}},goToStoryAtIndex:function(a){var b=this.getStoryAtIndex(a);if(b!==undefined){this.current=new PulseApp.Views.ReadingContent({model:b},{collection:this.streamCollection});this.model=this.current.model;this.updateReadState();this.setUpPrevious();this.setUpNext();this.updateSource()}},setUpPrevious:function(){var a=this.getPreviousStory();if(a!==undefined){this.previous=new PulseApp.Views.ReadingContent({model:a},{collection:this.streamCollection,position:"left"})}else{this.previous=undefined}this.updateButtonStates()},setUpNext:function(){var a=this.getNextStory();if(a!==undefined){this.next=new PulseApp.Views.ReadingContent({model:a},{collection:this.streamCollection,position:"right"})}else{this.next=undefined}this.updateButtonStates()},updateButtonStates:function(){if(this.previous!==undefined){$("#prev_article_button").removeClass("disabled")}else{$("#prev_article_button").addClass("disabled")}if(this.next!==undefined){$("#next_article_button").removeClass("disabled")}else{$("#next_article_button").addClass("disabled")}},setUpViews:function(){this.setUpPrevious();this.setUpNext()},stopVideos:function(){var c="EMBED,OBJECT,VIDEO,IFRAME".split(",");for(var b=0,a=c.length;b<a;b++){_.each($(this.current.iframe).contents().find(c[b]),function(d){if(d.tagName=="VIDEO"){d.pause()}else{var e=d.cloneNode(true);setTimeout(function(){d.parentNode.replaceChild(e,d)},500)}},this)}}});PulseApp.Views.ReadingContent=Backbone.View.extend({parent:"#reading-frames",className:"reading-view-frame-container abs",template:function(a){if(a!==-1){return _.template(PulseApp.Templates.OtherReadingContentTemplate,{})}else{return _.template(PulseApp.Templates.ReadingContentTemplate,{})}},initialize:function(b,a){_.bindAll(this,"populateIframe","linkClicked");this.position=a.position;this.render();return this},render:function(){var a=$(this.parent).width();var b;if(this.model.get("Source")){b=this.model.get("Source").get("feedUrl")}else{if(this.model.collection){b=this.model.collection.feed_url}else{b=(this.model.get("feed")||this.model.get("feed_url"))}}this.$el.append(this.template(this.is_whitelisted(b)));$(this.parent).append(this.$el);this.$el.removeClass("frame-left");this.$el.removeClass("frame-middle");this.$el.removeClass("frame-right");this.iframe=this.el.getElementsByTagName("iframe")[0];$(this.iframe).load(this.populateIframe);this.iframe.src=this.iframe.src;switch(this.position){case"center":this.$el.addClass("frame-middle");this.$el.fadeOut(0).delay(500).fadeIn(1000);break;case"left":this.$el.addClass("frame-left");this.$el.hide();break;case"right":this.$el.addClass("frame-right");this.$el.hide();break}},populateIframe:function(){var g=$("#reading_template_css").html(),l=$(g).filter("link"),o=$("#reading_template_js").html().replace("<!--","").replace("-->",""),e=$(o).filter("script"),j=this.iframe.contentWindow.document,p;$(this.iframe).contents().html("");if(!j.head){j.appendChild(j.createElement("head"))}if(!j.body){j.appendChild(j.createElement("body"))}if(__referring_user_id&&__referring_user_name&&!PulseApp.Username){var m=_.template(PulseApp.Templates.ReadingRecommendedHeaderTemplate,{user_id:__referring_user_id,user_name:__referring_user_name});$(j.body).prepend(m);$(j.body).find("#getstarted").click(function(){PulseApp.Helpers.createSignUpModal("Join Pulse","","reading_splash")})}__referring_user_id=null;__referring_user_name=null;$(j.head).append(l);var b=/<script.*?>([\s\S]*?)<\/script>/g,n=this.model.get("content"),r,q,v=[];while(q=b.exec(n)){v.push(q[0])}for(i=0,len=v.length;i<len;i++){r=n.replace(v[i],"")}this.model.set("content",r||n);e.each(function(x,w){v.push('<script src="'+$(w).attr("src")+'"><\/script>')});$iframe_body=$(j.body);this.setReadingPref($iframe_body);$iframe_body.append(new PulseApp.Views.ReadingTemplate({model:this.model}).$el.html());this.model.set("content",n);for(i=0,len=v.length;i<len;i++){var u=j.createElement("script"),d=$(v[i]).attr("src")||"",h=!!d.match(/player.ooyala.com/i),a=!!d.match(/playerseed.js/i),f;u.type="text/javascript";u.text=$(v[i]).text();if(d){u.src=d;if(h){var k="ooyala-player-container-"+i,c='<div id="'+k+'"></div>';$iframe_body.find("#__pulse_content").prepend(c);f=(d.indexOf("?")!==-1)?"&":"?";u.src=d+f+"playerContainerId="+encodeURIComponent(k)}else{if(a){j.getElementById("__pulse_content").appendChild(u)}else{j.body.appendChild(u)}}}else{j.body.appendChild(u)}}$iframe_body.find("a").bind("click",this.linkClicked);var t=$iframe_body.find("img");_.each(t,function(w){if(w.height==1||w.width==1){$(w).css({visibility:"hidden",margin:0,padding:0,height:0,width:0})}})},is_whitelisted:function(a){if(a){return a.indexOf("hr-pulsesubscriber")}else{return -1}},linkClicked:function(a){PulseApp.LoggingHelper.logLinkClicked(this.model,a);url=a.currentTarget.href;if(url.indexOf("utm_source=pulsenews")==-1){if(url.indexOf("?")==-1){url+="?utm_medium=referral&utm_source=pulsenews"}else{url+="&utm_medium=referral&utm_source=pulsenews"}}window.open(url,"_blank");a.preventDefault();a.stopPropagation()},setReadingPref:function(a){if(PulseApp.Environment.ReadingPref.mode=="dark"&&!a.hasClass("__pulse_dark")){a.addClass("__pulse_dark")}if(PulseApp.Environment.ReadingPref.font_size=="small"&&!a.hasClass("__pulse_smalltext")){a.addClass("__pulse_smalltext");a.removeClass("__pulse_largetext")}else{if(PulseApp.Environment.ReadingPref.font_size=="medium"){a.removeClass("__pulse_smalltext");a.removeClass("__pulse_largetext")}else{if(PulseApp.Environment.ReadingPref.font_size=="large"&&!a.hasClass("__pulse_largetext")){a.addClass("__pulse_largetext");a.removeClass("__pulse_smalltext")}}}if(PulseApp.Environment.ReadingPref.font_style=="serif"&&!a.hasClass("__pulse_serif")){a.addClass("__pulse_serif")}else{if(PulseApp.Environment.ReadingPref.font_style=="sans"){a.removeClass("__pulse_serif")}}},animateRight:function(d,e){var c=this.$el;var f=d.$el;var a=this;if(e!=null){clearTimeout(e)}this.$el.show(0,function(){c.find("iframe").contents().find("body").removeClass("scroll-enabled").addClass("scroll-disabled");f.find("iframe").contents().find("body").removeClass("scroll-enabled").addClass("scroll-disabled");c.removeClass("frame-left");c.addClass("frame-middle");f.removeClass("frame-middle");f.addClass("frame-right")});var b=setTimeout(function(){$(".frame-middle").find("iframe").contents().find("body").removeClass("scroll-disabled").addClass("scroll-enabled");$(".frame-left").hide();$(".frame-right").hide()},1000);return b},animateLeft:function(d,e){var c=this.$el;var f=d.$el;var a=this;if(e!=null){clearTimeout(e)}this.$el.show(0,function(){c.find("iframe").contents().find("body").removeClass("scroll-enabled").addClass("scroll-disabled");f.find("iframe").contents().find("body").removeClass("scroll-enabled").addClass("scroll-disabled");c.removeClass("frame-right");c.addClass("frame-middle");f.removeClass("frame-middle");f.addClass("frame-left")});var b=setTimeout(function(){$(".frame-middle").find("iframe").contents().find("body").removeClass("scroll-disabled").addClass("scroll-enabled");$(".frame-left").hide();$(".frame-right").hide()},1000);return b}});PulseApp.Views.ReadingTemplate=Backbone.View.extend({template:function(a){return _.template(PulseApp.Templates.ReadingTemplate,{data:a})},initialize:function(){var b=this.model.get("publishedDate")||this.model.get("updated"),a=this.model.get("source_title")===undefined?this.model.collection.source_title:this.model.get("source_title");if(b&&b!==""){this.model.set("prettyDate",PulseApp.Helpers.beautifyDate(b))}if(a&&a!==""){this.model.set("source_title",a)}this.render()},render:function(){this.$el.html(this.template(this.model.toJSON()));this.$el.find("img").attr("onerror","this.style.display='none';");div=this.$el.find(".video-post-ooyala").html();this.$el.find(".video-post-ooyala").html("");return this}});PulseApp.Views.TextSettingsPopUp=Backbone.View.extend({parent:"#reading-frames",id:"textsettings-dialog",className:"abs",template:function(a){return _.template(PulseApp.Templates.TextPopUp,{data:a})},events:{"click #clear-mask":"close","click #light":"toggleLight","click #dark":"toggleDark","click #sans":"toggleSans","click #serif":"toggleSerif","click #small":"toggleSmall","click #medium":"toggleMedium","click #large":"toggleLarge"},initialize:function(){this.is_visible=true;this.render()},render:function(){this.$el.append(this.template(PulseApp.Environment.ReadingPref));$(this.parent).append(this.$el);this.$el.find("#clear-mask").show();$("#text-options").toggleClass("pressed");return this},syncSettings:function(){if(Modernizr.localstorage){window.localStorage.setItem("readingPref",JSON.stringify(PulseApp.Environment.ReadingPref))}},close:function(){this.remove();this.is_visible=false;$("#text-options").toggleClass("pressed")},toggleSelection:function(b){var a=$(b.target);a.addClass("selected");a.siblings().removeClass("selected")},toggleDark:function(c){c.stopPropagation();var b=$(".reading-view-frame").contents().find("body");if(b.hasClass("__pulse_dark")===false){b.addClass("__pulse_dark")}var a=$(".reading_parent");if(a.hasClass("__pulse_dark")===false){a.addClass("__pulse_dark")}if(PulseApp.Environment.ReadingPref.mode!="dark"){this.toggleSelection(c);PulseApp.Environment.ReadingPref.mode="dark";this.syncSettings()}},toggleLight:function(c){c.stopPropagation();var b=$(".reading-view-frame").contents().find("body");if(b.hasClass("__pulse_dark")){b.removeClass("__pulse_dark")}var a=$(".reading_parent");if(a.hasClass("__pulse_dark")){a.removeClass("__pulse_dark")}if(PulseApp.Environment.ReadingPref.mode!="light"){this.toggleSelection(c);PulseApp.Environment.ReadingPref.mode="light";this.syncSettings()}},toggleSans:function(b){b.stopPropagation();var a=$(".reading-view-frame").contents().find("body");if(a.hasClass("__pulse_serif")){a.removeClass("__pulse_serif");this.toggleSelection(b);PulseApp.Environment.ReadingPref.font_style="sans";this.syncSettings()}},toggleSerif:function(b){b.stopPropagation();var a=$(".reading-view-frame").contents().find("body");if(a.hasClass("__pulse_serif")===false){a.addClass("__pulse_serif");this.toggleSelection(b);PulseApp.Environment.ReadingPref.font_style="serif";this.syncSettings()}},toggleSmall:function(b){b.stopPropagation();var a=$(".reading-view-frame").contents().find("body");if(a.hasClass("__pulse_smalltext")===false){a.addClass("__pulse_smalltext");a.removeClass("__pulse_largetext");this.toggleSelection(b);PulseApp.Environment.ReadingPref.font_size="small";this.syncSettings()}},toggleMedium:function(b){b.stopPropagation();var a=$(".reading-view-frame").contents().find("body");if(a.hasClass("__pulse_mediumtext")===false){a.removeClass("__pulse_smalltext");a.removeClass("__pulse_largetext");this.toggleSelection(b);PulseApp.Environment.ReadingPref.font_size="medium";this.syncSettings()}},toggleLarge:function(b){b.stopPropagation();var a=$(".reading-view-frame").contents().find("body");if(a.hasClass("__pulse_largetext")===false){a.removeClass("__pulse_smalltext");a.addClass("__pulse_largetext");this.toggleSelection(b);PulseApp.Environment.ReadingPref.font_size="large";this.syncSettings()}}});PulseApp.Views.MainContainer=Backbone.View.extend({el:$("#main_container"),subViews:{sidebar:{},content:{}},initialize:function(){if(this.model){this.model.bind("destroy",this.remove,this)}},render:function(e,b){var c=PulseApp.Environment.Constants;if(e!=c.SETTINGS&&e!=c.CATALOG&&e!=c.DEV&&e!=c.STORY){var h=this.model;this.model=b}this.removeOverlay();switch(e){case c.PAGE:if(this.sourcesMenu!=undefined){this.sourcesMenu.highlightAll()}if(PulseApp.RequestedUser&&PulseApp.RequestedUser.is_browsing&&!("/"+PulseApp.RequestedUser.username+"/"==Backbone.history.options.root)){PulseApp.Helpers.ResetRequestedUserContexts(this.model)}this.renderStreamView(e,h,b,g);PulseApp.ActiveViews.Header.setTitle(b.get("page_title"));break;case c.SOURCE:this.renderStreamView(e,h,b);PulseApp.LoggingHelper.openedSource(b);if(this.sourcesMenu===undefined&&(PulseApp.RequestedUser&&!PulseApp.RequestedUser.is_browsing)){var g=this.renderSourcesMenu(e,b.collection.page)}if(_.has(b,"collection")){PulseApp.ActiveViews.Header.setTitle(b.collection.page_title,b.get("source_title"))}else{PulseApp.ActiveViews.Header.setTitle("",b.get("source_title"))}break;case c.SOURCES_MENU:var g=this.renderSourcesMenu(e,b);PulseApp.ActiveViews.Header.setTitle(b.get("page_title"),b.get("source_title"));break;case c.CATALOG:this.renderCatalogView(b);break;case c.SAVED:PulseApp.LoggingHelper.openedPage(b,"saved");this.renderSavedView(h,b);PulseApp.ActiveViews.Header.setTitle("Saved Stories");break;case c.SETTINGS:PulseApp.LoggingHelper.logProfileView();this.renderSettingsView(b);break;case c.DEV:this.renderDevView();break;case c.ONBOARDING:this.renderOnboardingView();PulseApp.ActiveViews.Header.setTitle("Welcome to Pulse");break;case c.RECOMMENDED:this.renderRecommendedView(h,b);PulseApp.ActiveViews.Header.setTitle("Recommended Stories");break;case c.STORY:PulseApp.LoggingHelper.logReadingSplash(b.story);var d=b.page.get("page_sources").models[0];if(!PulseApp.Environment.isLoggedInUser()&&d.get("source_title")===b.story.feed_title){_gaq.push(["_setCustomVar",2,"Splash Story Visitor",__referring_user_id?"with user referral":"without user referral",1]);this.model=d;this.renderStreamView(c.SOURCE,null,this.model,g);this.renderSourcesMenu(c.SOURCE,this.model.collection.page);var f=$("#sources-list").children();$(f[0]).remove();var a=$("#source-items");$(a.children()[0]).remove();$("#main-nav-back-bg").remove();a.css("padding",0);$(a.children()[0]).addClass("highlight");$(".source-name").click(function(){return false})}else{this.model=b.page;this.renderStreamView(c.PAGE,null,this.model,g)}b.story.publishedDate=Date.parse(b.story.publishedDate)/1000;readingView=new PulseApp.Views.Reading({model:new PulseApp.Models.Story(b.story)},{position:"center",is_splash_story:true});__first_article=null;default:break}this.type=e;return this.subViews.content.view},renderSourcesMenu:function(d,a){var c=0,b=$("#main-nav");if(d===PulseApp.Environment.Constants.SOURCE||d===PulseApp.Environment.Constants.SOURCES_MENU){if(this.sourcesMenu!=undefined){this.sourcesMenu.remove()}this.sourcesMenu=new PulseApp.Views.SourcesMenu({model:a});if(d===PulseApp.Environment.Constants.SOURCES_MENU){this.sourcesMenu.highlightAll();$("#main-nav").addClass("show-sources");c=500;this.hideMenu()}else{$("#main-nav").addClass("show-sources");this.hideMenu()}}else{if(d===PulseApp.Environment.Constants.SOURCE&&(!$("#main-nav").hasClass("show-sources"))){$("#main-nav").addClass("show-sources")}else{$("#main-nav").removeClass("show-sources");c=200;this.hideMenu()}}return c},hideMenuTimeout:null,hideMenu:function(c){var a=$("#pages-menu"),b=this.sourcesMenu.$el;clearTimeout(this.hideMenuTimeout);a.height("auto");b.height("auto");this.hideMenuTimeout=setTimeout(function(){if($("#main-nav").hasClass("show-sources")){a.height(100);b.css({overflow:"visible"})}else{b.height(100).css({overflow:"hidden"});b.remove()}},300)},renderStreamView:function(e,b,f,d){var a=false,c,h;if(this.model.getOrCreateSource){c=this.model.getOrCreateSource().Stories;h=this.model.get("source_url")}else{if(this.model.get("page_sources").Sources==undefined){this.model.get("page_sources").getSources()}c=this.model.get("page_sources").Sources.CombinedSourcesStories}c.offset=0;if(b==f){a=true}if(!a||!this.subViews.content.view){var j=false,g=this.subViews.content.view;if(!g||this.type===undefined||(this.type>2)||(this.type===e&&!a)||(this.is_unsupported_message_shown())||(h&&!PulseApp.Helpers.isSupportedFeed(h))){this.removeSubViews();g=new PulseApp.Views.Stream({collection:c});this.subViews.content.view=g;j=true}else{g.collection=c;g.is_collection_changed=true;g.render()}g.redrawEnabled=false;setTimeout($.proxy(function(){if(j){this.$el.empty().append(g.$el);g.grid.onDomInsertion()}g.redrawEnabled=true;if(g.debouncedRedraw){g.debouncedRedraw()}},this),Math.max(0,(d||0)-g.redrawDelay))}},renderCatalogView:function(a){this.subViews.overlay=new PulseApp.Views.Catalog({model:a});this.subViews.overlay.render()},renderSavedView:function(b,a){if(b!==a){this.subViews.content.view=new PulseApp.Views.SavedStories({collection:a});this.$el.html(this.subViews.content.view.render().$el)}},renderRecommendedView:function(b,a){if(b!==a){this.subViews.content.view=new PulseApp.Views.RecommendedStories({collection:a});this.$el.html(this.subViews.content.view.render().$el)}},renderOnboardingView:function(){this.removeSubViews();this.subViews.content.view=new PulseApp.Views.OnBoarding();this.$el.html(this.subViews.content.view.$el)},renderDevView:function(){this.subViews.overlay=new PulseApp.Views.DevPage()},renderSettingsView:function(a){this.subViews.overlay=new PulseApp.Views.ProfileSettings({model:a})},removeSubViews:function(){if(this.subViews.content.view!=undefined){this.subViews.content.view.remove()}},removeOverlay:function(){if(this.subViews.overlay!==undefined){this.subViews.overlay.remove()}},is_unsupported_message_shown:function(){if(this.subViews.content.view.$el.find(".feed-not-supported").length>0){return true}else{return false}}});PulseApp.Views.Stream=Backbone.View.extend({className:"stream_container",events:{"click #loadMore":"loadMoreStories","pulse.grid.loadnew #new-content-info":"loadNewContent"},template:function(){return _.template(PulseApp.Templates.StreamContent,{})},initialize:function(){_.bindAll(this,"loadMoreStories","onScroll","updateContent","remove");this.collection.bind("add",this.addStory,this);this.collection.bind("remove",this.removeStory,this);this.collection.bind("reset",this.render,this);if(this.collection.feed_url){this.collection.bind("fetching",this.fetching,this);this.collection.bind("successful_sync",this.successfulSync,this);this.collection.bind("error",this.unsuccessfulSync,this)}else{if(this.collection.collection){this.collection.collection.bind("fetching",this.fetching,this);this.collection.collection.bind("successful_sync",this.successfulSync,this);this.collection.collection.bind("error",this.unsuccessfulSync,this)}else{this.collection.bind("fetching",this.fetching,this);this.collection.bind("successful_sync",this.successfulSync,this);this.collection.bind("error",this.unsuccessfulSync,this)}}this.is_collection_changed=false;this.el.id=this.cid.toString();this.isScrollLoading=false;this.scrollLoadReset=null;this.grid=new PulseApp.Views.PulseGrid(this.$el,this.collection);var b=200;var a=this;this.debouncedResize=_.debounce(function(){a.grid.resize();a.redraw(true)},b);this.redrawDelay=50;this.redrawEnabled=true;this.debouncedRedraw=_.debounce(function(){if(a.redrawEnabled){a.redraw(true)}else{this.debouncedRedraw()}},this.redrawDelay);if(this.collection.models.length!=0){this.render()}if((this.collection.source_title!=undefined)&&(this.collection.models.length===0)&&PulseApp.Helpers.isSupportedFeed(this.collection.feed_url)){this.collection.fetch()}else{if((this.collection.collection!==undefined)&&(!this.collection.collection.is_syncing)&&(this.collection.models.length===0)){this.collection.collection.fetch()}if((this.collection.feed_url&&!PulseApp.Helpers.isSupportedFeed(this.collection.feed_url)&&this.collection.localKey!=="saved")){this.renderFeedNotSupported()}}this.feed_offset=0;$(window).on("resize",this.debouncedResize)},fetching:function(){$("#top-throbber").show()},successfulSync:function(a){$("#top-throbber").hide()},unsuccessfulSync:function(){},removeStory:function(a){this.grid.removeTiles([a.get("url")||a.get("link")]);this.debouncedRedraw()},render:function(){if($.isFunction(this.collection.getCombinedPageStories)||_.has(this.collection,"feed_url")&&PulseApp.Helpers.isSupportedFeed(this.collection.feed_url)||_.has(this.collection,"collection_type")&&this.collection.collection_type=="saved"){var b;try{this.$el.scrollTop(0)}catch(a){}PulseApp.Notify.remove();if(this.$el.find("#tile-grid").length===0){this.$el.append(this.template())}if($.isFunction(this.collection.getCombinedPageStories)){if(PulseApp.Intervals.sourceStream){clearInterval(PulseApp.Intervals.sourceStream)}if(PulseApp.Intervals.pageStream){clearInterval(PulseApp.Intervals.pageStream)}PulseApp.Intervals.pageStream=setInterval(this.collection.collection.updateCombinedStories.updateStories,900*1000);b=this.collection.getCombinedPageStories()}else{b=this.collection.models;if(b[0]&&b[0].get("type")!="bookmark"&&this.collection.updateStories){if(b[0].get("type")!="bookmark"&&this.collection.updateStories){if(PulseApp.Intervals.sourceStream){clearInterval(PulseApp.Intervals.sourceStream)}if(PulseApp.Intervals.pageStream){clearInterval(PulseApp.Intervals.pageStream)}this.collection.updateStories.fetch();PulseApp.Intervals.sourceStream=setInterval(this.collection.updateStories.updateStories,900*1000)}}}var c=_.map(b,function(d){d.set("type","source");return d.get("url")||d.get("link")});this.grid.$el=this.$("#tile-grid");this.grid.$el.on("scroll",this.onScroll);this.grid.collection=this.collection;this.grid.updateTiles(c);this.debouncedRedraw();$("#main-throbber").hide()}else{this.renderFeedNotSupported()}},renderFeedNotSupported:function(){$("#main-throbber").hide();this.$el.append(_.template(PulseApp.Templates.NotSupported,{}))},redraw:function(b){this.$(".black_spinner").remove();this.redrawEnabled=false;var a=this;this.grid.redraw(b,function(e){a.redrawEnabled=true;if(e){a.isScrollLoading=false;if(a.scrollLoadReset){clearTimeout(a.scrollLoadReset);a.scrollLoadReset=null}}var c=a.grid.$el.height(),d=a.grid.$el.prop("scrollHeight");if(c>0&&d>0&&c===d){a.loadMoreStories()}})},updateContent:function(){this.collection.collection.fetch({add:true})},onScroll:function(){var b=this.grid.$el.scrollTop(),a=this.grid.$el.height(),c=this.grid.$el.prop("scrollHeight");START_LOADING_BUFFER=a*5,self=this;if(this.isScrollLoading){return}if(c-b<=START_LOADING_BUFFER){this.isScrollLoading=true;this.scrollLoadReset=setTimeout(function(){self.isScrollLoading=false},3*1000);this.$el.append("<div class='black_spinner' style='visibility: hidden;'></div>");this.loadMoreStories()}},addStory:function(b,c,a){if(a.index===0){if(!$("#new-content-info").is(":visible")){$("#new-content-info").show()}}else{this.grid.addTiles([b.get("url")||b.get("link")]);this.debouncedRedraw()}},loadMoreStories:function(){var a=null;if(this.collection.loadMoreSavedStories){this.collection.loadMoreSavedStories()}else{if($.isFunction(this.collection.getCombinedPageStories)){a=this.collection.getCombinedPageStories()}else{this.collection.loadMore()}}_gaq.push(["_trackEvent","Stream_View","load_more_scroll"]);if(a!==null){$("#loadMore").remove();var b=_.map(a,function(c){c.set("type","source");return c.get("url")||c.get("link")});this.grid.addTiles(b);this.debouncedRedraw()}},loadNewContent:function(){if($.isFunction(this.collection.getNewContent)){var b=this.collection.getNewContent(),c=_.map(b,function(d){return d.get("url")||d.get("link")});this.grid.insertTiles(c);this.debouncedRedraw();$("#new-content-info").hide();$("body").scrollTop(0)}else{if($.isFunction(this.collection.getCombinedPageStories)){this.collection.offset=0;var a=this.collection.getCombinedPageStories()}else{var a=this.collection.models}var c=_.map(a,function(d){d.set("type","source");return d.get("url")||d.get("link")});this.grid.collection=this.collection;this.grid.updateTiles(c);this.debouncedRedraw();$("#new-content-info").hide()}},remove:function(){if(PulseApp.Intervals.sourceStream){clearInterval(PulseApp.Intervals.sourceStream)}if(PulseApp.Intervals.pageStream){clearInterval(PulseApp.Intervals.pageStream)}$(window).off("resize",this.debouncedResize);this.grid.$el.off("scroll");this.grid.onRemove();this.collection.unbind("add",this.addStory,this);this.collection.unbind("remove",this.removeStory,this);this.collection.unbind("reset",this.render,this);Backbone.View.prototype.remove.call(this)}});PulseApp.Views.Story=Backbone.View.extend({className:"story_tile",events:{"click #author":"trackAuthor"},template:function(a){return _.template(PulseApp.Templates.StoryTile,{data:a})},initialize:function(b,a){this.model=b.model;this.model.bind("destroy",this.remove,this);this.model.bind("change:is_read",this.markRead,this);this.streamCollection=a.collection;var d=this.model.get("publishedDate")||this.model.get("updated"),c=this.model.get("title"),e=this.model.get("contentSnippet");if(d&&d!==""){this.model.set("time",PulseApp.Helpers.streamDate(d));this.model.set("prettyDate",PulseApp.Helpers.beautifyDate(d))}if(this.model.get("type")!="bookmark"){this.model.set("truncatedSnippet",PulseApp.Helpers.truncateWithEllipsis(e,275))}this.model.set("truncatedTitle",PulseApp.Helpers.truncateWithEllipsis(c,90));this.render()},render:function(){this.$el.append(this.template(this.model.toJSON()));return this},markRead:function(){if(!this.$el.find(".story-bg").hasClass("read")){this.$el.find(".story-bg").addClass("read")}},trackAuthor:function(){_gaq.push(["_trackEvent","Stream_View","author_click"])}});PulseApp.Views.TopHeader=Backbone.View.extend({parent:$("#reader_container"),events:{"click #ielogo-container":"navigateToDevPage","mouseenter #ielogo-container":"hoverOn","mouseleave #ielogo-container":"hoverOff","click #header-add-page":"addPage","click #twitter":"share","click #facebook":"share",},initialize:function(a){this.$el=$("#header_top");if(a){for(key in a){this[key]=a[key]}}if(this.model&&this.model.get("source_url")){this.is_source=true;this.$el.find("#header-add-page").html("Add Source");yepnope({load:_loader([_p.catalog_css,_p.catalog])})}else{this.is_source=false;this.$el.find("#header-add-page").html("Add Page")}},navigateToDevPage:function(a){_gaq.push(["_trackEvent","msft","dev_page_click"]);PulseApp.RouterObject.navigate("dev",{trigger:true})},hoverOn:function(a){$(".ietext.ietop.normal").stop().delay(75).animate({right:"-2",opacity:0},400,"easeInOutQuart");$(".ietext.ietop.over").stop().delay(75).animate({right:"58",opacity:1},400,"easeInOutQuart");$(".ietext.iebottom.normal").stop().animate({right:"128",opacity:0},400,"easeInOutQuart");$(".ietext.iebottom.over").stop().animate({right:"58",opacity:1},400,"easeInOutQuart")},hoverOff:function(a){$(".ietext.ietop.normal").stop().animate({right:"58",opacity:1},400,"easeInOutQuart");$(".ietext.ietop.over").stop().animate({right:"118",opacity:0},400,"easeInOutQuart");$(".ietext.iebottom.normal").stop().delay(75).animate({right:"58",opacity:1},400,"easeInOutQuart");$(".ietext.iebottom.over").stop().delay(75).animate({right:"-2",opacity:0},400,"easeInOutQuart")},switchContext:function(a){this.$el.find("#header-by-user").html("");this.$el.find("#header-add-page").addClass("hide");this.$el.find("#twitter").removeClass("hide");this.$el.find("#facebook").removeClass("hide");if(a=="requested"){this.$el.find("#header-add-page").removeClass("hide")}if(a=="saved"||!PulseApp.Username){this.$el.find("#twitter").addClass("hide");this.$el.find("#facebook").addClass("hide")}},share:function(f){var a=f.target.id,d=this.model.get("source_title")?"Header Share Source":"Header Share Page",g=a;if(!PulseApp.Profile.get("is_public")){var b=new PulseApp.Views.ModalPrompt("Share Your Pulse","Public profiles allow you to share pages and sources. Would you like to make your profile public?","Yes","No");b.onRightClick(function(){b.remove()});b.onLeftClick(function(){$.ajax({url:PulseApp.Environment.Endpoints.Profile,type:"POST",data:{is_public:"True"},statusCode:{200:function(e){PulseApp.Profile.destroy();PulseApp.Profile=new PulseApp.Models.Profile(e.data);b.remove()},500:function(){_gaq.push(["_trackEvent","api_endpoint_fail","profile"])}}})})}else{var j=(PulseApp.RequestedUser&&PulseApp.RequestedUser.is_browsing)?PulseApp.RequestedUser.username:PulseApp.Username,c=PulseApp.Environment.determineHttpHostname(),h=this.model.get("catalog_item")?this.model.get("catalog_item").get("image_url"):c+PulseApp.Environment.Endpoints.ProfilePhoto+PulseApp.Profile.get("user_id");fb_message=this.model.get("source_title")?(j+" is reading "+this.model.get("source_title")+" on Pulse. Check it out now!"):(j+" created a page on Pulse. Start reading '"+this.model.get("page_title")+"' now!"),tw_message=this.model.get("source_title")?("I’m reading "+this.model.get("source_title")+" on @pulsepad"):("I'm reading a page on @pulsepad. "+this.model.get("page_title")),FACEBOOK_SHARE_URL="https://www.facebook.com/dialog/feed?app_id="+PulseApp.Environment.determineFacebookAppId()+"&redirect_uri="+encodeURIComponent(c)+"/app/successful-share&name="+encodeURIComponent(this.model.get("source_title")||this.model.get("page_title"))+"&picture="+encodeURIComponent(h)+"&caption= &link="+encodeURIComponent(window.location.href)+"&description="+encodeURIComponent(fb_message),TWITTER_SHARE_URL="https://twitter.com/intent/tweet?url="+encodeURIComponent(window.location.href)+"&text="+encodeURIComponent(tw_message)+"&related=pulsepad";width="1000";height="550";if(a=="facebook"){window.open(FACEBOOK_SHARE_URL,"_blank","width="+width+", height="+height)}else{if(a=="twitter"){window.open(TWITTER_SHARE_URL,"_blank","width="+width+", height="+height)}}if(this.model.get("source_title")){PulseApp.LoggingHelper.sharedSource(this.model,a)}else{PulseApp.LoggingHelper.sharedPage(this.model,a)}}},addPage:function(h){if(PulseApp.User.is_authenticated){if(this.is_source){var a=this;if(_.indexOf(PulseApp.UserPages.addedSources,this.model.get("source_url"))==-1){this.model.set("is_added",true);popup=new PulseApp.Views.AddPagePopUp({model:PulseApp.UserPages.models},{catalogItem:this.model,addButton:h.target,page:{x:($(window).width()/2),y:($(window).height()/2)},type:"shared"});popup.$el.css("position","fixed");popup.$el.find("#mask").css("background","rgba(0, 0, 0, 0.5)");this.$el.append(popup.$el);setTimeout(function(){a.$el.find("#popup").addClass("loaded")},1)}else{alert("The source is already added")}return}else{var c=this.model.get("page_title").toLowerCase(),d=PulseApp.UserPages.models.length,g=this.model,b=false,f=false;_.each(PulseApp.UserPages.models,function(e){if(c==e.get("page_title").toLowerCase()){b=true}});PulseApp.LoggingHelper.addedPage(this.model);if(b){c+=" by "+PulseApp.RequestedUser.username}_.each(g.get("page_sources").models,function(e){if(_.indexOf(PulseApp.UserPages.addedSources,e.get("source_url"))==-1){if(!f){PulseApp.UserPages.add(new PulseApp.User.Models.Page({page_title:c,page_position:d}));f=true}PulseApp.UserPages.addSourceToPage(d,e)}})}if(f){PulseApp.UserPages.forceSync(true);PulseApp.Helpers.resetPersonalUrl();PulseApp.RouterObject.navigate(g.get("page_route"),{trigger:true})}else{alert("You are subscribed to these sources already.")}}else{if(this.is_source){}else{}}},setTitle:function(a,c){var b=(a||"").toLowerCase();b=unescape(b);if(c){if(b){b+=" / "}b+=c.toLowerCase()}header_title=this.$el.find("#header-title");header_title.html(b);header_title.toggle().toggle()},});PulseApp.Templates.LeftSideBarPageItem=['<a class="pages_icon ellipsis" data-href="<%= data.page_route %>">',"<%= data.page_title.toLowerCase() %>","</a>",'<i class="icon-right bevel dark"></i>','<div class="drag-icon"></div>'].join("");PulseApp.Templates.SourcesMenu=['<li class="source-back">','<i class="icon-left-small white"></i>','<a data-href="<%= data.page_route %>" contentEditable="false">Back</a>',"</li>",'<div id="source-items">',"<li>",'<a class="source-name all selected" data-href="<%= data.page_route %>" contentEditable="false">All <%= data.page_title %></a>',"</li>","</div>"].join("");PulseApp.Templates.AddContentItem=['<li id="left-nav-catalog-container" class="left-nav-blank">','<a id="left-nav-catalog" class="outerbutton" href="javascript:void(0)">','<div class="button">',"<span>Add Content </span>",'<i class="icon-plus bevel"></i>',"</div>","</a>","</li>"].join("");PulseApp.Templates.SourceItem=['<a class="source-name ellipsis rel" data-href="<%= data.page_route %>/<%= data.source_route %>" contentEditable="false"><%= data.source_title %></a>','<div class="source-options icon-close dark bevel abs"></div>'].join("");PulseApp.Templates.SourceItemOptions=['<div id="source-options-container">','<div class="source-options-clickoff fix"></div>','<div class="source-options-menu">','<div class="menuheader">','<div class="icon-close abs"></div>',"</div>",'<div class="menubackground">',"<ul>",'<li class="menuitem del"><span class="icon-close"></span><span>Unsubscribe</span>',"</ul>","</div>","</div>","</div>"].join("");PulseApp.Views.LeftBar=Backbone.View.extend({el:$("#navigation_sidebar"),events:{"click #saved_stories_page":"loadSaved","click #friends_stories_page":"loadRecommended","click #logo-container":"trackLogoClick","click #account":"trackAccount","click #logout":"trackLogout","click #user-container":"trackProfileClick","click #left-nav-catalog":"addContentClick","click #signup-now":"loadSignUpUpsell"},initialize:function(a){this.$pageMenu=$("#page-menu");_.bindAll(this,"orderChanged","sortingStarted");this.collection.bind("add",this.addPage,this);this.pageItemList=[];this.render();this.$pageMenu.sortable({disabled:false,cancel:".contenteditable",axis:"y",containment:"parent"});this.$pageMenu.bind("sortstart",this.sortingStarted);this.$pageMenu.bind("sortupdate",this.orderChanged)},render:function(){_.each(this.collection.models,function(b){var a=new PulseApp.Views.PageListItem({model:b});this.pageItemList.push(a);this.$pageMenu.append(a.$el)},this);return this},sortingStarted:function(a,b){this.old_position=$(b.item[0]).index()},orderChanged:function(d,f){var b=f.item[0].textContent,c=[],g=true,e=$(f.item[0]).index(),a=this;this.collection.reorderPages(b,this.old_position,e);if(this.reorder_timeout){window.clearTimeout(this.reorder_timeout)}this.reorder_timeout=window.setTimeout(function(){a.collection.forceSync(true);PulseApp.LoggingHelper.sendBatchLogs()},30*1000)},addPage:function(b){var a=new PulseApp.Views.PageListItem({model:b});this.pageItemList.push(a);this.$pageMenu.append(a.$el)},trackLogoClick:function(){_gaq.push(["_trackEvent","Left_Nav","left_logo_click"]);if(!PulseApp.Environment.isLoggedInUser()){window.location="/"}},trackAccount:function(){_gaq.push(["_trackEvent","Left_Nav","account_page_click"])},trackLogout:function(){_gaq.push(["_trackEvent","Left_Nav","logout_click"])},loadSaved:function(){_gaq.push(["_trackEvent","Left_Nav","saved_page_click"]);PulseApp.RouterObject.navigate("saved",{trigger:true})},loadRecommended:function(){PulseApp.RouterObject.navigate("recommended",{trigger:true})},trackProfileClick:function(){PulseApp.Helpers.storePreviousHistory();PulseApp.Helpers.resetPersonalUrl();PulseApp.RouterObject.navigate("settings",{trigger:true,replace:false});_gaq.push(["_trackEvent","Left_Nav","profile_click"])},addContentClick:function(){PulseApp.Helpers.storePreviousHistory();PulseApp.Helpers.resetPersonalUrl();if(PulseApp.Views.onboarding!==undefined){PulseApp.RouterObject.navigate("onboarding",{trigger:true})}else{PulseApp.RouterObject.navigate("catalog",{trigger:true,replace:false});_gaq.push(["_trackEvent","Left_Nav","catalog_open_click"])}if(PulseApp.isMobile){$("#reader_container").removeClass("mobile-showsidebar")}},loadSignUpUpsell:function(){PulseApp.Helpers.createSignUpModal("Sign up for Pulse","Create an account today","sidebar")}});PulseApp.Views.PageListItem=Backbone.View.extend({tagName:"li",className:"nav-section rel",events:{click:"loadAllForPage","click .source-back":"loadAllForPage"},template:function(a){return _.template(PulseApp.Templates.LeftSideBarPageItem,{data:a})},initialize:function(a){_.bindAll(this,"leftButtonClick");this.id=this.model.get("page_title");this.model.bind("reset",this.render,this);this.model.bind("change:is_selected",this.toggleSelected,this);this.model.bind("destroy",this.removePage,this);if(a){for(key in a){this[key]=a[key]}}this.render();this.edit_option=this.$el.find(".edit-name")[0]},render:function(){if(this.model.get("is_selected")){this.$el.addClass("highlight")}this.$el.append(this.template(this.model.toJSON()));return this},removePage:function(){this.remove();$("#pages-menu").css({height:"auto"});$("#main-nav").removeClass("show-sources");PulseApp.RouterObject.navigate("/",{trigger:true})},toggleSelected:function(){if(this.model.get("is_selected")){this.$el.addClass("highlight")}else{this.$el.removeClass("highlight")}},loadAllForPage:function(b){if(!this.is_edit_mode){_gaq.push(["_trackEvent","Left_Nav","left_page_click"]);PulseApp.LoggingHelper.openedPage(this.model,"page");var a=this.$el.find("a").attr("data-href");PulseApp.Helpers.resetPersonalUrl();PulseApp.RouterObject.navigate(a,{trigger:true});if(this.model.get("is_selected")){PulseApp.ActiveViews.Main.render(PulseApp.Environment.Constants.SOURCES_MENU,this.model)}return false}},leftButtonClick:function(){this.messagePrompt.remove()}});PulseApp.Views.SourcesMenu=Backbone.View.extend({parent:"#main-nav > #sources-menu",tagName:"ul",id:"sources-list",className:"ui-sortable",template:function(a){return _.template(PulseApp.Templates.SourcesMenu,{data:a})},events:{"click .source-back":"navigateBack","click .source-name":"navigateToLink","click .source-options-clickoff":"removeSourceOptions","click #left-nav-catalog":"addContentClick",},initialize:function(a){_.bindAll(this,"orderChanged","sortingStarted");this.$el.sortable({items:".source-item",axis:"y",containment:"parent"}).disableSelection();this.$el.bind("sortstart",this.sortingStarted);this.$el.bind("sortupdate",this.orderChanged);this.model.bind("destroy",this.remove,this);this.model.get("page_sources").bind("add",this.addSource,this);this.$logo=$("#logo-container");this.$logo.on("click",this.navigateBack);if(a){for(key in a){this[key]=a[key]}}this.render();return this},render:function(){var b=this.model.get("page_sources"),d,c=this.template(this.model.toJSON()),e=true,a;this.$el.append(c);d=this.$el.find("#source-items");_.each(b.models,function(f){if(f.get("is_selected")){e=false}$(d).append(new PulseApp.Views.SourceListItem({model:f}).$el)},this);this.$el.append(_.template(PulseApp.Templates.AddContentItem));$(this.parent).empty();$(this.parent).append(this.$el);return this},removeSourceOptions:function(){$("#source-options-container").remove()},sortingStarted:function(a,b){this.old_position=$(b.item[0]).index()},orderChanged:function(d,g){var b=g.item[0].textContent,c=[],h=true,f=$(g.item[0]).index()-1,a=this,e=this.model.get("page_sources");e.reorderSources(b,this.old_position,f);if(this.reorder_timeout){window.clearTimeout(this.reorder_timeout)}this.reorder_timeout=window.setTimeout(function(){PulseApp.UserPages.forceSync(true);PulseApp.LoggingHelper.sendBatchLogs()},30000)},navigateBack:function(d){var a,c,b;PulseApp.UserPages.forceSync(true);if(d!=undefined){a=$(d.target);c=a.data("href")}else{b=this.$el.find(".source-name.all");c=escape($(b).attr("data-href"))}PulseApp.ActiveViews.Main.renderSourcesMenu(PulseApp.Environment.Constants.PAGE,this.model);this.$logo.off("click",this.navigateBack);PulseApp.RouterObject.navigate(c,{trigger:true})},navigateToLink:function(c){var a=$(c.target),b=a.data("href");if(a.hasClass("all")){this.highlightAll()}PulseApp.RouterObject.navigate(b,{trigger:true})},applyDiff:function(){var c=$(".source-name"),b=this.model.get("page_sources").models,a;_.each(c,function(e,d){a=$(e).text();if(a!==b[d].get("source_title")){pulse.console.log("Name changes to : "+a);b[d].set("source_title",a)}})},addSource:function(a){this.$el.find("#source-items").append(new PulseApp.Views.SourceListItem({model:a}).$el)},highlightAll:function(){var a;$("#sources-list li").removeClass("highlight");a=this.$el.find("#source-items").children()[0];$(a).addClass("highlight")},isAllHighlighted:function(){var a=this.$el.find("#source-items").children()[0];return $(a).hasClass("highlight")},remove:function(){this.model.unbind("destroy",this.remove,this);this.model.get("page_sources").unbind("add",this.addSource,this);return Backbone.View.prototype.remove.call(this)},addContentClick:function(){PulseApp.Helpers.storePreviousHistory();if(PulseApp.Views.onboarding!==undefined){PulseApp.RouterObject.navigate("onboarding",{trigger:true})}else{PulseApp.RouterObject.navigate("catalog",{trigger:true,replace:false});_gaq.push(["_trackEvent","Left_Nav","catalog_open_click"])}if(PulseApp.isMobile){$("#reader_container").removeClass("mobile-showsidebar")}},});PulseApp.Views.SourceListItem=Backbone.View.extend({tagName:"li",messagePrompt:null,className:"source-item",template:{sourceItem:function(a){return _.template(PulseApp.Templates.SourceItem,{data:a})},sourceItemOptions:function(a){return _.template(PulseApp.Templates.SourceItemOptions,{data:a})}},events:{"click .del":"deleteSource","click .icon-close":"showRemovePrompt",},initialize:function(){_.bindAll(this,"leftButtonClick","rightButtonClick");this.model.bind("change:is_selected",this.toggleSelected,this);this.render()},render:function(){this.model.set("page_title",this.model.collection.page_title);if(this.model.get("is_selected")){this.$el.addClass("highlight")}this.$el.append(this.template.sourceItem(this.model.toJSON()));return this},toggleSelected:function(){if(this.model.get("is_selected")){$("#sources-list li").removeClass("highlight");this.$el.addClass("highlight")}},deleteSource:function(){try{PulseApp.LoggingHelper.sendLog({name:"Removed Source",feedUrl:this.model.get("source_url"),feedTitle:this.model.get("source_title"),catalogItemPrimaryKey:this.model.get("catalog_primary_key"),removedBy:""})}catch(a){pulse.console.log("Error in sending Remove Source log")}this.model.collection.remove(this.model);this.modelDestroyed();pulse.console.log(this.model)},showOptions:function(){if(!this.$el.find("#source-options-container").length){this.$el.append(this.template.sourceItemOptions(this.model.toJSON()));return this}},showRemovePrompt:function(){if(PulseApp.Environment.isLoggedInUser()){var c=this.model.toJSON();var b=this.$el.offset();var a=220;var d=b.top-40;this.messagePrompt=new PulseApp.Views.ModalPrompt("Remove "+c.source_title+"?","Are you sure you want to unsubscribe from <strong>"+c.source_title+"</strong>?","Yes","Cancel",a,d);this.messagePrompt.parent=this;this.messagePrompt.onLeftClick(this.leftButtonClick);this.messagePrompt.onRightClick(this.rightButtonClick);return this}else{PulseApp.Helpers.createSignUpModal("Editing Subscriptions","Sign up to modify your subscriptions.","remove_source")}},leftButtonClick:function(){var a=this;this.$el.animate({left:"-100%",opacity:"0"},150,function(){a.deleteSource();a.messagePrompt.remove()})},rightButtonClick:function(){this.messagePrompt.remove();if(this.onRightClick!=null){this.messagePrompt.onRightClick()}},modelDestroyed:function(){PulseApp.Notify.set("Deleted");_gaq.push(["_trackEvent","Stream_View","source_delete_click"]);PulseApp.Notify.remove();if(this.$el.hasClass("highlight")){window.history.back()}this.remove()}});(function(){var j=6,a=50,m=2;function d(q,p,r,t){this.width=q;this.height=p;this.area=q*p;this.count=r;this.probability=t}d.sortByAreaDesc=function(q,p){if(q.area>p.area){return -1}if(q.area===p.area){return 0}return 1};function e(q,p){return Math.floor(Math.random()*(p-q+1)+q)}function f(t){var r=[],q,p;for(q=0,p=t.length;q<p;q++){r.push(t[q].count)}return JSON.stringify(r)}function b(u,w,B){var r=[],p=0,t=0,v,x,F,A,E;for(v=0,x=B.length;v<x;v++){F=B[v];if(F.width<=u){A=new d(F.width,F.height,Math.ceil(F.probability*w),F.probability);r.push(A);t+=A.count;p+=(A.area*A.count)}}r.sort(d.sortByAreaDesc);var z=0,C=0,y=0,D;var q=function(G,H){var I=r[G];if(H<0){H=Math.max(H,-I.count)}I.count+=H;t+=H;p+=(H*I.area)};while(z++<a){D=Math.ceil(p/u);for(v=r.length-1;v>=0;v--){A=r[v];if(A.height>D||A.width>u){q(v,-A.count)}}if(t!==w){q(y,w-t)}if(p%u===0){for(C=0;C<m;C++){E=l(r,u,p/u);if(E){return E}}}else{}if(y===r.length-1){q(y,1);y--}else{q(y,-1);y++}}return null}function l(q,r,w){var F=[],C,B;for(B=0;B<w;B++){F[B]=[];for(C=0;C<r;C++){F[B][C]=false}}var D=[],u,t,v,z,E,A;for(u=0,v=q.length-1;u<v;u++){z=q[u];for(t=0;t<z.count;t++){E=k(z,F,r,w);h(E,D);A=n(E);if(!A){return null}for(B=0;B<A.height;B++){for(C=0;C<A.width;C++){F[A.y+B][A.x+C]=true}}D.push(A)}}var p=q[q.length-1];D=D.concat(k(p,F,r,w));D.sort(g);return new Tiles.Template(D,r,w)}function h(y,z){var r=y.length,u=z.length,p,x,t,q,w,v;for(t=0;t<r;t++){p=y[t];p.penalty=0;for(q=0;q<u;q++){x=z[q];if(p.x===x.x&&p.width===x.width){w=Math.min(Math.abs(p.y-(x.y+x.height)),Math.abs(x.y-(p.y+p.height)));v=Math.max(0,j-w)+1;p.penalty+=v}else{if(p.y===x.y&&p.height===x.height){w=Math.min(Math.abs(p.x-(x.x+x.width)),Math.abs(x.x-(p.x+p.width)));v=Math.max(0,j-w)+1;p.penalty+=v}}}}}function n(v){var t=v.length;if(t===0){return null}v.sort(c);var p=v[0].penalty,u=[],r,q;for(r=0;r<t;r++){q=v[r];if(q.penalty>p){break}u.push(q)}return u[e(0,u.length-1)]}function g(q,p){if(q.y<p.y){return -1}if(q.y>p.y){return 1}if(q.x<p.x){return -1}if(q.x>p.x){return 1}return 0}function c(q,p){if(q.penalty<p.penalty){return -1}if(q.penalty>p.penalty){return 1}return 0}function k(w,E,q,v){var D=Tiles.Rectangle,C=[],p=v-w.height+1,u=q-w.width+1,A,z,t,r,B;for(z=0;z<p;z++){for(A=0;A<u;A++){B=true;for(t=0;t<w.height;t++){for(r=0;r<w.width;r++){if(E[z+t][A+r]){B=false;break}}}if(B){C.push(new D(A,z,w.width,w.height))}}}return C}var o=[{width:2,height:2,probability:0.2},{width:2,height:1,probability:0.25},{width:1,height:2,probability:0.25},{width:1,height:1,probability:0.3}];Tiles.DiverseTemplates={get:function(r,p,q){return b(r,p,q||o)}}})();PulseApp.Views.PulseTile=function(b,a){Tiles.Tile.call(this,b,a)};PulseApp.Views.PulseTile.prototype=new Tiles.Tile();PulseApp.Views.PulseTile.constructor=PulseApp.Views.PulseTile;PulseApp.Views.PulseTile.prototype.resize=function(a,d,c,f,e){var b=this;Tiles.Tile.prototype.resize.call(this,a,d,c,f,function(){b.afterResize(a,e)})};PulseApp.Views.PulseTile.prototype.afterResize=function(b,d){var c=["tile-2x2","tile-2x1","tile-1x1"],e="tile-"+b.width+"x"+b.height,a=_.without(c,e).join(" ");this.$el.removeClass(a).addClass(e);if(d){d()}};PulseApp.Views.PulseTile.prototype.appendTo=function(h,a,f,g){Tiles.Tile.prototype.appendTo.call(this,h,a,f,g);var d=this.$el.find(".story-bg").css("background-image"),e=d.replace(/url\(|\)|"|'/g,""),c=this,b;if(e&&e!=="none"){b=new Image();b.onload=function(){c.$el.find(".story-color").fadeOut(1000)};b.onerror=function(){c.$el.find(".story-tile-byline").addClass("story-text-only")};setTimeout(function(){b.src=e},f||1)}};(function(){var c=[{width:2,height:2,probability:0.15},{width:2,height:1,probability:0.2},{width:1,height:1,probability:0.65}];var d=[{cols:5,tiles:25,rows:[".AABB","...BB","CCDD.","CC...","EE...","..FF.",".GGHH",".GGII"]},{cols:5,tiles:25,rows:[".AABB","CC.BB","DDEE.","DD.FF",".GG..","..HH.","IIHH.",".JJKK",".JJLL"]},{cols:5,tiles:25,rows:["...AA",".BB..",".BB..","CC...","..DD.","EEDD.","...FF"]},{cols:5,tiles:25,rows:[".AABB","CC.BB","DDEE.","DD.FF",".GG..","..HH.","IIHH.",".JJKK",".JJLL"]}];var a={},b="col-";PulseApp.Views.PulseTileTemplates={get:function(k,f){var j=[],g,e,h;for(g=0,e=d.length;g<e;g++){h=d[g];if(h.cols===k&&h.tiles===f){j.push(h)}}if(j.length>0){g=Math.floor(Math.random()*j.length);return Tiles.Template.fromJSON(j[g].rows)}return Tiles.DiverseTemplates.get(k,f,c)},getStreamTemplate:function(h,j,f){var e=a[h];if(e){var g=e[b+j];if(g&&g.rects.length<=f){return g.copy()}}return null},setStreamTemplate:function(g,f){var e=a[g];if(!e){e=a[g]={}}e[b+f.numCols]=f.copy()}}})();(function(){PulseApp.Views.PulseGrid=function(d,e){Tiles.Grid.call(this,null);this.$view=d;this.cellSizeMin=b();this.cellPadding=5;this.appendDelayIncrement=0;this.priorityPageSize=25;this.storyUrlsByImageSize=[];this.mode=Modernizr.localstorage?window.localStorage.getItem("gridMode"):PulseApp.Environment.GridMode.MAGAZINE;this.pinchStartMode=this.mode;this.templateFactory=(this.mode===PulseApp.Environment.GridMode.MAGAZINE)?PulseApp.Views.PulseTileTemplates:Tiles.UniformTemplates;this.enablePrioritization=false;this.collection=e;this.holdToSave=true};PulseApp.Views.PulseGrid.prototype=new Tiles.Grid();PulseApp.Views.PulseGrid.constructor=PulseApp.Views.PulseGrid;var c=PulseApp.Environment.GridMode;function b(){return PulseApp.isMobile?140:200}PulseApp.Views.PulseGrid.prototype.getContentWidth=function(){var d=this.$el.width(),e=(PulseApp.Environment.ScrollBarWidth)?PulseApp.Environment.ScrollBarWidth:0;d-=e;return d};PulseApp.Views.PulseGrid.prototype.resize=function(){this.cellSizeMin=b();Tiles.Grid.prototype.resize.call(this)};PulseApp.Views.PulseGrid.prototype.resizeColumns=function(){var d=Tiles.Grid.prototype.resizeColumns.call(this);if(this.mode===PulseApp.Environment.GridMode.UNIFORM_SMALL){d++}return d};PulseApp.Views.PulseGrid.prototype.setMode=function(e){var d=this.mode;if(d!==e){this.mode=e;window.localStorage.setItem("gridMode",this.mode);PulseApp.GridSetting=this.mode;this.template=null;$("#header-layout-toggle").removeClass(PulseApp.Environment.GridMode.MAGAZINE).removeClass(PulseApp.Environment.GridMode.UNIFORM_NORMAL).removeClass(PulseApp.Environment.GridMode.UNIFORM_SMALL).addClass(this.mode);this.templateFactory=(e===PulseApp.Environment.GridMode.MAGAZINE)?PulseApp.Views.PulseTileTemplates:Tiles.UniformTemplates;if(d===PulseApp.Environment.GridMode.UNIFORM_SMALL||e===PulseApp.Environment.GridMode.UNIFORM_SMALL){this.resize()}}};PulseApp.Views.PulseGrid.prototype.ensureTemplate=function(e){if(this.template&&this.template.rects.length>=(e+this.numCols)){this.template=null}if(!this.template||this.template.numCols!==this.numCols){var f=Backbone.history.fragment,d=PulseApp.Views.PulseTileTemplates;if(f&&f.indexOf("/")<0){f+="/all"}if(this.mode===PulseApp.Environment.GridMode.MAGAZINE){this.template=d.getStreamTemplate(f,this.numCols,e)}if(!this.template){this.template=this.createTemplate(this.numCols,e);if(this.mode===PulseApp.Environment.GridMode.MAGAZINE){d.setStreamTemplate(f,this.template)}}this.isDirty=true}Tiles.Grid.prototype.ensureTemplate.call(this,e)};PulseApp.Views.PulseGrid.prototype.onDomInsertion=function(){var d=this,k=0,j=300,e=8,m=0.25;PINCH_THROTTLE_WAIT=16,scalePinch=_.throttle(function(n,o){if(+new Date-k>=j){$("#tile-grid-changing").toggle(d.mode!==o)}var p=(n.scale<1)?1-((1-n.scale)*m):1+Math.min(e,n.scale)/e*m;d.$el.css("scale",p)},PINCH_THROTTLE_WAIT),onPinch=function(n){var p=n.cancelled?1:n.scale,o;switch(d.pinchStartMode){case PulseApp.Environment.GridMode.MAGAZINE:o=(p<0.5)?PulseApp.Environment.GridMode.UNIFORM_NORMAL:PulseApp.Environment.GridMode.MAGAZINE;break;case PulseApp.Environment.GridMode.UNIFORM_NORMAL:o=(p<0.5)?PulseApp.Environment.GridMode.UNIFORM_SMALL:(p<2)?PulseApp.Environment.GridMode.UNIFORM_NORMAL:PulseApp.Environment.GridMode.MAGAZINE;break;case PulseApp.Environment.GridMode.UNIFORM_SMALL:o=(p>2)?PulseApp.Environment.GridMode.UNIFORM_NORMAL:PulseApp.Environment.GridMode.UNIFORM_SMALL;break}if(n.cancelled||n.type==="pinchend"){d.$el.animate({scale:1},500);$("#tile-grid-changing").hide();if(d.mode!==o){d.setMode(o);d.redraw(true)}}else{scalePinch(n,o)}};var g=false,l=null,f=function(){$("#hold-tile").fadeOut("fast",function(){$(this).remove()})},h=function(){var v=50,u=$("#hold-tile"),n=u.offset(),y=u.width(),w=u.height(),z=$("#left-nav-saved"),A=z.height(),r=z.offset(),B=Math.floor(r.top+(A-(v*(w/y)))/2)+2,x=r.left+152+(v/2),E=n.left+(y/2)-x,D=n.top+(w/2)-B,o=Math.sqrt(E*E+D*D),p=1000/1000,q=Math.max(700,o/p);u.animate({top:B,left:x,width:v,height:v*(w/y),opacity:0.1},{duration:q,complete:function(){f();var F=z.find(".icon-star");F.addClass("selected");setTimeout(function(){F.removeClass("selected")},1000)},easing:"easeInOutExpo"});var t=u.data("tile-id"),C=_.find(d.collection.models,function(F){return F.getUrl()===t});if(C){PulseApp.SavedStories.addRemove({model:C,action:"save"})}};this.$view.on({gesturestart:function(n){g=false},pinchstart:function(n){k=+new Date;d.pinchStartMode=d.mode;onPinch(n)},pinchmove:function(n){onPinch(n)},pinchend:function(n){onPinch(n)},holdstart:function(r){if(!d.holdToSave||r.pointerType!=="touch"){return}var q=d.locateTile(r.x,r.y);if(q){var p=q.$el.clone(),o=q.$el.offset(),n=$(document.createElement("div")).addClass("hold-overlay").on("contextmenu",function(){return false});p.find(".story-tile-byline").remove();p.attr("id","hold-tile").data("tile-id",q.id).append(n).css({position:"fixed",left:o.left-10,top:o.top-10,width:q.$el.width()+15,height:q.$el.height()+15}).appendTo(this);l=setTimeout(h,500);g=true}},contextmenu:function(n){if(g){n.preventDefault()}},holdend:function(n){if(n.cancelled&&l){f();clearTimeout(l)}l=null},tap:$.proxy(this.onStoryTap,this)});$("#header-layout-toggle").addClass(this.mode).show();$("#header-layout-smart").on("click",function(){d.setMode(PulseApp.Environment.GridMode.MAGAZINE);d.redraw(true)});$("#header-layout-grid").on("click",function(){d.setMode(PulseApp.Environment.GridMode.UNIFORM_NORMAL);d.redraw(true)});$("#header-layout-zoom").on("click",function(){d.setMode(PulseApp.Environment.GridMode.UNIFORM_SMALL);d.redraw(true)})};PulseApp.Views.PulseGrid.prototype.onRemove=function(){$("#header-layout-toggle").hide().removeClass(this.mode);$("#header-layout-smart").off("click");$("#header-layout-grid").off("click");$("#header-layout-zoom").off("click")};PulseApp.Views.PulseGrid.prototype.locateTile=function(f,e){var d=this.$el.offset(),j=f-d.left+this.$el.scrollLeft(),h=e-d.top+this.$el.scrollTop();var g=_.find(this.tiles,function(k){return(j>=k.left&&j<k.left+k.width&&h>=k.top&&h<k.top+k.height)});return g};PulseApp.Views.PulseGrid.prototype.onStoryTap=function(f){var e=$("#new-content-info"),h=f.x,g=f.y,l,k,m,j,d=false;if(e.length>0){l=e.offset();if(h>=l.left&&h<l.left+e.outerWidth(false)&&g>=l.top&&g<l.top+e.outerHeight(false)){e.trigger("pulse.grid.loadnew");return}}k=this.locateTile(h,g);if(k){m=_.find(this.collection.models,function(n){return n.getUrl()===k.id});if(m){_gaq.push(["_trackEvent","Stream_View","story_tile_click"]);j=new PulseApp.Views.Reading({model:m},{collection:this.collection,position:"center"});j.setUpViews()}}f.preventDefault()};PulseApp.Views.PulseGrid.sortRectsByPriority=function(e,d){var g=e.width*e.height,f=d.width*d.height;if(g>f){return -1}if(g<f){return 1}if(e.y<d.y){return -1}if(e.y>d.y){return 1}if(e.x<d.x){return -1}if(e.x>d.x){return 1}return 0};PulseApp.Views.PulseGrid.prototype.sortStoriesByImageSize=function(q,n){var e=_.indexOf(this.collection,q),k=_.indexOf(this.collection,n),h=Math.floor(e/this.priorityPageSize),m=Math.floor(k/this.priorityPageSize);if(h<m){return -1}if(h>m){return 1}var p=q.get("textOnly"),j=n.get("textOnly");if(!p&&j){return -1}if(p&&!j){return 1}if(!p&&!j){var l=q.get("tileImageWidth")||0,o=q.get("tileImageHeight")||0,r=Math.min(l,o),u=n.get("tileImageWidth")||0,g=n.get("tileImageHeight")||0,f=Math.min(u,g);if(r>f){return -1}if(r<f){return 1}var d=l*o,t=u*g;if(d>t){return -1}if(d<t){return 1}}if(e<k){return -1}if(e>k){return 1}return 0};PulseApp.Views.PulseGrid.prototype.createTile=function(e){var f=_.find(this.collection.models,function(g){return g.getUrl()===e});if(!f){pulse.console.log("Missing story: "+e);return null}var d=new PulseApp.Views.Story({model:f},{collection:this.collection});return new PulseApp.Views.PulseTile(e,d.$el)};PulseApp.Views.PulseGrid.prototype.shouldRedraw=function(){if(!this.collection){return false}return Tiles.Grid.prototype.shouldRedraw.call(this)};PulseApp.Views.PulseGrid.prototype.redraw=function(d,f){if(this.shouldRedraw()){if(this.enablePrioritization){var e=this.collection.models.slice(0);if(this.mode===PulseApp.Environment.GridMode.MAGAZINE){e.sort($.proxy(this.sortStoriesByImageSize,this))}this.storyUrlsByImageSize=_.map(e,function(g){return g.getUrl()})}this.$el.removeClass(PulseApp.Environment.GridMode.MAGAZINE).removeClass(PulseApp.Environment.GridMode.UNIFORM_NORMAL).removeClass(PulseApp.Environment.GridMode.UNIFORM_SMALL).addClass(this.mode)}Tiles.Grid.prototype.redraw.call(this,d,f)};PulseApp.Views.PulseGrid.prototype.prioritizePage=function(f,e){if(!this.enablePrioritization){return}f.sort(PulseApp.Views.PulseGrid.sortRectsByPriority);var d=a(f),g=this;e.sort(function(k,j){var h=_.indexOf(g.storyUrlsByImageSize,k.id),n=_.indexOf(g.storyUrlsByImageSize,j.id),o=d[h],p=d[n];if(o<p){return -1}if(o>p){return 1}var m=_.indexOf(g.collection,k),l=_.indexOf(g.collection,j);if(m<l){return -1}if(m>l){return 1}return 0})};function a(e){var h=[],g=0,l=0,f,d,k,j;for(f=0,d=e.length;f<d;f++){k=e[f];j=k.width*k.height;if(j!==g){l++;g=j}h[f]=l}return h}PulseApp.Views.PulseGrid.prototype.getAppendDelay=function(g,j,e,f,h,d){return _.indexOf(j,g)*this.appendDelayIncrement}})();(function(){var c=300,b=50,a=165;PulseApp.Views.ReadingListIE10=Backbone.View.extend({el:$("#reading-list-content"),readingViewParent:null,events:{"pulse.readinglistdragstart":"dragstart","pulse.readinglistdragmove":"dragmove","pulse.readinglistdragend":"dragend","click .story":"storyClick"},template:function(d){return _.template(PulseApp.Templates.ReadingListStoryIE10,{data:d})},initialize:function(){this.isReadingListOpen=false;this.isScrollValid=false;this.dragStartOffset=null;this.isAnimationInProgress=false;this.rotatetimer=null;this.$readingFrames=$("#reading-frames");this.$readingHeader=$("#reading-header");this.$readingList=$("#readinglist-ie10");this.$readingUI=$("#reading-ui");this.$dragList=$("#draglist");this.$leftWrapper=$("#leftlist-wrapper");this.$rightWrapper=$("#rightlist-wrapper");this.$leftOverlay=$("#leftlist-overlay");this.$rightOverlay=$("#rightlist-overlay");this.$dragShadow=$("#draglist-shadow");this.$leftContent=$("#leftlist-content");this.$rightContent=$("#rightlist-content");this.$leftList=$("#leftlist");this.$rightList=$("#rightlist");this.render();return this},render:function(){var d=this,e=this.collection.map(function(f){return d.template(f.toJSON())});this.$(".story").remove();setTimeout(function(){d.$el.prepend(e.join(""))},500)},remove:function(){var d=this.$(".story"),f=this.$readingList,e=this,g=function(){d.remove();e.hideReadingList()};g();this.undelegateEvents()},dragstart:function(f){if(this.isAnimationInProgress){return}this.dragStartOffset=this.$readingFrames.offset();$(".frame-middle").css({width:$(".frame-middle").width()});$(".frame-left").css({width:$(".frame-left").width()});$(".frame-right").css({width:$(".frame-right").width()});this.$readingUI.addClass("isdragging");var h=0;var d=0;var e=Math.ceil(this.$dragList.height()/a);if(this.isScrollValid){var g=this.$el.scrollTop();d=Math.floor(g/a);h=(d*a)-g}else{d=this.readingViewParent.getCurrentIndex();h=0;this.selectStory(d);this.$el.scrollTop(d*a);this.isScrollValid=true}if(this.startindex<0){d=0}if(h<0){e++}this.populateDragList(d,e,h);this.hideReadingList();this.dragmove(f)},dragmove:function(e){if(this.isAnimationInProgress){return}var d=this.dragDeltaToPercent(e.xDelta);this.updateTransform(d)},dragend:function(d){if(this.isAnimationInProgress){return}this.animateDrag(d.xDelta,d.yDelta)},animateDrag:function(h,e,g){this.isAnimationInProgress=true;var f=this.dragDeltaToPercent(h||0);var j=this.isReadingListOpen?-100:100;var d=0;clearInterval(this.rotatetimer);this.rotatetimer=setInterval($.proxy(function(){var k=Easing.easeInOutQuad(d,f,j,16);k=Math.min(Math.max(k,0),100);this.updateTransform(k);if(k>=100||k<=0){clearInterval(this.rotatetimer);this.finalizeDrag(k>=100);if(g){g()}}else{d++}},this),20)},finalizeDrag:function(d){this.isReadingListOpen=d;this.isAnimationInProgress=false;this.$readingFrames.css({right:"0px"});$(".frame-middle").css({width:"100%"});$(".frame-left").css({width:"100%"});$(".frame-right").css({width:"100%"});if(this.isReadingListOpen){this.showReadingList()}else{this.hideReadingList()}this.$readingUI.removeClass("isdragging")},updateTransform:function(e){angle=Easing.noEase(e,90,-90,100);rad=angle*(Math.PI/180);this.$leftWrapper.css({rotateY:(rad*-1)});this.$rightWrapper.css({rotateY:(rad)});offset=Math.floor((Math.cos(rad)*a));$("#article-navigation-bar").css({translateX:offset});this.$readingHeader.css({left:offset});this.$readingFrames.css({left:(offset+78)});this.$dragList.css({width:offset});if(!this.isReadingListOpen){this.$readingFrames.css({right:(offset*-1)})}op=Easing.easeInCubic(e,0.9,-0.9,100);this.$leftOverlay.css({opacity:op});this.$rightOverlay.css({opacity:op});var d=0;if(e<66){d=Easing.easeOutCubic(e,0,30,66);op=1}else{d=Easing.easeInCirc(e,30,-20,100);op=Easing.easeInCirc(e,1,-1,100)}this.$dragShadow.css({left:d*-1})},notifyStoryChanged:function(d){this.selectStory(d,false);if(this.isReadingListOpen){if(d*a>(this.$el.scrollTop()+this.$el.height()-a)||(d*a<(this.$el.scrollTop()))){this.$el.scrollTop(d*a)}}},storyClick:function(e){var d=$(e.currentTarget).index();this.selectStory(d,true)},selectStory:function(d,g){var f=$("#readinglist-selection-ie10");if(!f.length){this.$el.append('<div id="readinglist-selection-ie10"></div>');f=$("#readinglist-selection-ie10")}f.css({top:d*a});if(g){var e=this.readingViewParent;setTimeout(function(){e.goToStoryAtIndex(d)},200)}},dragDeltaToPercent:function(d){var f=$("#reading-frames").offset();var h=d+this.dragStartOffset.left-f.left;var g=this.isReadingListOpen?c:c*-1;var e=this.isReadingListOpen?100-Easing.noEase(h,0,100,g):Easing.noEase(h,0,100,g);return Math.min(Math.max(e,0),100)},populateDragList:function(f,h,j){var d=f;var g=h;var e=this.$el.children();if(h>e.length){d=0;g=e.length}else{if((f+h)>e.length){d=e.length-(h+1)}}this.$leftContent.empty();this.$rightContent.empty();e=e.slice(d,d+g);e.clone().appendTo("#leftlist-content");e.clone().appendTo("#rightlist-content");this.$leftContent.css({top:j});this.$rightContent.css({top:j})},hideReadingList:function(){this.$readingList.addClass("offscreen");this.$leftList.show();this.$rightList.show()},showReadingList:function(){this.$readingList.removeClass("offscreen");this.$leftList.hide();this.$rightList.hide()},debug:function(d){$("#source-title").text(d)}})})();PulseApp.Router=Backbone.Router.extend({routes:{"read/:short_code":"load_reading_view","logout/":"clear_localStorage",onboarding:"load_onboarding","settings/":"load_settings",settings:"load_settings","saved/":"load_saved",saved:"load_saved","dev/":"load_dev",dev:"load_dev","catalog/:category_name/:subcategory_name?:query":"load_catalog_source_category","catalog/:category_name?:query":"load_catalog_source","catalog/:category_name/:subcategory_name":"load_catalog_source_category","catalog/:category_name":"load_catalog_source","catalog/":"load_catalog",catalog:"load_catalog",":page_name/:souce_name?:query":"load_stream",":page_name/:souce_name/?:query":"load_stream",":page_name/:souce_name":"load_stream",":page_name/:souce_name/":"load_stream",":page_name/?:query":"load_stream",":page_name?:query":"load_stream",":page_name/":"load_stream",":page_name":"load_stream","?*":"main_page"},initialize:function(){Backbone.history.start({pushState:PulseApp.Environment.PushStates,root:__route_base_path});this.bind("all",this.trackPageView);_.bindAll(this,"getFirstCatalogCategory")},trackPageView:function(){url=Backbone.history.getFragment();_gaq.push(["_trackPageview","/"+url])},load_onboarding:function(){var a=this;yepnope({load:_loader([_p.onboarding_css,_p.catalog_css,_p.onboarding]),complete:function(){if(PulseApp.UserPages.models.length==0&&PulseApp.Environment.isLoggedInUser()){a.renderMainView(PulseApp.Environment.Constants.ONBOARDING)}else{a.main_page()}}})},clear_localStorage:function(){if(Modernizr.localstorage){window.localStorage.clear()}PulseApp.LoggingHelper.accountLogout();PulseApp.LoggingHelper.logSessionEnd();window.location="/logout"},main_page:function(){if(PulseApp.Environment.isLoggedInUser()){if(PulseApp.UserPages.models.length>0){var a=PulseApp.UserPages.models[0].get("page_route");this.navigate(a,{trigger:true})}else{this.navigate("onboarding",{trigger:true})}}else{this.navigate("news",{trigger:true})}},load_reading_view:function(a){if(__first_article){var b=PulseApp.UserPages.models[0];this.renderMainView(PulseApp.Environment.Constants.STORY,{page:b,story:__first_article})}else{this.navigate("onboarding",{trigger:true})}},load_publisher_page:function(){var a=Backbone.history.fragment;Backbone.history.fragment="";this.navigate(a,{trigger:true})},load_stream:function(c,b,g){var h=function(){if(PulseApp.isXbox){hint=new PulseApp.Views.Hint({namespace:"web_onboarding",key:"xbox_hint"})}};if(!PulseApp.isMobile&&!PulseApp.Environment.isLoggedInUser()){if(PulseApp.ActiveViews.ForceSignUpUpsellModal){PulseApp.ActiveViews.ForceSignUpUpsellModal.remove();PulseApp.ActiveViews.ForceSignUpUpsellModal=undefined}}if(PulseApp.Helpers.isBrowsingRequestedUser()){if(!PulseApp.RequestedUser.page){var f=_.find(PulseApp.RequestedUser.sources.data.pages,function(j){return c.toLowerCase()==encodeURIComponent(j.page_title).toLowerCase()});if(f){f=new PulseApp.User.Models.Page(f);e=_.find(f.get("page_sources").models,function(j){return j.get("source_route")==b});PulseApp.RequestedUser.page=f;a=e?PulseApp.Environment.Constants.SOURCE:PulseApp.Environment.Constants.PAGE;if(a==PulseApp.Environment.Constants.SOURCE){PulseApp.LoggingHelper.visitedSharedSource(e)}else{PulseApp.LoggingHelper.visitedSharedPage(f)}this.renderMainView(a,e||f);return}else{PulseApp.Helpers.resetPersonalUrl()}}}if(Backbone.history.options.root.indexOf("publishers")!=-1){if(PulseApp.Catalog.flat_item_list.length==0){PulseApp.Catalog.bind("all",this.load_publisher_page,this);return}else{if(!PulseApp.Publisher){catalog_object=_.find(PulseApp.Catalog.flat_item_list,function(j){return _.slugify(j.domain)==c});if(catalog_object){new_page=new PulseApp.User.Models.Page({page_title:"publishers",page_position:0});src={source_url:PulseApp.Username.length==0?catalog_object.feed_url.replace("http://","https://"):catalog_object.feed_url,source_title:catalog_object.domain,is_deleted:false,updated:Math.floor((new Date().getTime())/1000),catalog_primary_key:catalog_object.string_primary_key};pageSource=new PulseApp.User.Models.PageSource(src,{page:new_page});PulseApp.Publisher=new_page;this.renderMainView(PulseApp.Environment.Constants.SOURCE,pageSource);return}else{PulseApp.Helpers.resetPersonalUrl()}}else{return}}}var f=this.getPage(c),e=b?this.getSource(f,b):null,a,d,c=decodeURIComponent(c).toLowerCase();if(PulseApp.Username.length==0){if(Modernizr.localstorage){window.localStorage.removeItem("pages")}switch(c){case"news":PulseApp.Environment.Preloads.active=PulseApp.Environment.Preloads.News;break;case"sports":PulseApp.Environment.Preloads.active=PulseApp.Environment.Preloads.Sports;break;case"technology":PulseApp.Environment.Preloads.active=PulseApp.Environment.Preloads.Technology;break;case"entertainment":PulseApp.Environment.Preloads.active=PulseApp.Environment.Preloads.Entertainment;break;case"science":PulseApp.Environment.Preloads.active=PulseApp.Environment.Preloads.Science;break;case"gaming":PulseApp.Environment.Preloads.active=PulseApp.Environment.Preloads.Gaming;break;case"business":PulseApp.Environment.Preloads.active=PulseApp.Environment.Preloads.Business;break;case"food":PulseApp.Environment.Preloads.active=PulseApp.Environment.Preloads.Food;break;case"photography":PulseApp.Environment.Preloads.active=PulseApp.Environment.Preloads.Photography;break;case"art":PulseApp.Environment.Preloads.active=PulseApp.Environment.Preloads.Art;break;case"auto":PulseApp.Environment.Preloads.active=PulseApp.Environment.Preloads.Auto;break;case"travel":PulseApp.Environment.Preloads.active=PulseApp.Environment.Preloads.Travel;break;case"architecture":PulseApp.Environment.Preloads.active=PulseApp.Environment.Preloads.Architecture;break;case"comics":PulseApp.Environment.Preloads.active=PulseApp.Environment.Preloads.Comics;break;case"design":PulseApp.Environment.Preloads.active=PulseApp.Environment.Preloads.Design;break;case"politics":PulseApp.Environment.Preloads.active=PulseApp.Environment.Preloads.Politics;break;case"music":PulseApp.Environment.Preloads.active=PulseApp.Environment.Preloads.Music;break;case"women's fashion":PulseApp.Environment.Preloads.active=PulseApp.Environment.Preloads.WomensFashion;break;case"fun & humor":PulseApp.Environment.Preloads.active=PulseApp.Environment.Preloads.FunAndHumor;break;case"women's health":PulseApp.Environment.Preloads.active=PulseApp.Environment.Preloads.WomensHealth;break;case"men's fashion":PulseApp.Environment.Preloads.active=PulseApp.Environment.Preloads.MensFashion;break;case"men's health":PulseApp.Environment.Preloads.active=PulseApp.Environment.Preloads.MensHealth;break;default:this.navigate("news",{trigger:false,replace:true});PulseApp.Environment.Preloads.active=PulseApp.Environment.Preloads.News;break}_gaq.push(["_setCustomVar",3,"Non Auth Visitor",c.toLowerCase(),1]);PulseApp.UserPages=new PulseApp.User.Collections.UserPages(PulseApp.Environment.Preloads.active);if(PulseApp.Environment.isLoggedInUser()){PulseApp.UserPages.syncAll(PulseApp.Environment.Preloads.active,true)}c=escape(encodeURIComponent(c));f=this.getPage(c)}if(PulseApp.Views.onboarding!==undefined){PulseApp.Views.onboarding.remove();PulseApp.Views.onboarding=undefined}if(PulseApp.ActiveViews.Main!=undefined){PulseApp.ActiveViews.Main.removeOverlay()}if(f){a=(e||g)?PulseApp.Environment.Constants.SOURCE:PulseApp.Environment.Constants.PAGE;if(!f.get("is_selected")){f.collection.clearSelectedPages();f.toggleSelected()}if(e){if(!e.get("is_selected")){e.collection.clearSelectedSources();e.toggleSelected()}}else{f.get("page_sources").clearSelectedSources()}this.renderMainView(a,e||f)}else{this.main_page()}},load_saved:function(){if(PulseApp.SavedStories==undefined){PulseApp.SavedStories=new PulseApp.Collections.SavedStories()}PulseApp.UserPages.clearSelectedPages();this.renderMainView(PulseApp.Environment.Constants.SAVED,PulseApp.SavedStories)},load_dev:function(){var a=this;yepnope({load:_loader([_p.dev]),complete:function(){a.renderMainView(PulseApp.Environment.Constants.DEV)}})},renderMainView:function(a,b){if(PulseApp.ActiveViews.Main==undefined){PulseApp.ActiveViews.Left=new PulseApp.Views.LeftBar({collection:PulseApp.UserPages});PulseApp.ActiveViews.Main=new PulseApp.Views.MainContainer()}if(PulseApp.ActiveViews.Header){PulseApp.ActiveViews.Header.model=b}else{PulseApp.ActiveViews.Header=new PulseApp.Views.TopHeader({model:b})}if(a==PulseApp.Environment.Constants.SAVED){PulseApp.ActiveViews.Header.switchContext("saved")}else{if(PulseApp.Helpers.isBrowsingRequestedUser()){PulseApp.ActiveViews.Header.switchContext("requested")}else{PulseApp.ActiveViews.Header.switchContext()}}PulseApp.ActiveViews.Main.render(a,b)},getPage:function(a){var b;_.each(PulseApp.UserPages.models,function(c){if(a===c.get("page_route")){b=c;return}},this);return b},getSource:function(d,a){var c=false;try{_.each(d.get("page_sources").models,function(e){if(a==e.get("source_route")){c=e;return}},this)}catch(b){return false}return c},pageNotFound:function(){},load_settings:function(){var a=this;yepnope({load:_loader([_p.settings]),complete:function(){PulseApp.Profile=new PulseApp.Models.Profile();a.renderMainView(PulseApp.Environment.Constants.SETTINGS,PulseApp.Profile)}})},getCatalogCategory:function(b){var a=false;b=unescape(b);_.each(PulseApp.Catalog.models,function(c){if(b.toLowerCase()===c.get("title").toLowerCase()){a=c;return}},this);return a},getCatalogSubCategory:function(d,c){var a=this.getCatalogCategory(d),b=false;c=unescape(c);_.each(a.items.models,function(e){if(c.toLowerCase()===e.get("title").toLowerCase()){b=e;return}},this);return b},load_catalog:function(){var a=this;if(PulseApp.Views.Catalog){this.getFirstCatalogCategory()}else{yepnope({load:_loader([_p.catalog_css,_p.catalog]),complete:function(){a.getFirstCatalogCategory()}})}},getFirstCatalogCategory:function(b){PulseApp.LoggingHelper.sendLog({name:"Viewed Catalog"});var a=this;if(PulseApp.Catalog.models.length===0){PulseApp.Catalog.bind("reset",_.once(function(){var d=encodeURIComponent(PulseApp.Catalog.models[1].get("title").toLowerCase());PulseApp.Catalog.models[1].set("is_selected",true);if(!b){a.navigate("catalog/"+d,{trigger:true,replace:true})}else{a.load_catalog_source(d)}}))}else{var c=encodeURIComponent(PulseApp.Catalog.models[1].get("title").toLowerCase());PulseApp.Catalog.models[1].set("is_selected",true);if(!b){this.navigate("catalog/"+c,{trigger:true})}else{this.load_catalog_source(c)}}},load_catalog_source:function(c){var a=this;var b=a.getCatalogCategory(c);if(PulseApp.Catalog.models.length===0){PulseApp.Catalog.bind("reset",_.once(function(){a.renderMainView(PulseApp.Environment.Constants.CATALOG,b)}),a)}else{a.renderMainView(PulseApp.Environment.Constants.CATALOG,b)}},load_catalog_source_category:function(c,b){var a=this;yepnope({load:_loader([_p.catalog_css,_p.catalog]),complete:function(){var d=a.getCatalogSubCategory(c,b);if(PulseApp.Catalog.models.length===0){PulseApp.Catalog.bind("reset",_.once(function(){a.renderMainView(PulseApp.Environment.Constants.CATALOG,d)}),a)}else{a.renderMainView(PulseApp.Environment.Constants.CATALOG,d)}}})}});$(function(){if(!PulseApp.Helpers.isSupportedBrowser()&&PulseApp.Helpers.checkCookiefunction(PulseApp.Environment.Constants.UNSUPPORTED_BROWSER_STRING)==null){PulseApp.ActiveViews.BrowserCompatibility=new PulseApp.Views.BrowserCompatibility()}else{var g=parseInt(PulseApp.Helpers.checkCookiefunction("privacy_message"),10);if(!g||g<3){PulseApp.PrivacyMessage=true;if(!isNaN(g)){PulseApp.Helpers.setCookie("privacy_message",g+1)}else{PulseApp.Helpers.setCookie("privacy_message",1)}}_.mixin(_.string.exports());_.mixin({rmSpecialChars:function(d){return d.replace(/[^\w\s]/gi,"")}});var f=function(){PulseApp.Catalog=new PulseApp.Collections.CatalogItems();PulseApp.SavedStories=new PulseApp.Collections.SavedStories();PulseApp.RouterObject=new PulseApp.Router()};var c=function(){if(!PulseApp.Environment.Pixel){if(pages){PulseApp.UserPages=new PulseApp.User.Collections.UserPages(pages.data.pages);pages=null}else{if(__first_article!=null&&__first_article.feed_title&&__first_article.feed){localStorage.removeItem("pages");var d=[{page_position:0,sources:[{updated:1348254480,source_title:__first_article.feed_title,source_url:__first_article.feed,is_deleted:false,source_position:0}],page_title:"general"}];PulseApp.UserPages=new PulseApp.User.Collections.UserPages(d);PulseApp.Environment.Preloads.active=d}else{PulseApp.UserPages=new PulseApp.User.Collections.UserPages()}}if(__requested_user){PulseApp.RequestedUser=__requested_user;__requested_user=null}PulseApp.User.is_authenticated=__is_authenticated;__is_authenticated=null;if(__pulse_uid){PulseApp.Profile={},PulseApp.Profile=new PulseApp.Models.Profile({user_id:__pulse_uid})}}};c();PulseApp.Username=pulse_username;PulseApp.LoggingHelper.logSessionStart();if(Modernizr.localstorage){var h=window.localStorage.getItem("readingPref"),j=window.localStorage.getItem("gridMode");if(h!==null){PulseApp.Environment.ReadingPref=JSON.parse(h)}if(j!=null){PulseApp.GridSetting=j}window.localStorage.setItem("username",pulse_username+PulseApp.Version)}f();window.onbeforeunload=function(){PulseApp.UserPages.forceSync(false);PulseApp.LoggingHelper.logSessionEnd();if(PulseApp.Username.length==0){if(Modernizr.localstorage){window.localStorage.removeItem("pages")}}};PulseApp.Environment.IsFacebookConnected=false;PulseApp.Environment.ScrollBarWidth=PulseApp.Environment.determineScrollBarWidth();var k=document,b,a="facebook-jssdk",e=k.getElementsByTagName("script")[0];if(k.getElementById(a)){return}b=k.createElement("script");b.id=a;b.async=true;b.src="//connect.facebook.net/en_US/all.js";e.parentNode.insertBefore(b,e);if(PulseApp.Environment.isLoggedInUser()){$.ajax({url:PulseApp.Environment.Endpoints.Profile,type:"POST",data:{last_visited:"web"},statusCode:{200:function(d){PulseApp.Profile=new PulseApp.Models.Profile(d.data)},500:function(){_gaq.push(["_trackEvent","api_endpoint_fail","profile"])}}})}window.fbAsyncInit=function(){var d=PulseApp.Environment.determineHttpHostname(),l=PulseApp.Environment.determineFacebookAppId(d);FB.init({appId:l,status:true,cookie:true,xfbml:true});FB.Event.subscribe("auth.statusChange",function(m){if(m.status=="connected"){PulseApp.Environment.IsFacebookConnected=true}else{PulseApp.Environment.IsFacebookConnected=false}})}}});